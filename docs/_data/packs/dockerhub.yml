# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-19T20:09:28Z

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-dockerhub-1.02-implement-access-tokens.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/dockerhub/terraform/hth-dockerhub-1.02-implement-access-tokens.tf"
    excerpts:
      terraform:
        content: |
            # Create a scoped read-only access token for CI/CD pipeline pulls.
            # Access tokens replace password-based authentication for automation.
            resource "docker_hub_access_token" "ci_cd_readonly" {
            token_label = var.ci_cd_token_description
            scopes      = var.ci_cd_token_scopes
            is_active   = true
            }
          
            # Create a scoped read/write access token for build pipelines.
            # This token should be rotated monthly per the hardening guide.
            resource "docker_hub_access_token" "build_readwrite" {
            token_label = var.build_token_description
            scopes      = var.build_token_scopes
            is_active   = true
            }
          
            # Reminder for token rotation policy enforcement.
            # Docker Hub does not support automatic token expiration via API;
            # rotation must be enforced through operational procedures.
            resource "null_resource" "token_rotation_reminder" {
            triggers = {
              quarterly_check = formatdate("YYYY-QQ", timestamp())
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "=== Docker Hub Access Token Rotation Reminder ==="
                echo ""
                echo "Token rotation schedule:"
                echo "  CI/CD pull tokens:  Rotate quarterly"
                echo "  Build/push tokens:  Rotate monthly"
                echo ""
                echo "Steps to rotate:"
                echo "  1. Create new token at: Account Settings > Security > Access Tokens"
                echo "  2. Update CI/CD pipeline secrets with new token value"
                echo "  3. Verify pipelines work with new token"
                echo "  4. Revoke the old token"
                echo ""
                echo "API endpoint for token management:"
                echo "  POST https://hub.docker.com/v2/access-tokens"
                echo "  DELETE https://hub.docker.com/v2/access-tokens/{uuid}"
              EOT
            }
          
            lifecycle {
              ignore_changes = [triggers]
            }
            }

"2.1":
  cli:
    lang: "bash"
    filename: "hth-dockerhub-2.01-docker-scout.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/dockerhub/cli/hth-dockerhub-2.01-docker-scout.sh"
    excerpts:
      cli-docker-scout:
        content: |
            # Enable Scout for repository
            docker scout recommendations myimage:latest
          
            # Check for vulnerabilities
            docker scout cves myimage:latest

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-dockerhub-2.02-image-signing-content-trust.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/dockerhub/terraform/hth-dockerhub-2.02-image-signing-content-trust.tf"
    excerpts:
      terraform:
        content: |
            # Docker Content Trust (DCT) enforcement for image signing.
            # Only applied at L2+ profile levels.
            # DCT uses Notary to cryptographically sign images at push time.
            resource "null_resource" "content_trust_setup" {
            count = var.profile_level >= 2 ? 1 : 0
          
            triggers = {
              organization = var.dockerhub_organization
              enabled      = var.enable_content_trust
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "=== Docker Content Trust (DCT) Setup ==="
                echo ""
                echo "Enable DCT globally in your environment:"
                echo "  export DOCKER_CONTENT_TRUST=1"
                echo ""
                echo "Initialize signing for each repository:"
                echo "  docker trust key generate ${var.dockerhub_organization}"
                echo "  docker trust signer add --key ${var.dockerhub_organization}.pub ${var.dockerhub_organization} ${var.dockerhub_organization}/<repo>:latest"
                echo ""
                echo "Sign and push an image:"
                echo "  DOCKER_CONTENT_TRUST=1 docker push ${var.dockerhub_organization}/<repo>:latest"
                echo ""
                echo "Verify signatures:"
                echo "  docker trust inspect --pretty ${var.dockerhub_organization}/<repo>:latest"
                echo ""
                echo "CI/CD enforcement:"
                echo "  Set DOCKER_CONTENT_TRUST=1 in pipeline environment"
                echo "  Unsigned images will be rejected on pull"
              EOT
            }
            }
          
            # L3: Enforce Sigstore/Cosign signing for maximum security environments.
            # Cosign provides keyless signing via OIDC identity for stronger provenance.
            resource "null_resource" "cosign_signing_setup" {
            count = var.profile_level >= 3 ? 1 : 0
          
            triggers = {
              organization = var.dockerhub_organization
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "=== Sigstore/Cosign Image Signing (L3 Maximum Security) ==="
                echo ""
                echo "Install cosign:"
                echo "  go install github.com/sigstore/cosign/v2/cmd/cosign@latest"
                echo ""
                echo "Keyless signing (OIDC-based):"
                echo "  cosign sign ${var.dockerhub_organization}/<repo>:latest"
                echo ""
                echo "Key-pair signing:"
                echo "  cosign generate-key-pair"
                echo "  cosign sign --key cosign.key ${var.dockerhub_organization}/<repo>:latest"
                echo ""
                echo "Verify in CI/CD:"
                echo "  cosign verify --key cosign.pub ${var.dockerhub_organization}/<repo>:latest"
                echo ""
                echo "SLSA provenance attestation:"
                echo "  cosign attest --predicate provenance.json ${var.dockerhub_organization}/<repo>:latest"
              EOT
            }
            }
  cli:
    lang: "bash"
    filename: "hth-dockerhub-2.02-content-trust.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/dockerhub/cli/hth-dockerhub-2.02-content-trust.sh"
    excerpts:
      cli-content-trust:
        content: |
            # Enable content trust
            export DOCKER_CONTENT_TRUST=1
          
            # Sign and push image
            docker push myorg/myimage:latest

