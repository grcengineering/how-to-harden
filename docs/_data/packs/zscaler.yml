# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-19T20:10:29Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-1.01-configure-saml-sso.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-1.01-configure-saml-sso.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: ZIA SAML SSO configuration is managed through the ZIA Admin Portal
            # (Administration > Authentication Settings). The ZIA Terraform provider does
            # not currently expose SAML IdP configuration as a managed resource.
            #
            # ZPA IdP configuration is created via the ZPA Admin Portal and can be
            # referenced as a data source for use in access policies.
          
            data "zpa_idp_controller" "corporate_idp" {
            count = var.idp_id != "" ? 0 : 1
            name  = "Corporate-SSO"
            }
          
            locals {
            idp_id = var.idp_id != "" ? var.idp_id : try(data.zpa_idp_controller.corporate_idp[0].id, "")
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-1.02-role-based-admin-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-1.02-role-based-admin-access.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: ZIA admin role management is performed through the ZIA Admin Portal
            # (Administration > Administrator Management > Role Management).
            # The ZIA Terraform provider supports reading admin roles as data sources.
            #
            # ZPA admin roles can be referenced and used in access policy configuration.
          
            data "zia_admin_roles" "security_admin" {
            name = "Security Admin"
            }
          
            data "zia_admin_roles" "auditor" {
            name = "Auditor"
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-2.01-url-filtering.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-2.01-url-filtering.tf"
    excerpts:
      terraform:
        content: |
          
            # Block high-risk URL categories (security, legal, risk)
            resource "zia_url_filtering_rules" "block_high_risk" {
            name        = "HTH-Block-High-Risk-Categories"
            description = "Block malware, phishing, botnet, cryptomining, and policy-violating categories"
            state       = "ENABLED"
            action      = "BLOCK"
            order       = 1
          
            url_categories = var.url_block_categories
          
            protocols = ["HTTPS_RULE", "HTTP_PROXY", "HTTP_RULE", "SSL_RULE", "FTP_RULE"]
            }
          
            # Caution on medium-risk URL categories (user override with acknowledgment)
            resource "zia_url_filtering_rules" "caution_medium_risk" {
            name        = "HTH-Caution-Medium-Risk-Categories"
            description = "Caution on uncategorized, newly registered domains, and file sharing sites"
            state       = "ENABLED"
            action      = "CAUTION"
            order       = 2
          
            url_categories = var.url_caution_categories
          
            protocols = ["HTTPS_RULE", "HTTP_PROXY", "HTTP_RULE", "SSL_RULE"]
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-2.02-advanced-threat-protection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-2.02-advanced-threat-protection.tf"
    excerpts:
      terraform:
        content: |
          
            # Enable malware protection with inline scanning
            resource "zia_security_policy_settings" "malware_protection" {
            whitelist_urls = []
          
            # Block all known malware file types
            blacklist_urls = []
            }
          
            # Configure sandbox rule to quarantine unknown files
            resource "zia_sandbox_behavioral_analysis" "cloud_sandbox" {
            count = var.profile_level >= 1 ? 1 : 0
          
            file_types_for_analysis = [
              "EXE_DLL",
              "OFFICE_DOCUMENTS",
              "PDF",
              "ARCHIVE",
              "SCRIPT",
            ]
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-2.03-firewall-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-2.03-firewall-policies.tf"
    excerpts:
      terraform:
        content: |
          
            # Block risky protocols -- unencrypted and tunneling traffic (L2+)
            resource "zia_firewall_filtering_rule" "block_risky_protocols" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH-Block-Risky-Protocols"
            description = "Block unencrypted protocols, tunneling, and unauthorized remote access"
            state       = "ENABLED"
            action      = "BLOCK_DROP"
            order       = 1
          
            nw_services {
              id = [data.zia_firewall_filtering_network_services.ftp.id]
            }
          
            protocols = ["FTP_RULE", "NETBIOS_RULE"]
            }
          
            # Default deny rule -- all traffic not explicitly allowed is blocked (L2+)
            resource "zia_firewall_filtering_rule" "default_deny" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH-Default-Deny"
            description = "Default deny rule -- block all traffic not explicitly permitted"
            state       = "ENABLED"
            action      = "BLOCK_DROP"
            order       = 10000
            }
          
            # Data source: FTP network service for block rule
            data "zia_firewall_filtering_network_services" "ftp" {
            name = "FTP"
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-3.01-application-segments.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-3.01-application-segments.tf"
    excerpts:
      terraform:
        content: |
          
            # Segment group to organize applications by security classification
            resource "zpa_segment_group" "hardened" {
            name            = var.segment_group_name
            description     = "HTH-managed segment group for hardened application access"
            enabled         = true
            policy_migrated = true
            }
          
            # Application segments -- define what internal apps are accessible via ZPA
            resource "zpa_application_segment" "apps" {
            for_each = { for idx, app in var.application_segments : app.name => app }
          
            name             = each.value.name
            description      = each.value.description
            enabled          = true
            health_reporting = "ON_ACCESS"
            bypass_type      = "NEVER"
            is_cname_enabled = true
          
            segment_group_id = zpa_segment_group.hardened.id
          
            domain_names = each.value.domain_names
          
            dynamic "tcp_port_range" {
              for_each = each.value.tcp_port_range
              content {
                from = tcp_port_range.value.from
                to   = tcp_port_range.value.to
              }
            }
          
            server_groups {
              id = [zpa_server_group.hardened.id]
            }
            }
          
            # Server group for App Connector assignment
            resource "zpa_server_group" "hardened" {
            name              = var.server_group_name
            description       = "HTH-managed server group for hardened application access"
            enabled           = true
            dynamic_discovery = true
          
            app_connector_groups {
              id = [var.app_connector_group_name]
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-3.02-access-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-3.02-access-policies.tf"
    excerpts:
      terraform:
        content: |
          
            # Retrieve the global access policy for rule attachment
            data "zpa_policy_type" "access_policy" {
            policy_type = "ACCESS_POLICY"
            }
          
            # Access policy rule -- restrict access to hardened segment group by IdP group
            resource "zpa_policy_access_rule" "hardened_access" {
            count = length(var.scim_group_ids) > 0 ? 1 : 0
          
            name        = "HTH-Hardened-Application-Access"
            description = "Restrict application access to authorized IdP groups only"
            action      = "ALLOW"
            policy_type = data.zpa_policy_type.access_policy.id
            operator    = "AND"
          
            conditions {
              operator = "OR"
          
              operands {
                object_type = "APP_GROUP"
                values      = [zpa_segment_group.hardened.id]
              }
            }
          
            conditions {
              operator = "OR"
          
              dynamic "operands" {
                for_each = var.scim_group_ids
                content {
                  object_type   = "SCIM_GROUP"
                  values        = [operands.value]
                  idp_id        = local.idp_id
                }
              }
            }
            }
          
            # Default deny rule -- block all access not explicitly permitted
            resource "zpa_policy_access_rule" "default_deny" {
            name        = "HTH-Default-Deny"
            description = "Default deny -- block all application access not explicitly allowed"
            action      = "DENY"
            policy_type = data.zpa_policy_type.access_policy.id
            order       = "99"
            }

"3.3":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-3.03-device-posture.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-3.03-device-posture.tf"
    excerpts:
      terraform:
        content: |
          
            # Posture profile: require disk encryption (L2+)
            resource "zpa_posture_profile" "disk_encryption" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name           = "HTH-Require-Disk-Encryption"
            posture_udid   = "zscaler-client-posture-disk-encryption"
            domain         = var.zpa_customer_id
            master_customer_id = var.zpa_customer_id
            }
          
            # Posture profile: require firewall enabled (L2+)
            resource "zpa_posture_profile" "firewall_enabled" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name           = "HTH-Require-Firewall-Enabled"
            posture_udid   = "zscaler-client-posture-firewall"
            domain         = var.zpa_customer_id
            master_customer_id = var.zpa_customer_id
            }
          
            # Posture profile: require minimum OS version (L2+)
            resource "zpa_posture_profile" "os_version" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name           = "HTH-Require-Minimum-OS-Version"
            posture_udid   = "zscaler-client-posture-os-version"
            domain         = var.zpa_customer_id
            master_customer_id = var.zpa_customer_id
            }
          
            # Access policy rule requiring device posture (L2+)
            resource "zpa_policy_access_rule" "require_posture" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH-Require-Device-Posture"
            description = "Require device posture compliance for application access"
            action      = "ALLOW"
            policy_type = data.zpa_policy_type.access_policy.id
            operator    = "AND"
          
            conditions {
              operator = "OR"
          
              operands {
                object_type = "POSTURE"
                lhs         = zpa_posture_profile.disk_encryption[0].posture_udid
                rhs         = "true"
              }
            }
          
            conditions {
              operator = "OR"
          
              operands {
                object_type = "POSTURE"
                lhs         = zpa_posture_profile.firewall_enabled[0].posture_udid
                rhs         = "true"
              }
            }
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-4.01-client-connector-deploy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-4.01-client-connector-deploy.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: Zscaler Client Connector deployment and tunnel mode configuration
            # (Z-Tunnel 2.0, Always-On, split tunnel) is managed through the ZIA Admin
            # Portal (Policy > Client Connector Portal) and MDM/UEM deployment tools
            # (Intune, JAMF, SCCM). These settings are not exposed as Terraform resources.
            #
            # Recommended configuration (apply via ZIA Admin Portal):
            #   - Tunnel mode: Z-Tunnel 2.0
            #   - Always-On: Enabled
            #   - Auto-update: Enabled
            #   - Fallback: Configure based on network requirements
            #
            # Split tunnel exceptions (if required):
            #   - Office 365 optimization routes
            #   - Video conferencing (Zoom, Teams)
            #   - Minimize split tunnel scope
          
            # Retrieve Client Connector forwarding profile for reference
            data "zia_location_management" "all_locations" {
            name = "All Other Sub-Locations"
            }

"4.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-4.02-ssl-certificate-deploy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-4.02-ssl-certificate-deploy.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: SSL certificate deployment to endpoints is handled through:
            #   1. MDM/UEM tools (Intune, JAMF) for managed device deployment
            #   2. Client Connector auto-install during enrollment
            #   3. GPO distribution for domain-joined Windows devices
            #
            # The Zscaler root CA certificate must be added to the Trusted Root CA store
            # on all endpoints that will be subject to SSL inspection.
            #
            # Certificate download: ZIA Admin Portal > Administration > SSL Policy
            #
            # This control is infrastructure/endpoint-managed and not directly
            # configurable via the ZIA/ZPA Terraform providers.

"4.3":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-4.03-lock-client-connector.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-4.03-lock-client-connector.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: Client Connector App Profile configuration (locking ZIA/ZPA switches,
            # password-protected uninstall, disabling admin override) is managed through
            # the ZIA Admin Portal (Policy > Client Connector Portal > App Profiles).
            # These settings are not currently exposed as Terraform resources.
            #
            # Recommended configuration for L2+:
            #   - Lock ZIA switch: Enabled (prevent user disable)
            #   - Lock ZPA switch: Enabled (prevent user disable)
            #   - Password-protect uninstall: Enabled
            #
            # L3 additional restrictions:
            #   - Disable admin override codes
            #   - Users cannot bypass even temporarily
            #   - Implement support process for legitimate issues

"5.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-5.01-enable-ssl-inspection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-5.01-enable-ssl-inspection.tf"
    excerpts:
      terraform:
        content: |
          
            # SSL inspection rule -- inspect all HTTPS traffic by default
            resource "zia_ssl_inspection_rules" "inspect_all" {
            name        = "HTH-Inspect-All-SSL-Traffic"
            description = "Inspect all SSL/TLS traffic for threat detection and policy enforcement"
            state       = "ENABLED"
            action      = "INSPECT"
            order       = 1
          
            protocols = ["HTTPS_RULE", "SSL_RULE"]
            }
          
            # SSL inspection exception -- bypass certificate-pinned applications
            resource "zia_ssl_inspection_rules" "do_not_inspect" {
            name        = "HTH-Do-Not-Inspect-Exceptions"
            description = "Bypass SSL inspection for certificate-pinned and privacy-sensitive categories"
            state       = "ENABLED"
            action      = "DO_NOT_INSPECT"
            order       = 0
          
            url_categories = var.ssl_do_not_inspect_urls
            }

"5.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-5.02-test-ssl-inspection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-5.02-test-ssl-inspection.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: SSL inspection testing is an operational procedure, not a
            # Terraform-managed resource. This control requires manual validation.
            #
            # Pre-deployment testing checklist:
            #   1. Test major business applications through Zscaler proxy
            #   2. Verify certificate chain validity on all endpoint types
            #   3. Test certificate-pinned applications (banking, healthcare)
            #   4. Validate mobile app functionality
            #   5. Confirm the "Do Not Inspect" list covers required exceptions
            #
            # Post-deployment validation:
            #   1. Monitor for user-reported certificate errors
            #   2. Check ZIA logs for SSL handshake failures
            #   3. Verify malware detection is functional with SSL inspection
            #   4. Confirm DLP policies apply to inspected HTTPS traffic
            #
            # Use ZIA Admin Portal > Logs > SSL Logs to identify inspection gaps.

"6.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-6.01-logging-and-reporting.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-6.01-logging-and-reporting.tf"
    excerpts:
      terraform:
        content: |
          
            # Note: Zscaler logging configuration (enabling web, firewall, DNS, and
            # sandbox logs) is managed through the ZIA Admin Portal at:
            #   Administration > Log Settings
            #
            # Nanolog Streaming Service (NSS) for SIEM integration is configured at:
            #   Administration > Nanolog Streaming Service
            #
            # NSS feeds can stream logs to Splunk, Azure Sentinel, QRadar, and
            # generic syslog collectors. JSON format is recommended.
            #
            # The ZIA Terraform provider does not currently expose NSS feed
            # configuration as a managed resource. Use the ZIA API directly or
            # configure through the Admin Portal.
            #
            # Critical alert categories to configure:
            #   - Malware detection events
            #   - Policy violation events
            #   - Admin configuration changes
            #   - Authentication failures
            #   - SSL inspection bypass events

