# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-20T08:35:30Z

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-2.01-url-filtering.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-2.01-url-filtering.tf"
    excerpts:
      terraform:
        content: |
          
            # Block high-risk URL categories (security, legal, risk)
            resource "zia_url_filtering_rules" "block_high_risk" {
            name        = "HTH-Block-High-Risk-Categories"
            description = "Block malware, phishing, botnet, cryptomining, and policy-violating categories"
            state       = "ENABLED"
            action      = "BLOCK"
            order       = 1
          
            url_categories = var.url_block_categories
          
            protocols = ["HTTPS_RULE", "HTTP_PROXY", "HTTP_RULE", "SSL_RULE", "FTP_RULE"]
            }
          
            # Caution on medium-risk URL categories (user override with acknowledgment)
            resource "zia_url_filtering_rules" "caution_medium_risk" {
            name        = "HTH-Caution-Medium-Risk-Categories"
            description = "Caution on uncategorized, newly registered domains, and file sharing sites"
            state       = "ENABLED"
            action      = "CAUTION"
            order       = 2
          
            url_categories = var.url_caution_categories
          
            protocols = ["HTTPS_RULE", "HTTP_PROXY", "HTTP_RULE", "SSL_RULE"]
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-2.02-advanced-threat-protection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-2.02-advanced-threat-protection.tf"
    excerpts:
      terraform:
        content: |
          
            # Enable malware protection with inline scanning
            resource "zia_security_policy_settings" "malware_protection" {
            whitelist_urls = []
          
            # Block all known malware file types
            blacklist_urls = []
            }
          
            # Configure sandbox rule to quarantine unknown files
            resource "zia_sandbox_behavioral_analysis" "cloud_sandbox" {
            count = var.profile_level >= 1 ? 1 : 0
          
            file_types_for_analysis = [
              "EXE_DLL",
              "OFFICE_DOCUMENTS",
              "PDF",
              "ARCHIVE",
              "SCRIPT",
            ]
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-2.03-firewall-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-2.03-firewall-policies.tf"
    excerpts:
      terraform:
        content: |
          
            # Block risky protocols -- unencrypted and tunneling traffic (L2+)
            resource "zia_firewall_filtering_rule" "block_risky_protocols" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH-Block-Risky-Protocols"
            description = "Block unencrypted protocols, tunneling, and unauthorized remote access"
            state       = "ENABLED"
            action      = "BLOCK_DROP"
            order       = 1
          
            nw_services {
              id = [data.zia_firewall_filtering_network_services.ftp.id]
            }
          
            protocols = ["FTP_RULE", "NETBIOS_RULE"]
            }
          
            # Default deny rule -- all traffic not explicitly allowed is blocked (L2+)
            resource "zia_firewall_filtering_rule" "default_deny" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH-Default-Deny"
            description = "Default deny rule -- block all traffic not explicitly permitted"
            state       = "ENABLED"
            action      = "BLOCK_DROP"
            order       = 10000
            }
          
            # Data source: FTP network service for block rule
            data "zia_firewall_filtering_network_services" "ftp" {
            name = "FTP"
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-3.01-application-segments.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-3.01-application-segments.tf"
    excerpts:
      terraform:
        content: |
          
            # Segment group to organize applications by security classification
            resource "zpa_segment_group" "hardened" {
            name            = var.segment_group_name
            description     = "HTH-managed segment group for hardened application access"
            enabled         = true
            policy_migrated = true
            }
          
            # Application segments -- define what internal apps are accessible via ZPA
            resource "zpa_application_segment" "apps" {
            for_each = { for idx, app in var.application_segments : app.name => app }
          
            name             = each.value.name
            description      = each.value.description
            enabled          = true
            health_reporting = "ON_ACCESS"
            bypass_type      = "NEVER"
            is_cname_enabled = true
          
            segment_group_id = zpa_segment_group.hardened.id
          
            domain_names = each.value.domain_names
          
            dynamic "tcp_port_range" {
              for_each = each.value.tcp_port_range
              content {
                from = tcp_port_range.value.from
                to   = tcp_port_range.value.to
              }
            }
          
            server_groups {
              id = [zpa_server_group.hardened.id]
            }
            }
          
            # Server group for App Connector assignment
            resource "zpa_server_group" "hardened" {
            name              = var.server_group_name
            description       = "HTH-managed server group for hardened application access"
            enabled           = true
            dynamic_discovery = true
          
            app_connector_groups {
              id = [var.app_connector_group_name]
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-3.02-access-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-3.02-access-policies.tf"
    excerpts:
      terraform:
        content: |
          
            # Retrieve the global access policy for rule attachment
            data "zpa_policy_type" "access_policy" {
            policy_type = "ACCESS_POLICY"
            }
          
            # Access policy rule -- restrict access to hardened segment group by IdP group
            resource "zpa_policy_access_rule" "hardened_access" {
            count = length(var.scim_group_ids) > 0 ? 1 : 0
          
            name        = "HTH-Hardened-Application-Access"
            description = "Restrict application access to authorized IdP groups only"
            action      = "ALLOW"
            policy_type = data.zpa_policy_type.access_policy.id
            operator    = "AND"
          
            conditions {
              operator = "OR"
          
              operands {
                object_type = "APP_GROUP"
                values      = [zpa_segment_group.hardened.id]
              }
            }
          
            conditions {
              operator = "OR"
          
              dynamic "operands" {
                for_each = var.scim_group_ids
                content {
                  object_type   = "SCIM_GROUP"
                  values        = [operands.value]
                  idp_id        = var.idp_id
                }
              }
            }
            }
          
            # Default deny rule -- block all access not explicitly permitted
            resource "zpa_policy_access_rule" "default_deny" {
            name        = "HTH-Default-Deny"
            description = "Default deny -- block all application access not explicitly allowed"
            action      = "DENY"
            policy_type = data.zpa_policy_type.access_policy.id
            order       = "99"
            }

"3.3":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-3.03-device-posture.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-3.03-device-posture.tf"
    excerpts:
      terraform:
        content: |
          
            # Posture profile: require disk encryption (L2+)
            resource "zpa_posture_profile" "disk_encryption" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name           = "HTH-Require-Disk-Encryption"
            posture_udid   = "zscaler-client-posture-disk-encryption"
            domain         = var.zpa_customer_id
            master_customer_id = var.zpa_customer_id
            }
          
            # Posture profile: require firewall enabled (L2+)
            resource "zpa_posture_profile" "firewall_enabled" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name           = "HTH-Require-Firewall-Enabled"
            posture_udid   = "zscaler-client-posture-firewall"
            domain         = var.zpa_customer_id
            master_customer_id = var.zpa_customer_id
            }
          
            # Posture profile: require minimum OS version (L2+)
            resource "zpa_posture_profile" "os_version" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name           = "HTH-Require-Minimum-OS-Version"
            posture_udid   = "zscaler-client-posture-os-version"
            domain         = var.zpa_customer_id
            master_customer_id = var.zpa_customer_id
            }
          
            # Access policy rule requiring device posture (L2+)
            resource "zpa_policy_access_rule" "require_posture" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH-Require-Device-Posture"
            description = "Require device posture compliance for application access"
            action      = "ALLOW"
            policy_type = data.zpa_policy_type.access_policy.id
            operator    = "AND"
          
            conditions {
              operator = "OR"
          
              operands {
                object_type = "POSTURE"
                lhs         = zpa_posture_profile.disk_encryption[0].posture_udid
                rhs         = "true"
              }
            }
          
            conditions {
              operator = "OR"
          
              operands {
                object_type = "POSTURE"
                lhs         = zpa_posture_profile.firewall_enabled[0].posture_udid
                rhs         = "true"
              }
            }
            }

"5.1":
  terraform:
    lang: "hcl"
    filename: "hth-zscaler-5.01-enable-ssl-inspection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/zscaler/terraform/hth-zscaler-5.01-enable-ssl-inspection.tf"
    excerpts:
      terraform:
        content: |
          
            # SSL inspection rule -- inspect all HTTPS traffic by default
            resource "zia_ssl_inspection_rules" "inspect_all" {
            name        = "HTH-Inspect-All-SSL-Traffic"
            description = "Inspect all SSL/TLS traffic for threat detection and policy enforcement"
            state       = "ENABLED"
            action      = "INSPECT"
            order       = 1
          
            protocols = ["HTTPS_RULE", "SSL_RULE"]
            }
          
            # SSL inspection exception -- bypass certificate-pinned applications
            resource "zia_ssl_inspection_rules" "do_not_inspect" {
            name        = "HTH-Do-Not-Inspect-Exceptions"
            description = "Bypass SSL inspection for certificate-pinned and privacy-sensitive categories"
            state       = "ENABLED"
            action      = "DO_NOT_INSPECT"
            order       = 0
          
            url_categories = var.ssl_do_not_inspect_urls
            }

