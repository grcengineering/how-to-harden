# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-24T15:25:01Z

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-crowdstrike-3.1-prevent-unauthorized-sensor-uninstall.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/crowdstrike/terraform/hth-crowdstrike-3.1-prevent-unauthorized-sensor-uninstall.tf"
    excerpts:
      terraform:
        content: |
            # Sensor update policy with uninstall protection enabled (Windows)
            resource "crowdstrike_sensor_update_policy" "anti_tamper_windows" {
            name                 = "HTH Anti-Tamper - Windows"
            description          = "Enables uninstall protection to prevent unauthorized sensor removal on Windows hosts"
            platform_name        = "Windows"
            enabled              = true
            uninstall_protection = var.uninstall_protection_enabled ? "ENABLED" : "DISABLED"
          
            build = var.sensor_update_canary_build != "" ? var.sensor_update_canary_build : null
          
            schedule = {
              enabled = false
            }
            }
          
            # Sensor update policy with uninstall protection enabled (Linux)
            resource "crowdstrike_sensor_update_policy" "anti_tamper_linux" {
            name                 = "HTH Anti-Tamper - Linux"
            description          = "Enables uninstall protection to prevent unauthorized sensor removal on Linux hosts"
            platform_name        = "Linux"
            enabled              = true
            uninstall_protection = var.uninstall_protection_enabled ? "ENABLED" : "DISABLED"
          
            build = var.sensor_update_canary_build != "" ? var.sensor_update_canary_build : null
          
            schedule = {
              enabled = false
            }
            }
          
            # Sensor update policy with uninstall protection enabled (Mac)
            resource "crowdstrike_sensor_update_policy" "anti_tamper_mac" {
            name                 = "HTH Anti-Tamper - Mac"
            description          = "Enables uninstall protection to prevent unauthorized sensor removal on Mac hosts"
            platform_name        = "Mac"
            enabled              = true
            uninstall_protection = var.uninstall_protection_enabled ? "ENABLED" : "DISABLED"
          
            build = var.sensor_update_canary_build != "" ? var.sensor_update_canary_build : null
          
            schedule = {
              enabled = false
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-crowdstrike-3.2-configure-prevention-policy-hardening.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/crowdstrike/terraform/hth-crowdstrike-3.2-configure-prevention-policy-hardening.tf"
    excerpts:
      terraform:
        content: |
            # Hardened Windows prevention policy
            # ML levels scale with profile: L1=MODERATE, L2=AGGRESSIVE, L3=EXTRA_AGGRESSIVE
            resource "crowdstrike_prevention_policy_windows" "hardened" {
            name        = var.prevention_policy_windows_name
            description = "HTH hardened prevention policy - Profile Level ${var.profile_level}"
            enabled     = true
            host_groups = []
            ioa_rule_groups = []
          
            # Cloud-based machine learning
            cloud_anti_malware = {
              detection  = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Sensor-based machine learning
            sensor_anti_malware = {
              detection  = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Adware and PUP detection
            adware_and_pup = {
              detection  = var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Script-based execution monitoring (PowerShell, VBA, etc.)
            script_based_execution_monitoring = true
          
            # Sensor tamper protection -- always enabled
            sensor_tampering_protection = true
          
            # Quarantine malicious files on write
            quarantine_on_write = true
          
            # Notify end users on detection
            notify_end_users = true
          
            # Volume shadow copy protection (ransomware defense)
            volume_shadow_copy_protect = true
          
            # Memory scanning for in-memory attacks (L2+)
            memory_scanning = var.profile_level >= 2 ? true : false
          
            # Driver load prevention (L2+)
            driver_load_prevention = var.profile_level >= 2 ? true : false
          
            # Vulnerable driver protection requires driver_load_prevention (L2+)
            vulnerable_driver_protection = var.profile_level >= 2 ? true : false
          
            # Extended user mode data for enhanced detection
            extended_user_mode_data = true
            }
          
            # Hardened Linux prevention policy
            resource "crowdstrike_prevention_policy_linux" "hardened" {
            name        = var.prevention_policy_linux_name
            description = "HTH hardened prevention policy - Profile Level ${var.profile_level}"
            enabled     = true
            host_groups = []
            ioa_rule_groups = []
          
            # Cloud-based machine learning
            cloud_anti_malware = {
              detection  = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Sensor-based machine learning
            sensor_anti_malware = {
              detection  = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Script-based execution monitoring (shell/scripting visibility)
            script_based_execution_monitoring = true
          
            # Sensor tamper protection
            sensor_tampering_protection = true
          
            # Block suspicious processes
            prevent_suspicious_processes = true
          
            # Quarantine malicious files
            quarantine = true
          
            # Network visibility (L2+)
            network_visibility = var.profile_level >= 2 ? true : false
          
            # Extended command line visibility (L2+)
            extended_command_line_visibility = var.profile_level >= 2 ? true : false
          
            # Drift prevention for containers (L3)
            drift_prevention = var.profile_level >= 3 ? true : false
            }
          
            # Hardened Mac prevention policy
            resource "crowdstrike_prevention_policy_mac" "hardened" {
            name        = var.prevention_policy_mac_name
            description = "HTH hardened prevention policy - Profile Level ${var.profile_level}"
            enabled     = true
            host_groups = []
            ioa_rule_groups = []
          
            # Cloud-based machine learning
            cloud_anti_malware = {
              detection  = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Sensor-based machine learning
            sensor_anti_malware = {
              detection  = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 3 ? "EXTRA_AGGRESSIVE" : var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Cloud adware and PUP detection
            cloud_adware_and_pup = {
              detection  = var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Sensor adware and PUP detection
            sensor_adware_and_pup = {
              detection  = var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
              prevention = var.profile_level >= 2 ? "AGGRESSIVE" : "MODERATE"
            }
          
            # Script-based execution monitoring
            script_based_execution_monitoring = true
          
            # Sensor tamper protection
            sensor_tampering_protection = true
          
            # Block suspicious processes
            prevent_suspicious_processes = true
          
            # Quarantine malicious files
            quarantine = true
          
            # Quarantine on write
            quarantine_on_write = true
          
            # Notify end users
            notify_end_users = true
            }

"3.3":
  terraform:
    lang: "hcl"
    filename: "hth-crowdstrike-3.3-implement-sensor-grouping-strategy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/crowdstrike/terraform/hth-crowdstrike-3.3-implement-sensor-grouping-strategy.tf"
    excerpts:
      terraform:
        content: |
            # Canary group -- receives updates first for early issue detection (1-5% of fleet)
            resource "crowdstrike_host_group" "canary" {
            name            = "HTH Content-Update-Canary"
            description     = "Canary ring for staged content and sensor updates. Non-production and IT systems for early issue detection."
            type            = "dynamic"
            assignment_rule = var.canary_group_assignment_rule
            }
          
            # Production-Critical group -- domain controllers, databases, payment systems
            resource "crowdstrike_host_group" "production_critical" {
            name            = "HTH Production-Critical"
            description     = "Critical infrastructure: domain controllers, database servers, payment systems. Receives N-1 sensor version and delayed content updates."
            type            = "dynamic"
            assignment_rule = var.production_critical_assignment_rule
            }
          
            # Production-Standard group -- application and web servers
            resource "crowdstrike_host_group" "production_standard" {
            name            = "HTH Production-Standard"
            description     = "Standard production hosts: application servers, web servers. Receives updates after canary validation."
            type            = "dynamic"
            assignment_rule = var.production_standard_assignment_rule
            }
          
            # Workstation group -- end-user devices
            resource "crowdstrike_host_group" "workstation" {
            name            = "HTH Workstations"
            description     = "End-user workstations: executive, engineering, and general user devices."
            type            = "dynamic"
            assignment_rule = var.workstation_assignment_rule
            }
          
            # Early Adopter group (L2+) -- 10% of fleet validates after canary
            resource "crowdstrike_host_group" "early_adopter" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name            = "HTH Early-Adopter"
            description     = "Early adopter ring: ~10% of fleet. Validates updates after canary before broad production rollout."
            type            = "dynamic"
            assignment_rule = "tags:'SensorGroupingTags/early-adopter'"
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-crowdstrike-4.1-implement-staged-content-deployment.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/crowdstrike/terraform/hth-crowdstrike-4.1-implement-staged-content-deployment.tf"
    excerpts:
      terraform:
        content: |
            # Canary ring -- immediate content updates for early issue detection
            resource "crowdstrike_content_update_policy" "canary" {
            name        = "HTH Content Update - Canary Ring"
            description = "Canary ring (1-5%% of fleet): receives content updates immediately for early issue detection. Post-July 2024 lesson: never deploy content to entire fleet simultaneously."
            enabled     = true
            host_groups = [crowdstrike_host_group.canary.id]
          
            # Rapid response content -- immediate for canary
            rapid_response = {
              ring_assignment = "ea"
              delay_hours     = var.canary_content_delay_hours
            }
          
            # Sensor operations -- early access for canary
            sensor_operations = {
              ring_assignment = "ea"
              delay_hours     = var.canary_content_delay_hours
            }
          
            # System critical -- GA with minimal delay
            system_critical = {
              ring_assignment = "ga"
              delay_hours     = var.canary_content_delay_hours
            }
          
            # Vulnerability management -- early access
            vulnerability_management = {
              ring_assignment = "ea"
              delay_hours     = var.canary_content_delay_hours
            }
            }
          
            # Early Adopter ring (L2+) -- 4-hour delay after canary validation
            resource "crowdstrike_content_update_policy" "early_adopter" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "HTH Content Update - Early Adopter Ring"
            description = "Early adopter ring (~10%% of fleet): receives content updates after ${var.early_adopter_content_delay_hours}-hour delay for canary validation."
            enabled     = true
            host_groups = var.profile_level >= 2 ? [crowdstrike_host_group.early_adopter[0].id] : []
          
            rapid_response = {
              ring_assignment = "ga"
              delay_hours     = var.early_adopter_content_delay_hours
            }
          
            sensor_operations = {
              ring_assignment = "ga"
              delay_hours     = var.early_adopter_content_delay_hours
            }
          
            system_critical = {
              ring_assignment = "ga"
              delay_hours     = var.early_adopter_content_delay_hours
            }
          
            vulnerability_management = {
              ring_assignment = "ga"
              delay_hours     = var.early_adopter_content_delay_hours
            }
            }
          
            # Production ring -- 24-48 hour delay for stable deployment
            resource "crowdstrike_content_update_policy" "production" {
            name        = "HTH Content Update - Production Ring"
            description = "Production ring (~85%% of fleet): receives content updates after ${var.production_content_delay_hours}-hour delay. Updates only deploy after canary and early-adopter validation."
            enabled     = true
            host_groups = [
              crowdstrike_host_group.production_standard.id,
              crowdstrike_host_group.workstation.id,
            ]
          
            rapid_response = {
              ring_assignment = "ga"
              delay_hours     = var.production_content_delay_hours
            }
          
            sensor_operations = {
              ring_assignment = "ga"
              delay_hours     = var.production_content_delay_hours
            }
          
            system_critical = {
              ring_assignment = "ga"
              delay_hours     = var.production_content_delay_hours
            }
          
            vulnerability_management = {
              ring_assignment = "ga"
              delay_hours     = var.production_content_delay_hours
            }
            }
          
            # Production-Critical ring -- maximum delay for critical infrastructure
            resource "crowdstrike_content_update_policy" "production_critical" {
            name        = "HTH Content Update - Production Critical Ring"
            description = "Production-critical ring (domain controllers, databases, payment systems): ${var.critical_content_delay_hours}-hour delay. Maximum caution for critical infrastructure."
            enabled     = true
            host_groups = [crowdstrike_host_group.production_critical.id]
          
            rapid_response = {
              ring_assignment = "ga"
              delay_hours     = var.critical_content_delay_hours
            }
          
            sensor_operations = {
              ring_assignment = "ga"
              delay_hours     = var.critical_content_delay_hours
            }
          
            system_critical = {
              ring_assignment = "ga"
              delay_hours     = var.critical_content_delay_hours
            }
          
            vulnerability_management = {
              ring_assignment = "ga"
              delay_hours     = var.critical_content_delay_hours
            }
            }

"4.2":
  terraform:
    lang: "hcl"
    filename: "hth-crowdstrike-4.2-configure-rollback-procedures.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/crowdstrike/terraform/hth-crowdstrike-4.2-configure-rollback-procedures.tf"
    excerpts:
      terraform:
        content: |
            # Sensor update policy for canary ring -- receives latest sensor version first
            resource "crowdstrike_sensor_update_policy" "canary_ring" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name                 = "HTH Sensor Update - Canary Ring"
            description          = "Canary ring: receives latest (N) sensor version immediately. Used for early detection of sensor update issues."
            platform_name        = "Windows"
            enabled              = true
            uninstall_protection = "ENABLED"
          
            build = var.sensor_update_canary_build != "" ? var.sensor_update_canary_build : null
          
            schedule = {
              enabled  = true
              timezone = var.sensor_update_schedule_timezone
              time_blocks = [{
                days       = ["sunday"]
                start_time = "02:00"
                end_time   = "06:00"
              }]
            }
            }
          
            # Sensor update policy for production ring -- N-1 version for stability
            resource "crowdstrike_sensor_update_policy" "production_ring" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name                 = "HTH Sensor Update - Production Ring"
            description          = "Production ring: runs N-1 sensor version for proven stability. Only updates after canary ring validates the newer version."
            platform_name        = "Windows"
            enabled              = true
            uninstall_protection = "ENABLED"
          
            build = var.sensor_update_production_build != "" ? var.sensor_update_production_build : null
          
            schedule = {
              enabled  = true
              timezone = var.sensor_update_schedule_timezone
              time_blocks = [{
                days       = ["saturday"]
                start_time = "02:00"
                end_time   = "06:00"
              }]
            }
            }
          
            # Critical infrastructure sensor update policy -- most conservative (L3)
            resource "crowdstrike_sensor_update_policy" "critical_ring" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name                 = "HTH Sensor Update - Critical Infrastructure"
            description          = "Critical infrastructure ring: runs N-1 sensor version with restricted update windows. Requires manual approval for version changes."
            platform_name        = "Windows"
            enabled              = true
            uninstall_protection = "ENABLED"
          
            build = var.sensor_update_production_build != "" ? var.sensor_update_production_build : null
          
            schedule = {
              enabled  = true
              timezone = var.sensor_update_schedule_timezone
              time_blocks = [{
                days       = ["sunday"]
                start_time = "03:00"
                end_time   = "05:00"
              }]
            }
            }

"5.1":
  terraform:
    lang: "hcl"
    filename: "hth-crowdstrike-5.1-configure-detection-tuning.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/crowdstrike/terraform/hth-crowdstrike-5.1-configure-detection-tuning.tf"
    excerpts:
      terraform:
        content: |
            # Hardened Real Time Response (RTR) policy for Windows
            # Controls what remote response actions are available to responders
            resource "crowdstrike_response_policy" "hardened_windows" {
            name          = "${var.response_policy_name} - Windows"
            description   = "HTH hardened RTR policy: enables essential response capabilities while restricting dangerous operations. Profile Level ${var.profile_level}."
            platform_name = "Windows"
            enabled       = true
          
            # Enable remote host connectivity for responders
            real_time_response = true
          
            # Allow file retrieval from endpoints (forensics)
            get_command = true
          
            # Allow file upload to endpoints (remediation tools)
            put_command = var.profile_level >= 2 ? true : false
          
            # Custom script execution -- L2+ only (requires approval workflows)
            custom_scripts = var.profile_level >= 2 ? true : false
          
            # Executable execution on remote hosts -- L3 only (maximum response capability)
            exec_command = var.profile_level >= 3 ? true : false
            }
          
            # Hardened RTR policy for Linux
            resource "crowdstrike_response_policy" "hardened_linux" {
            name          = "${var.response_policy_name} - Linux"
            description   = "HTH hardened RTR policy for Linux hosts. Profile Level ${var.profile_level}."
            platform_name = "Linux"
            enabled       = true
          
            real_time_response = true
            get_command        = true
            put_command        = var.profile_level >= 2 ? true : false
            custom_scripts     = var.profile_level >= 2 ? true : false
            exec_command       = var.profile_level >= 3 ? true : false
            }
          
            # Hardened RTR policy for Mac
            resource "crowdstrike_response_policy" "hardened_mac" {
            name          = "${var.response_policy_name} - Mac"
            description   = "HTH hardened RTR policy for Mac hosts. Profile Level ${var.profile_level}."
            platform_name = "Mac"
            enabled       = true
          
            real_time_response = true
            get_command        = true
            put_command        = var.profile_level >= 2 ? true : false
            custom_scripts     = var.profile_level >= 2 ? true : false
            exec_command       = var.profile_level >= 3 ? true : false
            }

