# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-19T16:51:47Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-1.01-configure-password-policy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-1.01-configure-password-policy.tf"
    excerpts:
      terraform:
        content: |
            # User policy enforcing password strength, history, and lockout settings
            resource "onelogin_user_security_policy" "password_policy" {
            name = "HTH Password Policy"
          
            # Password complexity requirements
            password_length_min       = var.password_min_length
            password_requires_upper   = true
            password_requires_lower   = true
            password_requires_number  = true
            password_requires_symbol  = true
            password_history_size     = var.password_history_count
            password_expiry_days      = var.password_expiry_days
          
            # Lockout settings
            lock_account_on_consecutive_fails = var.password_max_failed_attempts
            lockout_duration_minutes          = var.password_lockout_duration_minutes
            }
          
            # L2+ stricter password policy with longer minimum length
            resource "onelogin_user_security_policy" "password_policy_hardened" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "HTH Password Policy - Hardened"
          
            password_length_min       = max(var.password_min_length, 14)
            password_requires_upper   = true
            password_requires_lower   = true
            password_requires_number  = true
            password_requires_symbol  = true
            password_history_size     = var.password_history_count
            password_expiry_days      = 60
          
            lock_account_on_consecutive_fails = 3
            lockout_duration_minutes          = 60
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-1.02-configure-session-controls.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-1.02-configure-session-controls.tf"
    excerpts:
      terraform:
        content: |
            # Session timeout and idle controls for all users
            resource "onelogin_user_security_policy" "session_controls" {
            name = "HTH Session Controls"
          
            # Session timeout (minutes)
            session_timeout = var.session_timeout_minutes
          
            # Idle session timeout (minutes)
            inactivity_timeout = var.idle_timeout_minutes
            }
          
            # L2+ stricter session controls with shorter timeouts
            resource "onelogin_user_security_policy" "session_controls_hardened" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "HTH Session Controls - Hardened"
          
            session_timeout    = min(var.session_timeout_minutes, 240)
            inactivity_timeout = min(var.idle_timeout_minutes, 5)
            }
          
            # L3 maximum security: shortest possible session windows
            resource "onelogin_user_security_policy" "session_controls_max" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "HTH Session Controls - Maximum Security"
          
            session_timeout    = 60
            inactivity_timeout = 5
            }

"1.3":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-1.03-enable-self-service-password-reset.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-1.03-enable-self-service-password-reset.tf"
    excerpts:
      terraform:
        content: |
            # Enable self-service password reset with secure recovery methods
            resource "onelogin_user_security_policy" "self_service_reset" {
            name = "HTH Self-Service Password Reset"
          
            # Enable self-service password reset
            allow_password_reset = true
          
            # Require MFA verification before password reset
            require_mfa_for_password_reset = true
          
            # Security question configuration
            security_questions_required = 3
            }
          
            # L2+ disable less-secure recovery methods
            resource "onelogin_user_security_policy" "self_service_reset_hardened" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "HTH Self-Service Password Reset - Hardened"
          
            allow_password_reset           = true
            require_mfa_for_password_reset = true
            security_questions_required    = 3
          
            # Disable SMS-based recovery for stronger security
            allow_sms_password_reset = false
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-2.01-enforce-mfa-for-all-users.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-2.01-enforce-mfa-for-all-users.tf"
    excerpts:
      terraform:
        content: |
            # Authentication factor: OneLogin Protect (push notification)
            resource "onelogin_auth_factor" "onelogin_protect" {
            name        = "OneLogin Protect"
            factor_type = "OneLogin Protect"
            enabled     = true
            }
          
            # Authentication factor: Google Authenticator (TOTP)
            resource "onelogin_auth_factor" "google_authenticator" {
            name        = "Google Authenticator"
            factor_type = "Google Authenticator"
            enabled     = true
            }
          
            # Authentication factor: WebAuthn / FIDO2 (phishing-resistant)
            resource "onelogin_auth_factor" "webauthn" {
            name        = "WebAuthn"
            factor_type = "WebAuthn"
            enabled     = true
            }
          
            # User policy requiring OTP at every login
            resource "onelogin_user_security_policy" "mfa_required" {
            name = var.mfa_policy_name
          
            # Require MFA at login
            otp_auth_required = true
          
            # L1: Allow device trust for 30 days
            # L3: Never trust devices -- require MFA every login
            mfa_device_trust_duration_days = var.profile_level >= 3 ? 0 : 30
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-2.02-configure-smartfactor-authentication.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-2.02-configure-smartfactor-authentication.tf"
    excerpts:
      terraform:
        content: |
            # SmartFactor adaptive MFA policy -- risk-based authentication
            # Only deployed at L2+ (requires Expert plan)
            resource "onelogin_user_security_policy" "smartfactor" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = var.smartfactor_policy_name
          
            # Enable SmartFactor risk-based authentication
            smartfactor_auth_enabled = true
          
            # Risk threshold actions:
            #   Low risk    -> no additional MFA required
            #   Medium risk -> require MFA step-up
            #   High risk   -> block and alert
            smartfactor_low_risk_action    = "allow"
            smartfactor_medium_risk_action = "mfa_required"
            smartfactor_high_risk_action   = "deny"
            }
          
            # L3: Tighten SmartFactor -- require MFA even on low-risk logins
            resource "onelogin_user_security_policy" "smartfactor_max" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "HTH SmartFactor Policy - Maximum Security"
          
            smartfactor_auth_enabled       = true
            smartfactor_low_risk_action    = "mfa_required"
            smartfactor_medium_risk_action = "mfa_required"
            smartfactor_high_risk_action   = "deny"
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-2.03-require-phishing-resistant-mfa-for-admins.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-2.03-require-phishing-resistant-mfa-for-admins.tf"
    excerpts:
      terraform:
        content: |
            # Admin-only policy requiring WebAuthn/FIDO2 for phishing resistance
            # Only deployed at L2+ where admin accounts need strongest protection
            resource "onelogin_user_security_policy" "admin_webauthn" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = var.admin_mfa_policy_name
          
            # Require MFA at every login -- no device trust for admins
            otp_auth_required              = true
            mfa_device_trust_duration_days = 0
          
            # Restrict to WebAuthn/FIDO2 only -- disable weaker factors
            allowed_auth_factor_types = ["WebAuthn"]
            }
          
            # Assign admin policy to each admin user
            resource "onelogin_user_policy_assignment" "admin_webauthn" {
            count = var.profile_level >= 2 ? length(var.admin_user_ids) : 0
          
            user_id   = var.admin_user_ids[count.index]
            policy_id = onelogin_user_security_policy.admin_webauthn[0].id
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-3.01-implement-delegated-administration.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-3.01-implement-delegated-administration.tf"
    excerpts:
      terraform:
        content: |
            # Custom role: Tier 1 Help Desk (password reset and account unlock only)
            resource "onelogin_role" "tier1_helpdesk" {
            count = var.create_custom_roles ? 1 : 0
          
            name = "HTH Tier 1 Help Desk"
            }
          
            # Custom role: Application Administrator (app management, no user admin)
            resource "onelogin_role" "app_admin" {
            count = var.create_custom_roles ? 1 : 0
          
            name = "HTH Application Administrator"
            }
          
            # Custom role: Security Auditor (read-only access for compliance review)
            resource "onelogin_role" "security_auditor" {
            count = var.create_custom_roles ? 1 : 0
          
            name = "HTH Security Auditor"
            }
          
            # L2+ Custom role: Privileged Admin with stricter separation of duties
            resource "onelogin_role" "privileged_admin" {
            count = var.profile_level >= 2 && var.create_custom_roles ? 1 : 0
          
            name = "HTH Privileged Administrator"
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-3.02-configure-ip-address-allowlisting.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-3.02-configure-ip-address-allowlisting.tf"
    excerpts:
      terraform:
        content: |
            # IP address restriction policy -- only allow login from approved networks
            # Only deployed at L2+ for environments requiring network-level access control
            resource "onelogin_user_security_policy" "ip_allowlist" {
            count = var.profile_level >= 2 && var.allowed_ip_addresses != "" ? 1 : 0
          
            name = "HTH IP Allowlist Policy"
          
            # Restrict login to approved IP addresses
            ip_address_restriction  = true
            allowed_ip_addresses    = var.allowed_ip_addresses
            ip_restriction_action   = "deny"
            }
          
            # L3: Block and alert on unauthorized IP access
            resource "onelogin_user_security_policy" "ip_allowlist_max" {
            count = var.profile_level >= 3 && var.allowed_ip_addresses != "" ? 1 : 0
          
            name = "HTH IP Allowlist Policy - Maximum Security"
          
            ip_address_restriction = true
            allowed_ip_addresses   = var.allowed_ip_addresses
            ip_restriction_action  = "deny"
            }

"3.3":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-3.03-protect-privileged-accounts.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-3.03-protect-privileged-accounts.tf"
    excerpts:
      terraform:
        content: |
            # Dedicated admin security policy with enhanced protections
            resource "onelogin_user_security_policy" "admin_protection" {
            name = "HTH Admin Account Protection"
          
            # Shorter session timeout for admin accounts
            session_timeout    = 120
            inactivity_timeout = 10
          
            # Always require MFA -- no device trust for admins
            otp_auth_required              = true
            mfa_device_trust_duration_days = 0
          
            # Stricter lockout for admin accounts
            lock_account_on_consecutive_fails = 3
            lockout_duration_minutes          = 60
            }
          
            # L2+ even stricter admin protections
            resource "onelogin_user_security_policy" "admin_protection_hardened" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "HTH Admin Account Protection - Hardened"
          
            session_timeout    = 60
            inactivity_timeout = 5
          
            otp_auth_required              = true
            mfa_device_trust_duration_days = 0
          
            lock_account_on_consecutive_fails = 3
            lockout_duration_minutes          = 120
          
            # Require IP restriction for admin access
            ip_address_restriction = var.allowed_ip_addresses != "" ? true : false
            allowed_ip_addresses   = var.allowed_ip_addresses
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-4.01-configure-tls-requirements.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-4.01-configure-tls-requirements.tf"
    excerpts:
      terraform:
        content: |
            # SAML connector app template enforcing HTTPS-only ACS URLs
            # This serves as a reference configuration for validating TLS on SSO apps.
            # Actual SAML apps should follow this pattern for their ACS and recipient URLs.
            resource "onelogin_saml_app" "tls_reference" {
            name           = "HTH TLS Reference App"
            description    = "Reference SAML app enforcing HTTPS ACS endpoints"
            connector_id   = 110016
          
            configuration = {
              # All SAML endpoints MUST use HTTPS
              audience   = "https://app.example.com/saml/metadata"
              recipient  = "https://app.example.com/saml/acs"
              acs_url    = "https://app.example.com/saml/acs"
              login_url  = "https://app.example.com/login"
            }
          
            # Require signed SAML assertions
            visible = false
            }

"4.2":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-4.02-configure-brute-force-protection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-4.02-configure-brute-force-protection.tf"
    excerpts:
      terraform:
        content: |
            # Account lockout policy to prevent brute force attacks
            resource "onelogin_user_security_policy" "brute_force_protection" {
            name = "HTH Brute Force Protection"
          
            # Lock account after consecutive failed attempts
            lock_account_on_consecutive_fails = var.password_max_failed_attempts
            lockout_duration_minutes          = var.password_lockout_duration_minutes
            }
          
            # L2+ stricter brute force protection: fewer attempts, longer lockout
            resource "onelogin_user_security_policy" "brute_force_hardened" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "HTH Brute Force Protection - Hardened"
          
            lock_account_on_consecutive_fails = 3
            lockout_duration_minutes          = 60
            }
          
            # L3: most aggressive lockout settings
            resource "onelogin_user_security_policy" "brute_force_max" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "HTH Brute Force Protection - Maximum Security"
          
            lock_account_on_consecutive_fails = 3
            lockout_duration_minutes          = 120
            }

"4.3":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-4.03-configure-device-trust.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-4.03-configure-device-trust.tf"
    excerpts:
      terraform:
        content: |
            # Device trust policy requiring managed device certificates
            # Only deployed at L2+ for environments requiring device posture verification
            resource "onelogin_user_security_policy" "device_trust" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "HTH Device Trust Policy"
          
            # Require trusted/managed devices for login
            device_trust_enabled        = true
            require_managed_device      = true
            require_domain_joined       = true
            require_certificate         = true
            }
          
            # L3: strictest device trust with no exceptions
            resource "onelogin_user_security_policy" "device_trust_max" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "HTH Device Trust Policy - Maximum Security"
          
            device_trust_enabled        = true
            require_managed_device      = true
            require_domain_joined       = true
            require_certificate         = true
            block_untrusted_devices     = true
            }

"5.1":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-5.01-enable-audit-logging.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-5.01-enable-audit-logging.tf"
    excerpts:
      terraform:
        content: |
            # Event webhook for SIEM integration -- exports security events
            resource "onelogin_event_webhook" "siem_export" {
            count = var.siem_webhook_url != "" ? 1 : 0
          
            name    = "HTH SIEM Log Export"
            url     = var.siem_webhook_url
            enabled = true
          
            # Key security events to forward
            event_type_ids = [
              1,   # User login
              2,   # User login failed
              5,   # User password changed
              6,   # User password reset
              7,   # User locked out
              8,   # User unlocked
              10,  # User created
              11,  # User deleted
              12,  # User updated
              14,  # User MFA enrolled
              15,  # User MFA removed
              20,  # Admin login
              21,  # Admin login failed
              30,  # Policy created
              31,  # Policy updated
              32,  # Policy deleted
              40,  # App created
              41,  # App updated
              42,  # App deleted
              50,  # Role created
              51,  # Role updated
              52,  # Role deleted
              60,  # Privilege granted
              61,  # Privilege revoked
            ]
            }
          
            # L2+ additional webhook for high-severity events (separate alerting channel)
            resource "onelogin_event_webhook" "critical_alerts" {
            count = var.profile_level >= 2 && var.siem_webhook_url != "" ? 1 : 0
          
            name    = "HTH Critical Security Alerts"
            url     = var.siem_webhook_url
            enabled = true
          
            # Only high-severity events for immediate alerting
            event_type_ids = [
              2,   # User login failed
              7,   # User locked out
              21,  # Admin login failed
              31,  # Policy updated
              32,  # Policy deleted
              61,  # Privilege revoked
            ]
            }

"5.2":
  terraform:
    lang: "hcl"
    filename: "hth-onelogin-5.02-configure-security-alerts.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/onelogin/terraform/hth-onelogin-5.02-configure-security-alerts.tf"
    excerpts:
      terraform:
        content: |
            # Alert webhook for multiple failed login attempts
            resource "onelogin_event_webhook" "failed_login_alerts" {
            count = var.siem_webhook_url != "" ? 1 : 0
          
            name    = "HTH Failed Login Alerts"
            url     = var.siem_webhook_url
            enabled = true
          
            event_type_ids = [
              2,   # User login failed
              7,   # User locked out
              21,  # Admin login failed
            ]
            }
          
            # Alert webhook for admin privilege changes
            resource "onelogin_event_webhook" "privilege_change_alerts" {
            count = var.siem_webhook_url != "" ? 1 : 0
          
            name    = "HTH Privilege Change Alerts"
            url     = var.siem_webhook_url
            enabled = true
          
            event_type_ids = [
              60,  # Privilege granted
              61,  # Privilege revoked
              50,  # Role created
              51,  # Role updated
              52,  # Role deleted
              30,  # Policy created
              31,  # Policy updated
              32,  # Policy deleted
            ]
            }
          
            # L2+ alert for unusual login patterns
            resource "onelogin_event_webhook" "anomaly_alerts" {
            count = var.profile_level >= 2 && var.siem_webhook_url != "" ? 1 : 0
          
            name    = "HTH Login Anomaly Alerts"
            url     = var.siem_webhook_url
            enabled = true
          
            event_type_ids = [
              2,   # User login failed
              7,   # User locked out
              14,  # User MFA enrolled
              15,  # User MFA removed
              21,  # Admin login failed
            ]
            }

