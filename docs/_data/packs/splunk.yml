# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-20T08:35:23Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-1.1-configure-saml-sso.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-1.1-configure-saml-sso.tf"
    excerpts:
      terraform:
        content: |
            # Configure SAML SSO authentication for centralized identity management.
            # Requires SAML to be enabled by Splunk Cloud Support first.
            # The splunk_configs_conf resource writes to authentication.conf.
          
            # Enable SAML authentication method
            resource "splunk_configs_conf" "auth_saml_settings" {
            count = var.saml_idp_url != "" ? 1 : 0
          
            name = "authentication/authentication"
          
            variables = {
              "authType"    = "SAML"
              "authSettings" = "hth_saml"
            }
            }
          
            # Configure the SAML stanza with IdP settings
            resource "splunk_configs_conf" "auth_saml_idp" {
            count = var.saml_idp_url != "" ? 1 : 0
          
            name = "authentication/hth_saml"
          
            variables = {
              "fqdn"                        = replace(replace(var.splunk_url, "https://", ""), ":8089", "")
              "idpSSOUrl"                   = var.saml_idp_url
              "idpCertPath"                 = var.saml_idp_cert_path
              "entityId"                    = var.saml_entity_id
              "signAuthnRequest"            = "true"
              "signedAssertion"             = "true"
              "attributeQuerySoapPassword"  = ""
              "attributeQueryRequestSigned" = "true"
              "redirectAfterLogoutToUrl"    = var.saml_idp_url
              "nameIdFormat"                = "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"
              "ssoBinding"                  = "HTTPPost"
              "sloBinding"                  = "HTTPPost"
              "role"                        = "role"
              "realName"                    = "realName"
              "mail"                        = "mail"
            }
          
            depends_on = [splunk_configs_conf.auth_saml_settings]
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-1.2-configure-local-admin-fallback.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-1.2-configure-local-admin-fallback.tf"
    excerpts:
      terraform:
        content: |
            # Maintain a local admin account for emergency recovery when SAML is down.
            # This account should use a strong password (20+ chars) stored in a vault.
            # Local login URL: https://<instance>/en-US/account/login?loginType=splunk
          
            resource "splunk_authentication_users" "emergency_admin" {
            count = var.local_admin_password != "" ? 1 : 0
          
            name              = var.local_admin_username
            password          = var.local_admin_password
            force_change_pass = false
            roles             = ["admin"]
            email             = "security-team@example.com"
            realname          = "HTH Emergency Admin"
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-2.1-configure-rbac.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-2.1-configure-rbac.tf"
    excerpts:
      terraform:
        content: |
            # Implement least-privilege RBAC using custom roles.
            # Avoid assigning the built-in admin role directly to users.
            # Map roles through SAML for centralized governance.
          
            # Custom security analyst role with restricted capabilities
            resource "splunk_authorization_roles" "security_analyst" {
            name = var.custom_analyst_role_name
          
            # Minimal capabilities for security analysts
            capabilities = [
              "search",
              "schedule_search",
              "list_inputs",
              "get_metadata",
              "get_typeahead",
              "rest_properties_get",
            ]
          
            # Index access restrictions
            imported_roles    = ["user"]
            default_app       = "search"
            search_indexes_allowed = var.analyst_allowed_indexes
            search_indexes_default = [var.analyst_default_index]
            }
          
            # Restricted power user role (L2+) with tighter capabilities
            resource "splunk_authorization_roles" "restricted_power" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "hth_restricted_power"
          
            capabilities = [
              "search",
              "schedule_search",
              "list_inputs",
              "get_metadata",
              "get_typeahead",
              "rest_properties_get",
              "rtsearch",
              "edit_search_schedule_priority",
            ]
          
            imported_roles    = ["user"]
            default_app       = "search"
            search_indexes_allowed = var.analyst_allowed_indexes
            search_indexes_default = [var.analyst_default_index]
            }
          
            # Read-only auditor role (L2+) for compliance reviewers
            resource "splunk_authorization_roles" "auditor" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "hth_auditor"
          
            capabilities = [
              "search",
              "get_metadata",
              "get_typeahead",
              "rest_properties_get",
              "list_settings",
            ]
          
            imported_roles    = ["user"]
            default_app       = "search"
            search_indexes_allowed = ["_audit", "_internal", var.audit_index_name]
            search_indexes_default = ["_audit"]
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-2.2-configure-index-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-2.2-configure-index-access.tf"
    excerpts:
      terraform:
        content: |
            # Create dedicated indexes for security data with appropriate access controls.
            # Restrict sensitive indexes to the security team through role-based access.
          
            # Dedicated security log index
            resource "splunk_indexes" "security" {
            name               = var.security_index_name
            datatype           = "event"
            max_hot_buckets    = 10
            max_data_size      = var.security_index_max_data_size
            frozen_time_period_in_secs = var.security_index_frozen_time_period
            }
          
            # Audit trail index with extended retention (L1)
            resource "splunk_indexes" "audit_trail" {
            name               = var.audit_index_name
            datatype           = "event"
            max_hot_buckets    = 6
            max_data_size      = var.security_index_max_data_size
            frozen_time_period_in_secs = var.audit_index_frozen_time_period
            }
          
            # Threat intelligence index (L2+)
            resource "splunk_indexes" "threat_intel" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name               = "threat_intel"
            datatype           = "event"
            max_hot_buckets    = 3
            max_data_size      = "auto"
            frozen_time_period_in_secs = 31536000  # 1 year
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-3.1-configure-search-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-3.1-configure-search-security.tf"
    excerpts:
      terraform:
        content: |
            # Control what data users can search and enforce search quotas.
            # Prevents resource abuse and limits data exposure.
          
            # Search quota limits for standard users via limits.conf
            resource "splunk_configs_conf" "search_limits_standard" {
            name = "limits/restapi"
          
            variables = {
              "maxresultrows" = "50000"
            }
            }
          
            # Configure search concurrency limits
            resource "splunk_configs_conf" "search_scheduler_limits" {
            name = "limits/scheduler"
          
            variables = {
              "max_searches_perc"         = "50"
              "auto_summary_perc"         = "50"
              "max_action_results"        = "50000"
            }
            }
          
            # L2: Tighter search time window restrictions
            resource "splunk_configs_conf" "search_limits_hardened" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "limits/search"
          
            variables = {
              "max_searches_per_cpu"        = "1"
              "search_process_mode"         = "auto"
              "max_rt_search_multiplier"    = "1"
              "dispatch_dir_warning_size"   = "500"
            }
            }
          
            # L3: Maximum search restrictions
            resource "splunk_configs_conf" "search_limits_maximum" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "limits/searchresults"
          
            variables = {
              "maxresultrows"               = "10000"
              "max_count"                   = "10000"
              "compress_rawdata"            = "true"
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-3.2-configure-encryption.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-3.2-configure-encryption.tf"
    excerpts:
      terraform:
        content: |
            # Ensure data encryption in transit and at rest.
            # Splunk Cloud uses TLS by default; these settings harden the configuration.
          
            # Enforce TLS on HTTP Event Collector
            resource "splunk_global_http_event_collector" "hec_ssl" {
            disabled   = false
            enable_ssl = var.hec_enable_ssl
            port       = var.hec_port
            }
          
            # Enforce TLS settings in server.conf (L2+)
            resource "splunk_configs_conf" "ssl_hardening" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "server/sslConfig"
          
            variables = {
              "sslVersions"                 = "tls1.2"
              "sslVersionsForClient"        = "tls1.2"
              "cipherSuite"                 = "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"
              "ecdhCurves"                  = "prime256v1, secp384r1, secp521r1"
              "allowSslRenegotiation"       = "false"
              "requireClientCert"           = "false"
              "sslVerifyServerCert"         = "true"
              "sendStrictTransportSecurity" = "true"
            }
            }
          
            # Enforce TLS on web.conf for UI access (L2+)
            resource "splunk_configs_conf" "web_ssl_hardening" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = "web/settings"
          
            variables = {
              "enableSplunkWebSSL"       = "true"
              "cipherSuite"              = "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"
              "ecdhCurves"               = "prime256v1, secp384r1, secp521r1"
              "sendStrictTransportSecurityHeader" = "true"
            }
            }
          
            # L3: Force TLS 1.3 only where supported
            resource "splunk_configs_conf" "tls13_enforcement" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "server/sslConfig"
          
            variables = {
              "sslVersions"          = "tls1.3"
              "sslVersionsForClient" = "tls1.3"
            }
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-splunk-4.1-configure-audit-logging.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/splunk/terraform/hth-splunk-4.1-configure-audit-logging.tf"
    excerpts:
      terraform:
        content: |
            # Monitor administrative and security events through the _audit index.
            # Configure saved searches for audit alerting on critical actions.
          
            # Enable audit trail forwarding to dedicated index
            resource "splunk_configs_conf" "audit_trail_inputs" {
            name = "inputs/monitor:///opt/splunk/var/log/splunk/audit.log"
          
            variables = {
              "disabled"   = "false"
              "index"      = var.audit_index_name
              "sourcetype" = "splunk_audit"
            }
            }
          
            # Saved search: Alert on admin role changes (L1)
            resource "splunk_saved_searches" "alert_role_changes" {
            name    = "HTH - Admin Role Changes"
            search  = "index=_audit action=edit_roles OR action=edit_user | stats count by user, action, info"
          
            is_scheduled  = true
            is_visible    = true
            cron_schedule = "*/15 * * * *"
          
            actions               = "email"
            action_email_to       = "security-team@example.com"
            action_email_subject  = "HTH Alert: Splunk Role Change Detected"
          
            alert_type            = "number of events"
            alert_comparator      = "greater than"
            alert_threshold       = "0"
          
            dispatch_earliest_time = "-15m"
            dispatch_latest_time   = "now"
            }
          
            # Saved search: Alert on failed authentications (L1)
            resource "splunk_saved_searches" "alert_failed_auth" {
            name    = "HTH - Failed Authentication Attempts"
            search  = "index=_audit action=login status=failure | stats count by user, src | where count > 5"
          
            is_scheduled  = true
            is_visible    = true
            cron_schedule = "*/10 * * * *"
          
            actions               = "email"
            action_email_to       = "security-team@example.com"
            action_email_subject  = "HTH Alert: Multiple Failed Splunk Logins"
          
            alert_type            = "number of events"
            alert_comparator      = "greater than"
            alert_threshold       = "0"
          
            dispatch_earliest_time = "-10m"
            dispatch_latest_time   = "now"
            }
          
            # Saved search: Alert on configuration changes (L2+)
            resource "splunk_saved_searches" "alert_config_changes" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name    = "HTH - Configuration Changes"
            search  = "index=_internal sourcetype=splunkd component=ModifyConfig | stats count by user, action, object"
          
            is_scheduled  = true
            is_visible    = true
            cron_schedule = "*/30 * * * *"
          
            actions               = "email"
            action_email_to       = "security-team@example.com"
            action_email_subject  = "HTH Alert: Splunk Configuration Modified"
          
            alert_type            = "number of events"
            alert_comparator      = "greater than"
            alert_threshold       = "0"
          
            dispatch_earliest_time = "-30m"
            dispatch_latest_time   = "now"
            }
          
            # Saved search: Alert on search of sensitive indexes (L2+)
            resource "splunk_saved_searches" "alert_sensitive_search" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name    = "HTH - Sensitive Index Access"
            search  = "index=_audit action=search info=granted search=*${var.security_index_name}* NOT user=splunk-system-user | stats count by user, search"
          
            is_scheduled  = true
            is_visible    = true
            cron_schedule = "*/60 * * * *"
          
            actions               = "email"
            action_email_to       = "security-team@example.com"
            action_email_subject  = "HTH Alert: Sensitive Index Searched"
          
            alert_type            = "number of events"
            alert_comparator      = "greater than"
            alert_threshold       = "0"
          
            dispatch_earliest_time = "-60m"
            dispatch_latest_time   = "now"
            }

