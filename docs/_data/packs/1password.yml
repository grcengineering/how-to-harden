# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-18T20:45:16Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-1password-1.1-configure-sso-with-identity-provider.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-1.1-configure-sso-with-identity-provider.tf"
    excerpts:
      terraform:
        content: |
          
            # Verify SSO configuration is active using the 1Password CLI.
            # The op CLI must be installed and authenticated with a service account.
            resource "null_resource" "verify_sso_configuration" {
            count = var.idp_sso_url != "" ? 1 : 0
          
            triggers = {
              idp_sso_url    = var.idp_sso_url
              idp_entity_id  = var.idp_entity_id
              profile_level  = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "============================================="
                echo "HTH 1Password Control 1.1: SSO Configuration"
                echo "============================================="
                echo ""
                echo "SSO must be configured in the 1Password Admin Console:"
                echo "  1. Navigate to: Security > Sign-in"
                echo "  2. Click 'Set up Single Sign-On'"
                echo "  3. Select SAML authentication"
                echo "  4. IdP SSO URL: ${var.idp_sso_url}"
                echo "  5. IdP Entity ID: ${var.idp_entity_id}"
                echo ""
                echo "Verifying 1Password CLI availability..."
                if command -v op &> /dev/null; then
                  echo "op CLI found: $(op --version)"
                  echo "Checking account details..."
                  op account list --format=json 2>/dev/null || echo "WARNING: op CLI not signed in"
                else
                  echo "WARNING: 1Password CLI (op) not found."
                  echo "Install from: https://developer.1password.com/docs/cli/"
                fi
                echo ""
                echo "SSO Unlock Options (configure per profile level):"
                echo "  L1: Biometrics + Master Password"
                echo "  L2: Biometrics + Master Password (enforce MFA via IdP)"
                echo "  L3: Master Password only (no biometric unlock)"
              EOT
            }
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-1password-1.2-configure-scim-provisioning.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-1.2-configure-scim-provisioning.tf"
    excerpts:
      terraform:
        content: |
          
            # Verify SCIM bridge connectivity and health (L2+ only).
            resource "null_resource" "verify_scim_provisioning" {
            count = var.profile_level >= 2 && var.scim_bridge_url != "" ? 1 : 0
          
            triggers = {
              scim_bridge_url = var.scim_bridge_url
              profile_level   = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "============================================="
                echo "HTH 1Password Control 1.2: SCIM Provisioning"
                echo "============================================="
                echo ""
                echo "SCIM Bridge URL: ${var.scim_bridge_url}"
                echo ""
                echo "Verifying SCIM bridge health..."
                HEALTH_RESPONSE=$(curl -sf "${var.scim_bridge_url}/health" 2>/dev/null)
                if [ $? -eq 0 ]; then
                  echo "SCIM bridge is healthy: $HEALTH_RESPONSE"
                else
                  echo "WARNING: SCIM bridge health check failed."
                  echo "Ensure the SCIM bridge is deployed and accessible."
                  echo ""
                  echo "Deployment options:"
                  echo "  - Docker: https://support.1password.com/scim-deploy-docker/"
                  echo "  - Kubernetes: https://support.1password.com/scim-deploy-k8s/"
                  echo "  - AWS ECS: https://support.1password.com/scim-deploy-aws/"
                  echo "  - Google Cloud Run: https://support.1password.com/scim-deploy-gcp/"
                fi
                echo ""
                echo "Required SCIM provisioning features:"
                echo "  - Create users"
                echo "  - Update user attributes"
                echo "  - Deactivate users (removes 1Password access)"
                echo "  - Sync groups to 1Password groups"
              EOT
            }
            }
          
            # Store SCIM bridge configuration reference in a dedicated vault item.
            resource "onepassword_item" "scim_bridge_config" {
            count = var.profile_level >= 2 && var.scim_bridge_url != "" ? 1 : 0
          
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "SCIM Bridge Configuration"
            category = "secure_note"
          
            section {
              label = "SCIM Bridge Details"
          
              field {
                label = "SCIM Bridge URL"
                value = var.scim_bridge_url
                type  = "STRING"
              }
          
              field {
                label = "Status"
                value = "Active"
                type  = "STRING"
              }
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "scim", "infrastructure"]
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-1password-2.1-configure-account-password-policy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-2.1-configure-account-password-policy.tf"
    excerpts:
      terraform:
        content: |
          
            # Document and verify password policy configuration.
            resource "null_resource" "verify_password_policy" {
            triggers = {
              profile_level  = var.profile_level
              min_length     = var.master_password_min_length
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 2.1: Account Password Policy"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Required password policy settings:"
                echo "  Navigate to: Admin Console > Security > Policies > Account Password"
                echo ""
                if [ "${var.profile_level}" -eq 1 ]; then
                  echo "  L1 (Baseline):"
                  echo "    Minimum length: 10+ characters"
                  echo "    Policy strength: Minimum or higher"
                elif [ "${var.profile_level}" -eq 2 ]; then
                  echo "  L2 (Hardened):"
                  echo "    Minimum length: 12+ characters"
                  echo "    Policy strength: Medium or higher"
                else
                  echo "  L3 (Maximum Security):"
                  echo "    Minimum length: 14+ characters"
                  echo "    Policy strength: Strict"
                  echo "    Additional: uppercase, lowercase, numbers, symbols"
                fi
                echo ""
                echo "Configured minimum length variable: ${var.master_password_min_length}"
              EOT
            }
            }
          
            # Store password policy audit record as a secure note.
            resource "onepassword_item" "password_policy_audit" {
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH Password Policy Configuration"
            category = "secure_note"
          
            section {
              label = "Policy Settings"
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
          
              field {
                label = "Minimum Password Length"
                value = tostring(var.master_password_min_length)
                type  = "STRING"
              }
          
              field {
                label = "Policy Strength"
                value = var.profile_level >= 3 ? "Strict (14+)" : var.profile_level >= 2 ? "Medium (12+)" : "Minimum (10+)"
                type  = "STRING"
              }
          
              field {
                label = "Last Verified"
                value = timestamp()
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "password-policy", "audit"]
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-1password-2.2-configure-firewall-rules.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-2.2-configure-firewall-rules.tf"
    excerpts:
      terraform:
        content: |
          
            # Document and verify firewall rule configuration (L2+ only).
            resource "null_resource" "verify_firewall_rules" {
            count = var.profile_level >= 2 ? 1 : 0
          
            triggers = {
              profile_level     = var.profile_level
              allowed_countries = join(",", var.allowed_countries)
              denied_countries  = join(",", var.denied_countries)
              allowed_ips       = join(",", var.allowed_ip_cidrs)
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 2.2: Firewall Rules"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Navigate to: Admin Console > Security > Firewall"
                echo ""
                echo "Required firewall rules (in priority order):"
                echo ""
                echo "  Rule 1 - Allow Countries: ${join(", ", var.allowed_countries)}"
                echo "  Rule 2 - Deny Countries:  ${join(", ", var.denied_countries)}"
                %{if var.profile_level >= 3~}
                echo ""
                echo "  L3 Additional Rules:"
                echo "  Rule 3 - Allow IPs: ${join(", ", var.allowed_ip_cidrs)}"
                echo "  Rule 4 - Deny all other countries"
                %{endif~}
                echo ""
                echo "WARNING: Test firewall rules thoroughly before enforcing."
                echo "Lockout risk: ensure admin IPs are always allowed."
              EOT
            }
            }
          
            # Store firewall configuration audit record (L2+ only).
            resource "onepassword_item" "firewall_rules_audit" {
            count = var.profile_level >= 2 ? 1 : 0
          
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH Firewall Rules Configuration"
            category = "secure_note"
          
            section {
              label = "Firewall Settings"
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
          
              field {
                label = "Allowed Countries"
                value = join(", ", var.allowed_countries)
                type  = "STRING"
              }
          
              field {
                label = "Denied Countries"
                value = join(", ", var.denied_countries)
                type  = "STRING"
              }
          
              field {
                label = "IP Allowlist"
                value = length(var.allowed_ip_cidrs) > 0 ? join(", ", var.allowed_ip_cidrs) : "Not configured"
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "firewall", "network-security"]
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-1password-2.3-configure-team-member-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-2.3-configure-team-member-policies.tf"
    excerpts:
      terraform:
        content: |
          
            # Document and verify team member policy configuration.
            resource "null_resource" "verify_team_policies" {
            triggers = {
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 2.3: Team Member Policies"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Navigate to: Admin Console > Policies"
                echo ""
                echo "Required policy settings:"
                echo ""
                echo "  Vault Creation:"
                if [ "${var.profile_level}" -ge 2 ]; then
                  echo "    Restrict to admins only (L2+)"
                else
                  echo "    Allow for team members (L1 default)"
                fi
                echo ""
                echo "  External Sharing:"
                if [ "${var.profile_level}" -ge 2 ]; then
                  echo "    Require approval for external sharing (L2+)"
                else
                  echo "    Configure external sharing restrictions"
                fi
                if [ "${var.profile_level}" -ge 3 ]; then
                  echo "    Disable external sharing entirely (L3)"
                fi
                echo ""
                echo "  Travel Mode:"
                echo "    Enable Travel Mode capability"
                if [ "${var.profile_level}" -ge 2 ]; then
                  echo "    Restrict vault visibility during travel (L2+)"
                fi
                echo ""
                echo "  Account Recovery:"
                echo "    Enable recovery group"
                if [ "${var.profile_level}" -ge 2 ]; then
                  echo "    Limit recovery group to designated admins (L2+)"
                fi
              EOT
            }
            }
          
            # Store team policy audit record.
            resource "onepassword_item" "team_policies_audit" {
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH Team Member Policies Configuration"
            category = "secure_note"
          
            section {
              label = "Policy Settings"
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
          
              field {
                label = "Vault Creation"
                value = var.profile_level >= 2 ? "Admins only" : "Team members allowed"
                type  = "STRING"
              }
          
              field {
                label = "External Sharing"
                value = var.profile_level >= 3 ? "Disabled" : var.profile_level >= 2 ? "Approval required" : "Restricted"
                type  = "STRING"
              }
          
              field {
                label = "Travel Mode"
                value = "Enabled"
                type  = "STRING"
              }
          
              field {
                label = "Recovery Group"
                value = var.profile_level >= 2 ? "Designated admins only" : "Enabled"
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "team-policies", "audit"]
            }

"2.4":
  terraform:
    lang: "hcl"
    filename: "hth-1password-2.4-implement-role-based-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-2.4-implement-role-based-access.tf"
    excerpts:
      terraform:
        content: |
          
            # Document and verify RBAC configuration.
            resource "null_resource" "verify_rbac" {
            triggers = {
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 2.4: Role-Based Access"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Navigate to: Admin Console > Team Members"
                echo ""
                echo "Required role assignments:"
                echo ""
                echo "  Owner:       1-2 people maximum (break-glass only)"
                echo "  Admin:       IT administrators for team management"
                echo "  Team Member: Standard users"
                echo "  Guest:       Limited external access (minimize usage)"
                echo ""
                if [ "${var.profile_level}" -ge 2 ]; then
                  echo "  L2+ Requirements:"
                  echo "    - Document all Owner/Admin assignments"
                  echo "    - Review role assignments quarterly"
                  echo "    - Remove Guest access when no longer needed"
                fi
                if [ "${var.profile_level}" -ge 3 ]; then
                  echo ""
                  echo "  L3 Requirements (Enterprise):"
                  echo "    - Create custom roles for specific needs"
                  echo "    - Enforce separation of duties"
                  echo "    - Monthly role review cadence"
                fi
              EOT
            }
            }
          
            # Store RBAC audit record with role inventory.
            resource "onepassword_item" "rbac_audit" {
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH Role-Based Access Inventory"
            category = "secure_note"
          
            section {
              label = "RBAC Configuration"
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
          
              field {
                label = "Owner Limit"
                value = "1-2 personnel maximum"
                type  = "STRING"
              }
          
              field {
                label = "Review Cadence"
                value = var.profile_level >= 3 ? "Monthly" : var.profile_level >= 2 ? "Quarterly" : "Semi-annually"
                type  = "STRING"
              }
          
              field {
                label = "Custom Roles"
                value = var.profile_level >= 3 ? "Required (Enterprise)" : "Not applicable"
                type  = "STRING"
              }
          
              field {
                label = "Last Verified"
                value = timestamp()
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "rbac", "access-control"]
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-1password-3.1-configure-vault-permissions.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-3.1-configure-vault-permissions.tf"
    excerpts:
      terraform:
        content: |
          
            # Infrastructure vault -- server credentials, API keys, infrastructure secrets.
            # Access: IT/DevOps group only.
            resource "onepassword_vault" "infrastructure" {
            count = 1
          
            name        = "Infrastructure"
            description = "Server credentials, API keys, and infrastructure secrets -- managed by HTH hardening pack"
            }
          
            # Team Shared vault -- shared team credentials and service accounts.
            # Access: Designated team groups.
            resource "onepassword_vault" "team_shared" {
            count = 1
          
            name        = "Team Shared"
            description = "Shared team credentials and service accounts -- managed by HTH hardening pack"
            }
          
            # Executive vault -- sensitive business credentials.
            # Access: Executives only (L2+ enforced).
            resource "onepassword_vault" "executive" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "Executive"
            description = "Sensitive business credentials -- restricted access -- managed by HTH hardening pack"
            }
          
            # Security vault -- security tools, certificates, and compliance credentials.
            # Access: Security team only (L2+ enforced).
            resource "onepassword_vault" "security" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name        = "Security"
            description = "Security tool credentials, certificates, and compliance items -- managed by HTH hardening pack"
            }
          
            # Break-glass vault -- emergency access credentials.
            # Access: Owners only (L3 enforced).
            resource "onepassword_vault" "break_glass" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name        = "Break Glass - Emergency Access"
            description = "Emergency access credentials -- Owner access only -- managed by HTH hardening pack"
            }
          
            # Document vault permission requirements per profile level.
            resource "null_resource" "verify_vault_permissions" {
            triggers = {
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 3.1: Vault Permissions"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Vault structure created:"
                echo ""
                echo "  | Vault              | Purpose                      | Access            |"
                echo "  |--------------------|------------------------------|-------------------|"
                echo "  | Employee Private   | Personal items               | Individual only   |"
                echo "  | Infrastructure     | Server/API credentials       | IT/DevOps group   |"
                echo "  | Team Shared        | Team credentials             | Team group        |"
                %{if var.profile_level >= 2~}
                echo "  | Executive          | Sensitive business           | Executives only   |"
                echo "  | Security           | Security tools/certs         | Security team     |"
                %{endif~}
                %{if var.profile_level >= 3~}
                echo "  | Break Glass        | Emergency access             | Owners only       |"
                %{endif~}
                echo ""
                echo "IMPORTANT: Assign vault permissions via Admin Console > Vaults"
                echo "  - Use groups for scalable permission management"
                echo "  - Follow least privilege: View < Edit < Manage"
                echo "  - Review vault access quarterly"
              EOT
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-1password-3.2-configure-item-sharing-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-3.2-configure-item-sharing-policies.tf"
    excerpts:
      terraform:
        content: |
          
            # Document and verify item sharing policy configuration (L2+ only).
            resource "null_resource" "verify_sharing_policies" {
            count = var.profile_level >= 2 ? 1 : 0
          
            triggers = {
              profile_level       = var.profile_level
              allow_item_sharing  = tostring(var.allow_item_sharing)
              allow_guest_sharing = tostring(var.allow_guest_sharing)
              link_expiry_hours   = var.share_link_expiry_hours
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 3.2: Item Sharing Policies"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Navigate to: Admin Console > Policies > Sharing"
                echo ""
                echo "Required sharing policy settings:"
                echo ""
                echo "  Allow item sharing:       ${var.allow_item_sharing}"
                echo "  Allow sharing with guests: ${var.allow_guest_sharing}"
                echo ""
                if [ "${var.profile_level}" -ge 2 ]; then
                  echo "  L2 Requirements:"
                  echo "    - Disable guest sharing or require approval"
                  echo "    - Configure share link expiration: ${var.share_link_expiry_hours}h"
                fi
                if [ "${var.profile_level}" -ge 3 ]; then
                  echo ""
                  echo "  L3 Requirements:"
                  echo "    - Disable share links entirely, OR:"
                  echo "    - Maximum link expiration: 24 hours"
                  echo "    - Require view limits on all share links"
                  echo "    - Disable guest access completely"
                fi
              EOT
            }
            }
          
            # Store sharing policy audit record (L2+ only).
            resource "onepassword_item" "sharing_policies_audit" {
            count = var.profile_level >= 2 ? 1 : 0
          
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH Item Sharing Policies Configuration"
            category = "secure_note"
          
            section {
              label = "Sharing Settings"
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
          
              field {
                label = "Item Sharing"
                value = var.allow_item_sharing ? "Allowed" : "Disabled"
                type  = "STRING"
              }
          
              field {
                label = "Guest Sharing"
                value = var.allow_guest_sharing ? "Allowed" : "Disabled"
                type  = "STRING"
              }
          
              field {
                label = "Share Link Expiry"
                value = var.profile_level >= 3 ? "24 hours (or disabled)" : "${var.share_link_expiry_hours} hours"
                type  = "STRING"
              }
          
              field {
                label = "View Limits"
                value = var.profile_level >= 3 ? "Required" : "Optional"
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "sharing-policy", "data-protection"]
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-1password-4.1-enable-audit-logging.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-4.1-enable-audit-logging.tf"
    excerpts:
      terraform:
        content: |
          
            # Verify Events API / SIEM integration connectivity.
            resource "null_resource" "verify_audit_logging" {
            triggers = {
              profile_level = var.profile_level
              siem_endpoint = var.siem_endpoint
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 4.1: Audit Logging"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Activity Log (built-in):"
                echo "  Navigate to: Admin Console > Reports > Activity Log"
                echo "  Logged events include:"
                echo "    - Sign-in events"
                echo "    - Vault access"
                echo "    - Item changes"
                echo "    - Admin actions"
                echo ""
                if [ -n "${var.siem_endpoint}" ]; then
                  echo "SIEM Integration:"
                  echo "  Endpoint: ${var.siem_endpoint}"
                  echo ""
                  echo "  Verifying SIEM endpoint connectivity..."
                  RESPONSE=$(curl -sf -o /dev/null -w "%%{http_code}" "${var.siem_endpoint}" 2>/dev/null)
                  if [ "$RESPONSE" = "200" ] || [ "$RESPONSE" = "401" ] || [ "$RESPONSE" = "403" ]; then
                    echo "  SIEM endpoint reachable (HTTP $RESPONSE)"
                  else
                    echo "  WARNING: SIEM endpoint may be unreachable (HTTP $RESPONSE)"
                  fi
                else
                  echo "SIEM Integration: Not configured"
                  echo "  To enable, set var.siem_endpoint and var.events_api_token"
                  echo ""
                  echo "  Supported SIEM platforms:"
                  echo "    - Splunk (via Events API)"
                  echo "    - Azure Sentinel"
                  echo "    - Generic webhook"
                fi
                echo ""
                echo "Events API configuration:"
                echo "  Navigate to: Integrations > Events"
                echo "  Configure event streaming to your SIEM"
                echo "  Select events to stream based on profile level:"
                echo "    L1: Sign-in events, admin actions"
                echo "    L2: All L1 + vault access, item changes"
                echo "    L3: All L2 + all available event types"
              EOT
            }
            }
          
            # Store SIEM integration configuration reference.
            resource "onepassword_item" "siem_integration_config" {
            count = var.siem_endpoint != "" ? 1 : 0
          
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH SIEM Integration Configuration"
            category = "secure_note"
          
            section {
              label = "SIEM Settings"
          
              field {
                label = "SIEM Endpoint"
                value = var.siem_endpoint
                type  = "STRING"
              }
          
              field {
                label = "Events API Token"
                value = "Stored separately -- see 1Password admin"
                type  = "STRING"
              }
          
              field {
                label = "Event Types"
                value = var.profile_level >= 3 ? "All events" : var.profile_level >= 2 ? "Sign-ins, admin actions, vault access, item changes" : "Sign-ins, admin actions"
                type  = "STRING"
              }
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "audit-logging", "siem"]
            }

"4.2":
  terraform:
    lang: "hcl"
    filename: "hth-1password-4.2-monitor-security-dashboard.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/1password/terraform/hth-1password-4.2-monitor-security-dashboard.tf"
    excerpts:
      terraform:
        content: |
          
            # Document security dashboard review requirements.
            resource "null_resource" "verify_security_dashboard" {
            triggers = {
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                echo "======================================================="
                echo "HTH 1Password Control 4.2: Security Dashboard"
                echo "======================================================="
                echo ""
                echo "Profile Level: ${var.profile_level}"
                echo ""
                echo "Navigate to: Admin Console > Security"
                echo ""
                echo "Watchtower Monitoring Checklist:"
                echo "  [ ] Compromised passwords identified and remediated"
                echo "  [ ] Weak passwords flagged for rotation"
                echo "  [ ] Reused passwords identified across vaults"
                echo "  [ ] 2FA adoption tracked and improving"
                echo ""
                echo "Review cadence by profile level:"
                if [ "${var.profile_level}" -ge 3 ]; then
                  echo "  L3: Weekly review required"
                  echo "    - Zero tolerance for compromised passwords"
                  echo "    - 100% 2FA adoption target"
                  echo "    - Automated alerts for new Watchtower findings"
                elif [ "${var.profile_level}" -ge 2 ]; then
                  echo "  L2: Bi-weekly review required"
                  echo "    - Compromised passwords remediated within 24h"
                  echo "    - 95% 2FA adoption target"
                else
                  echo "  L1: Monthly review required"
                  echo "    - Compromised passwords remediated within 72h"
                  echo "    - Track 2FA adoption progress"
                fi
                echo ""
                echo "Action items for findings:"
                echo "  1. Notify users of compromised passwords"
                echo "  2. Enforce password updates for weak items"
                echo "  3. Track 2FA adoption progress toward target"
              EOT
            }
            }
          
            # Store security dashboard review baseline.
            resource "onepassword_item" "security_dashboard_baseline" {
            vault    = onepassword_vault.infrastructure[0].uuid
            title    = "HTH Security Dashboard Review Baseline"
            category = "secure_note"
          
            section {
              label = "Review Configuration"
          
              field {
                label = "Profile Level"
                value = tostring(var.profile_level)
                type  = "STRING"
              }
          
              field {
                label = "Review Cadence"
                value = var.profile_level >= 3 ? "Weekly" : var.profile_level >= 2 ? "Bi-weekly" : "Monthly"
                type  = "STRING"
              }
          
              field {
                label = "Compromised Password SLA"
                value = var.profile_level >= 3 ? "Immediate" : var.profile_level >= 2 ? "24 hours" : "72 hours"
                type  = "STRING"
              }
          
              field {
                label = "2FA Adoption Target"
                value = var.profile_level >= 3 ? "100%" : var.profile_level >= 2 ? "95%" : "Track progress"
                type  = "STRING"
              }
          
              field {
                label = "Baseline Established"
                value = timestamp()
                type  = "STRING"
              }
            }
          
            tags = ["hth-hardening", "security-dashboard", "watchtower"]
            }

