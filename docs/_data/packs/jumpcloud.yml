# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-17T11:56:13Z

"1.1":
  api:
    lang: "bash"
    filename: "hth-jumpcloud-1.01-secure-admin-portal-access.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/api/hth-jumpcloud-1.01-secure-admin-portal-access.sh"
    excerpts:
      api-enforce-admin-mfa:
        content: |
            # Require MFA for all admin portal logins
            ORG_ID=$(jc_get_v1 "/organizations" | jq -r '.[0].id // empty')
            if [ -z "${ORG_ID}" ]; then
            fail "1.1 Unable to determine organization ID"
            increment_failed; summary; exit 0
            fi
          
            CURRENT=$(jc_get_v1 "/organizations/${ORG_ID}" | jq -r '.settings.requireAdminMFA')
            info "1.1 Current admin MFA requirement: ${CURRENT}"
          
            if [ "${CURRENT}" = "true" ]; then
            pass "1.1 Admin MFA already required"
            increment_applied
            else
            info "1.1 Enabling admin MFA requirement..."
            RESPONSE=$(jc_put_v1 "/organizations/${ORG_ID}" '{
              "settings": {
                "requireAdminMFA": true
              }
            }') || {
              fail "1.1 Failed to enable admin MFA"
              increment_failed; summary; exit 0
            }
            RESULT=$(echo "${RESPONSE}" | jq -r '.settings.requireAdminMFA')
            [ "${RESULT}" = "true" ] && { pass "1.1 Admin MFA requirement enabled"; increment_applied; } || { fail "1.1 Admin MFA not confirmed"; increment_failed; }
            fi
  sigma:
    - lang: "yaml"
      filename: "hth-jumpcloud-1.01-secure-admin-portal-access.yml"
      source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/siem/sigma/hth-jumpcloud-1.01-secure-admin-portal-access.yml"
      excerpts:
        detection:
          content: |
              detection:
                selection:
                    event_type: 'admin_login_attempt'
                filter_failure:
                    success: false
                condition: selection and filter_failure
              fields:
                - timestamp
                - event_type
                - initiated_by.email
                - client_ip
                - success
                - mfa_meta.type

"2.1":
  api:
    lang: "bash"
    filename: "hth-jumpcloud-2.01-enforce-organization-wide-mfa.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/api/hth-jumpcloud-2.01-enforce-organization-wide-mfa.sh"
    excerpts:
      api-enforce-user-mfa:
        content: |
            # Create a conditional access policy requiring MFA for all user portal logins
            EXISTING=$(jc_get_v2 "/authn/policies" | jq -r '.[] | select(.name == "HTH: Require MFA - All Users") | .id') || true
          
            if [ -n "${EXISTING}" ]; then
            info "2.1 MFA policy already exists (id: ${EXISTING})"
            pass "2.1 User portal MFA policy configured"
            increment_applied
            else
            info "2.1 Creating MFA enforcement policy..."
            RESPONSE=$(jc_post_v2 "/authn/policies" '{
              "name": "HTH: Require MFA - All Users",
              "type": "user_portal",
              "disabled": false,
              "effect": {
                "action": "allow",
                "obligations": {
                  "mfa": { "required": true },
                  "mfaFactors": ["TOTP", "WEBAUTHN", "PUSH"],
                  "userVerification": { "requirement": "required" }
                }
              },
              "targets": {
                "resources": [{ "type": "user_portal" }]
              }
            }') || {
              fail "2.1 Failed to create MFA policy"
              increment_failed; summary; exit 0
            }
            POLICY_ID=$(echo "${RESPONSE}" | jq -r '.id')
            pass "2.1 MFA policy created (id: ${POLICY_ID})"
            increment_applied
            fi
          
            # Audit users without MFA enrolled
            info "2.1 Auditing user MFA enrollment..."
            USERS=$(jc_get_v1 "/systemusers?limit=100")
            NO_MFA=$(echo "${USERS}" | jq '[.results[] | select(.totp_enabled == false and .enable_user_portal_multifactor == false)] | length')
            TOTAL=$(echo "${USERS}" | jq '.totalCount')
            info "2.1 Users without MFA: ${NO_MFA} / ${TOTAL}"
          
            if [ "${NO_MFA}" -gt 0 ]; then
            warn "2.1 Users without MFA enrollment:"
            echo "${USERS}" | jq -r '.results[] | select(.totp_enabled == false and .enable_user_portal_multifactor == false) | "  - \(.email)"'
            fi
  sigma:
    - lang: "yaml"
      filename: "hth-jumpcloud-2.01-enforce-organization-wide-mfa.yml"
      source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/siem/sigma/hth-jumpcloud-2.01-enforce-organization-wide-mfa.yml"
      excerpts:
        detection:
          content: |
              detection:
                selection:
                    event_type: 'organization_update'
                condition: selection
              fields:
                - timestamp
                - event_type
                - initiated_by.email
                - client_ip
                - changes

"3.1":
  api:
    lang: "bash"
    filename: "hth-jumpcloud-3.01-configure-conditional-access-policies.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/api/hth-jumpcloud-3.01-configure-conditional-access-policies.sh"
    excerpts:
      api-create-conditional-access:
        content: |
            # Create IP list for trusted corporate networks
            EXISTING_LIST=$(jc_get_v2 "/iplists" | jq -r '.[] | select(.name == "HTH: Corporate IPs") | .id') || true
          
            if [ -z "${EXISTING_LIST}" ]; then
            info "3.1 Creating corporate IP list..."
            IP_LIST=$(jc_post_v2 "/iplists" '{
              "name": "HTH: Corporate IPs",
              "description": "Trusted corporate network ranges",
              "ips": ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]
            }') || {
              fail "3.1 Failed to create IP list"
              increment_failed; summary; exit 0
            }
            EXISTING_LIST=$(echo "${IP_LIST}" | jq -r '.id')
            pass "3.1 Corporate IP list created (id: ${EXISTING_LIST})"
            fi
          
            # Create policy: require MFA from non-corporate networks
            EXISTING_POLICY=$(jc_get_v2 "/authn/policies" | jq -r '.[] | select(.name == "HTH: MFA Outside Corporate") | .id') || true
          
            if [ -n "${EXISTING_POLICY}" ]; then
            info "3.1 Conditional access policy already exists (id: ${EXISTING_POLICY})"
            else
            info "3.1 Creating conditional access policy..."
            RESPONSE=$(jc_post_v2 "/authn/policies" "$(jq -n --arg list_id "${EXISTING_LIST}" '{
              "name": "HTH: MFA Outside Corporate",
              "type": "user_portal",
              "disabled": false,
              "conditions": {
                "not": {
                  "ipAddressIn": [$list_id]
                }
              },
              "effect": {
                "action": "allow",
                "obligations": {
                  "mfa": { "required": true },
                  "mfaFactors": ["TOTP", "WEBAUTHN"],
                  "userVerification": { "requirement": "required" }
                }
              },
              "targets": {
                "resources": [{ "type": "user_portal" }]
              }
            }')") || {
              fail "3.1 Failed to create conditional access policy"
              increment_failed; summary; exit 0
            }
            pass "3.1 Conditional access policy created"
            fi
          
            increment_applied

"4.1":
  api:
    lang: "bash"
    filename: "hth-jumpcloud-4.01-configure-system-policies.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/api/hth-jumpcloud-4.01-configure-system-policies.sh"
    excerpts:
      api-audit-system-policies:
        content: |
            # List all device policies and check compliance status
            POLICIES=$(jc_get_v2 "/policies") || {
            fail "4.1 Unable to retrieve policies"
            increment_failed; summary; exit 0
            }
          
            TOTAL_POLICIES=$(echo "${POLICIES}" | jq 'length')
            info "4.1 Total device policies: ${TOTAL_POLICIES}"
          
            # Check each policy for compliance status
            for POLICY_ID in $(echo "${POLICIES}" | jq -r '.[].id'); do
            POLICY_NAME=$(echo "${POLICIES}" | jq -r ".[] | select(.id == \"${POLICY_ID}\") | .name")
            STATUSES=$(jc_get_v2 "/policies/${POLICY_ID}/policystatuses" 2>/dev/null) || continue
          
            TOTAL=$(echo "${STATUSES}" | jq 'length')
            COMPLIANT=$(echo "${STATUSES}" | jq '[.[] | select(.status == "success")] | length')
            NON_COMPLIANT=$(echo "${STATUSES}" | jq '[.[] | select(.status != "success")] | length')
          
            if [ "${NON_COMPLIANT}" -gt 0 ]; then
              warn "4.1 Policy '${POLICY_NAME}': ${COMPLIANT}/${TOTAL} compliant (${NON_COMPLIANT} non-compliant)"
            else
              info "4.1 Policy '${POLICY_NAME}': ${COMPLIANT}/${TOTAL} compliant"
            fi
            done
          
            pass "4.1 System policy compliance audit complete"
            increment_applied

"5.1":
  api:
    lang: "bash"
    filename: "hth-jumpcloud-5.01-enable-directory-insights.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/api/hth-jumpcloud-5.01-enable-directory-insights.sh"
    excerpts:
      api-enable-directory-insights:
        content: |
            # Enable Directory Insights feature
            ORG_ID=$(jc_get_v1 "/organizations" | jq -r '.[0].id // empty')
            if [ -z "${ORG_ID}" ]; then
            fail "5.1 Unable to determine organization ID"
            increment_failed; summary; exit 0
            fi
          
            CURRENT=$(jc_get_v1 "/organizations/${ORG_ID}" | jq -r '.settings.features.directoryInsights.enabled // false')
            info "5.1 Directory Insights enabled: ${CURRENT}"
          
            if [ "${CURRENT}" != "true" ]; then
            info "5.1 Enabling Directory Insights..."
            jc_put_v1 "/organizations/${ORG_ID}" '{
              "settings": {
                "features": {
                  "directoryInsights": { "enabled": true }
                }
              }
            }' || {
              fail "5.1 Failed to enable Directory Insights"
              increment_failed; summary; exit 0
            }
            pass "5.1 Directory Insights enabled"
            fi
          
            # Query recent security-relevant events
            START_TIME=$(date -u -d '7 days ago' +%Y-%m-%dT%H:%M:%SZ 2>/dev/null || date -u -v-7d +%Y-%m-%dT%H:%M:%SZ)
            info "5.1 Querying admin events from last 7 days..."
          
            ADMIN_EVENTS=$(jc_insights "/events" "{
            \"service\": [\"directory\"],
            \"start_time\": \"${START_TIME}\",
            \"limit\": 20,
            \"sort\": \"DESC\",
            \"search_term\": {
              \"and\": [
                {\"event_type\": {\"\$in\": [
                  \"admin_login_attempt\",
                  \"admin_update\",
                  \"admin_create\",
                  \"organization_update\"
                ]}}
              ]
            }
            }") || {
            warn "5.1 Unable to query Directory Insights (may require Platform plan)"
            increment_applied; summary; exit 0
            }
          
            EVENT_COUNT=$(echo "${ADMIN_EVENTS}" | jq 'length')
            info "5.1 Admin/org events in last 7 days: ${EVENT_COUNT}"
          
            if [ "${EVENT_COUNT}" -gt 0 ]; then
            echo "${ADMIN_EVENTS}" | jq -r '.[:5][] | "  - \(.timestamp): \(.event_type) by \(.initiated_by.email // "unknown")"'
            fi
          
            pass "5.1 Directory Insights configured and operational"
            increment_applied
  sigma:
    - lang: "yaml"
      filename: "hth-jumpcloud-5.01-enable-directory-insights.yml"
      source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jumpcloud/siem/sigma/hth-jumpcloud-5.01-enable-directory-insights.yml"
      excerpts:
        detection:
          content: |
              detection:
                selection:
                    event_type:
                        - 'admin_create'
                        - 'admin_update'
                condition: selection
              fields:
                - timestamp
                - event_type
                - initiated_by.email
                - client_ip
                - changes

