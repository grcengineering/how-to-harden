# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-24T15:25:53Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-1.01-enforce-sso-with-saml.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-1.01-enforce-sso-with-saml.tf"
    excerpts:
      terraform:
        content: |
            resource "vercel_team_config" "saml_enforcement" {
            id = var.vercel_team_id
          
            saml = {
              enforced = var.saml_enforced
            }
            }

"1.2":
  api:
    lang: "bash"
    filename: "hth-vercel-1.02-configure-directory-sync.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/api/hth-vercel-1.02-configure-directory-sync.sh"
    excerpts:
      api:
        content: |
          
            # --- Verify team SAML/SCIM configuration ---
            echo "=== Directory Sync Configuration ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v2/teams/${VERCEL_TEAM_ID}" | \
            jq '{
              name: .name,
              saml: .saml,
              remoteCaching: .remoteCaching,
              membership: .membership
            }'
          
            # --- List current team members and their roles ---
            echo ""
            echo "=== Current Team Members ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v2/teams/${VERCEL_TEAM_ID}/members?limit=100" | \
            jq '.members[] | {uid, email, role, joinedFrom}'
          
            # --- Audit members for role compliance ---
            echo ""
            echo "=== Members with Owner Role (should be minimal) ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v2/teams/${VERCEL_TEAM_ID}/members?limit=100" | \
            jq '.members[] | select(.role == "OWNER") | {uid, email}'
          
            # --- Verify Access Groups exist (Enterprise) ---
            echo ""
            echo "=== Access Groups ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v1/access-groups?teamId=${VERCEL_TEAM_ID}" | \
            jq '.accessGroups[]? | {name, membersCount, projectsCount}'

"1.3":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-1.03-enforce-least-privilege-rbac.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-1.03-enforce-least-privilege-rbac.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Manage team members with least-privilege roles ---
            resource "vercel_team_member" "members" {
            for_each = var.team_members
          
            team_id = var.vercel_team_id
            email   = each.value.email
            role    = each.value.role
            }
          
            # --- L2: Create Access Groups for project-level permissions (Enterprise) ---
            resource "vercel_access_group" "groups" {
            for_each = var.profile_level >= 2 ? var.access_groups : {}
          
            team_id = var.vercel_team_id
            name    = each.key
            }
          
            # --- L2: Link Access Groups to projects ---
            resource "vercel_access_group_project" "assignments" {
            for_each = var.profile_level >= 2 ? var.access_group_projects : {}
          
            team_id         = var.vercel_team_id
            access_group_id = vercel_access_group.groups[each.value.group_name].id
            project_id      = each.value.project_id
            role            = each.value.role
            }

"1.4":
  cli:
    lang: "bash"
    filename: "hth-vercel-1.04-harden-api-token-lifecycle.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/cli/hth-vercel-1.04-harden-api-token-lifecycle.sh"
    excerpts:
      cli:
        content: |
          
            # --- Audit existing tokens via Vercel API ---
            echo "=== Auditing Vercel API Tokens ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v5/user/tokens" | \
            jq '.tokens[] | {id, name, activeAt, expiresAt, type}'
          
            # --- List tokens with no expiration (security risk) ---
            echo ""
            echo "=== Tokens Without Expiration (ACTION REQUIRED) ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v5/user/tokens" | \
            jq '.tokens[] | select(.expiresAt == null) | {id, name, createdAt}'
          
            # --- Create a scoped token with 90-day max expiration ---
            echo ""
            echo "=== Creating Scoped Token (example) ==="
            # Uncomment and customize:
            # curl -s -X POST -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            #   -H "Content-Type: application/json" \
            #   "https://api.vercel.com/v5/user/tokens" \
            #   -d '{
            #     "name": "github-actions-deploy",
            #     "expiresAt": '"$(($(date +%s) + 7776000))000"',
            #     "type": "oauth2-token"
            #   }'
          
            # --- Verify OIDC federation status ---
            echo ""
            echo "=== OIDC Federation Status ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v1/teams/${VERCEL_TEAM_ID}" | \
            jq '{oidcTokenConfig: .oidcTokenConfig}'

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-2.01-configure-deployment-protection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-2.01-configure-deployment-protection.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Production branch protection and deployment settings ---
            resource "vercel_project" "hardened" {
            name = data.vercel_project.current.name
          
            git_repository = var.git_repository != "" ? {
              type              = var.git_provider
              repo              = var.git_repository
              production_branch = var.production_branch
            } : null
          
            # Block deployments from forked repositories
            git_fork_protection = var.git_fork_protection_enabled
          
            # Disable preview deployments for tighter control (L2+)
            preview_deployments_disabled = var.profile_level >= 2
          
            # Enable skew protection to prevent version mismatches (L2+)
            skew_protection = var.profile_level >= 2 ? "12 hours" : null
          
            # Prioritize production builds over preview builds
            prioritise_production_builds = true
          
            # Git provider security options
            git_provider_options = {
              create_deployments = var.profile_level >= 2 ? "only-production" : "enabled"
            }
          
            # Vercel Authentication on preview deployments (L1)
            vercel_authentication = {
              deployment_type = "all_deployments"
            }
            }
          
            # --- L2: Password-protect preview deployments ---
            resource "vercel_project" "preview_password_protection" {
            count = var.profile_level >= 2 && var.preview_password != "" ? 1 : 0
          
            name = data.vercel_project.current.name
          
            password_protection = {
              deployment_type = "preview"
              password        = var.preview_password
            }
            }
          
            # --- L3: Trusted IPs restrict access to known networks (Enterprise) ---
            resource "vercel_project" "trusted_ips" {
            count = var.profile_level >= 3 && length(var.trusted_ip_addresses) > 0 ? 1 : 0
          
            name = data.vercel_project.current.name
          
            trusted_ips = {
              addresses       = var.trusted_ip_addresses
              deployment_type = "all_deployments"
              protection_mode = "trusted_ip_required"
            }
            }
          
            # --- L3: Disable automation bypass ---
            resource "vercel_project" "automation_bypass" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = data.vercel_project.current.name
          
            protection_bypass_for_automation = false
            }
          
            # --- Data source to read current project configuration ---
            data "vercel_project" "current" {
            name    = null
            id      = var.project_id
            team_id = var.vercel_team_id
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-2.02-harden-git-integration.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-2.02-harden-git-integration.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Git fork protection prevents unauthorized fork deployments ---
            # Note: git_fork_protection is configured in hth-vercel-2.01 as part of
            # the vercel_project resource.
          
            # --- L2: Require verified (signed) commits for deployments ---
            resource "vercel_project" "verified_commits" {
            count = var.profile_level >= 2 && var.require_verified_commits ? 1 : 0
          
            name = data.vercel_project.current.name
          
            git_provider_options = {
              require_verified_commits = true
            }
            }

"2.3":
  api:
    lang: "bash"
    filename: "hth-vercel-2.03-configure-rolling-releases.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/api/hth-vercel-2.03-configure-rolling-releases.sh"
    excerpts:
      api:
        content: |
          
            # --- Check current project deployment settings ---
            echo "=== Project Deployment Configuration ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v9/projects/${VERCEL_PROJECT_ID}?teamId=${VERCEL_TEAM_ID}" | \
            jq '{
              name: .name,
              framework: .framework,
              productionDeploymentWorkflow: .productionDeploymentWorkflow,
              skewProtection: .skewProtection
            }'
          
            # --- List recent deployments with rollout status ---
            echo ""
            echo "=== Recent Deployments ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v6/deployments?projectId=${VERCEL_PROJECT_ID}&teamId=${VERCEL_TEAM_ID}&limit=5" | \
            jq '.deployments[] | {uid, state, createdAt, meta: .meta.githubCommitMessage}'
          
            # --- Verify skew protection is enabled ---
            echo ""
            echo "=== Skew Protection Status ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v9/projects/${VERCEL_PROJECT_ID}?teamId=${VERCEL_TEAM_ID}" | \
            jq '.skewProtection // "not configured"'

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-3.01-enable-waf-managed-rulesets.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-3.01-enable-waf-managed-rulesets.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L2: Enable Web Application Firewall with OWASP managed rulesets ---
            resource "vercel_firewall_config" "waf" {
            project_id = var.project_id
            team_id    = var.vercel_team_id
            enabled    = var.firewall_enabled
          
            managed_rulesets = {
              owasp = {
                active = true
                action = var.waf_owasp_action
              }
            }
          
            # Note: Bot Protection and AI Bot rulesets are managed via
            # Vercel dashboard or API (not yet in Terraform provider)
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-3.02-ip-blocking-rate-limiting.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-3.02-ip-blocking-rate-limiting.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Configure firewall with IP blocking rules ---
            resource "vercel_firewall_config" "ip_blocking" {
            project_id = var.project_id
            team_id    = var.vercel_team_id
            enabled    = true
          
            # IP blocking rules
            dynamic "rules" {
              for_each = var.blocked_ip_addresses
              content {
                name      = rules.value.note != "" ? rules.value.note : "Block ${rules.value.value}"
                action    = "deny"
                active    = true
                condition_group = [{
                  conditions = [{
                    type  = "ip_address"
                    op    = "eq"
                    value = rules.value.value
                  }]
                }]
              }
            }
          
            # L2: Rate limiting rules for sensitive endpoints
            dynamic "rules" {
              for_each = var.profile_level >= 2 ? var.rate_limit_rules : []
              content {
                name      = rules.value.name
                action    = "rate_limit"
                active    = true
                rate_limit = {
                  limit  = rules.value.limit
                  window = rules.value.window
                  action = rules.value.follow_up_action
                }
                condition_group = [{
                  conditions = [{
                    type  = "path"
                    op    = "pre"
                    value = rules.value.path
                  }]
                }]
              }
            }
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-4.01-enable-secure-compute.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-4.01-enable-secure-compute.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L3: Create Secure Compute network with static IPs ---
            resource "vercel_network" "secure_compute" {
            count = var.profile_level >= 3 && var.secure_compute_enabled ? 1 : 0
          
            team_id = var.vercel_team_id
            name    = var.secure_compute_name
            region  = var.secure_compute_region
            }
          
            # --- L3: Link project to Secure Compute network ---
            resource "vercel_network_project_link" "secure_link" {
            count = var.profile_level >= 3 && var.secure_compute_enabled ? 1 : 0
          
            team_id    = var.vercel_team_id
            network_id = vercel_network.secure_compute[0].id
            project_id = var.project_id
            }

"4.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-4.02-ddos-attack-challenge-mode.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-4.02-ddos-attack-challenge-mode.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Enable Attack Challenge Mode (activate during active attacks) ---
            resource "vercel_attack_challenge_mode" "protection" {
            project_id = var.project_id
            team_id    = var.vercel_team_id
            enabled    = var.attack_challenge_mode_enabled
            }

"5.1":
  cli:
    lang: "bash"
    filename: "hth-vercel-5.01-security-response-headers.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/cli/hth-vercel-5.01-security-response-headers.sh"
    excerpts:
      cli:
        content: |
          
            # --- Deploy vercel.json with security headers ---
            # Add this configuration to your project's vercel.json:
            cat > /tmp/hth-vercel-headers.json << 'HEADERS_EOF'
            {
            "headers": [
              {
                "source": "/(.*)",
                "headers": [
                  {
                    "key": "Content-Security-Policy",
                    "value": "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'"
                  },
                  {
                    "key": "X-Frame-Options",
                    "value": "DENY"
                  },
                  {
                    "key": "X-Content-Type-Options",
                    "value": "nosniff"
                  },
                  {
                    "key": "Referrer-Policy",
                    "value": "strict-origin-when-cross-origin"
                  },
                  {
                    "key": "Permissions-Policy",
                    "value": "camera=(), microphone=(), geolocation=(), interest-cohort=()"
                  },
                  {
                    "key": "Strict-Transport-Security",
                    "value": "max-age=63072000; includeSubDomains; preload"
                  },
                  {
                    "key": "X-XSS-Protection",
                    "value": "1; mode=block"
                  }
                ]
              }
            ]
            }
            HEADERS_EOF
          
            echo "Security headers config written to /tmp/hth-vercel-headers.json"
            echo "Merge this into your project's vercel.json, then deploy:"
            echo "  vercel deploy --prod"
          
            # --- Validate deployed headers ---
            echo ""
            echo "=== Validating Security Headers ==="
            DOMAIN="${1:-}"
            if [ -n "${DOMAIN}" ]; then
            echo "Checking headers for: ${DOMAIN}"
            curl -sI "https://${DOMAIN}" | grep -iE \
              "content-security-policy|x-frame-options|x-content-type|referrer-policy|permissions-policy|strict-transport|x-xss"
            else
            echo "Usage: $0 <your-domain.com>"
            fi

"6.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-6.01-environment-variable-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-6.01-environment-variable-security.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Configure environment variables with sensitivity flags ---
            resource "vercel_project_environment_variable" "secrets" {
            for_each = var.environment_variables
          
            project_id = var.project_id
            team_id    = var.vercel_team_id
            key        = each.key
            value      = each.value.value
            target     = each.value.target
            sensitive  = each.value.sensitive
            }
          
            # --- L2: Enforce sensitive environment variable policy at team level ---
            resource "vercel_team_config" "sensitive_env_policy" {
            count = var.profile_level >= 2 ? 1 : 0
          
            id = var.vercel_team_id
          
            sensitive_environment_variable_policy = "on"
            }
          
            # --- L2: Hide IP addresses in observability (privacy hardening) ---
            resource "vercel_team_config" "hide_ips" {
            count = var.profile_level >= 2 ? 1 : 0
          
            id = var.vercel_team_id
          
            hide_ip_addresses               = true
            hide_ip_addresses_in_log_drains = true
            }

"6.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-6.02-deployment-retention-policy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-6.02-deployment-retention-policy.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L2: Configure deployment retention to limit exposure of old deployments ---
            resource "vercel_project" "deployment_retention" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name = data.vercel_project.current.name
          
            deployment_expiration = {
              deploymentsToKeep           = var.deployments_to_keep
              expirationDays              = var.deployment_expiration_days
              expirationDaysCanceled      = var.deployment_expiration_days_canceled
              expirationDaysErrored       = var.deployment_expiration_days_errored
              expirationDaysProduction    = var.deployment_expiration_days_production
            }
            }

"7.1":
  cli:
    lang: "bash"
    filename: "hth-vercel-7.01-prevent-subdomain-takeover.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/cli/hth-vercel-7.01-prevent-subdomain-takeover.sh"
    excerpts:
      cli:
        content: |
          
            # --- List all domains configured in the Vercel team ---
            echo "=== Vercel Domain Inventory ==="
            vercel domains ls
          
            # --- Check for dangling CNAME records pointing to Vercel ---
            echo ""
            echo "=== Checking for Dangling DNS Records ==="
            DOMAINS=$(vercel domains ls 2>/dev/null | awk 'NR>2 {print $1}' | grep -v '^$')
          
            for domain in ${DOMAINS}; do
            echo "Checking: ${domain}"
            # Check if CNAME points to Vercel
            cname=$(dig +short CNAME "${domain}" 2>/dev/null || true)
            if echo "${cname}" | grep -qi "vercel\|now\.sh"; then
              # Verify the domain resolves to an active deployment
              http_code=$(curl -s -o /dev/null -w "%{http_code}" "https://${domain}" 2>/dev/null || echo "000")
              if [ "${http_code}" = "000" ] || [ "${http_code}" = "404" ]; then
                echo "  WARNING: ${domain} has CNAME to Vercel but returns ${http_code} -- possible takeover risk!"
              else
                echo "  OK: ${domain} -> ${cname} (HTTP ${http_code})"
              fi
            fi
            done
          
            # --- Remove a domain no longer in use ---
            # Uncomment and customize:
            # vercel domains rm "unused-subdomain.example.com"

"7.2":
  cli:
    lang: "bash"
    filename: "hth-vercel-7.02-harden-tls-certificate-config.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/cli/hth-vercel-7.02-harden-tls-certificate-config.sh"
    excerpts:
      cli:
        content: |
          
            DOMAIN="${1:-}"
            if [ -z "${DOMAIN}" ]; then
            echo "Usage: $0 <your-domain.com>"
            exit 1
            fi
          
            # --- Verify TLS configuration ---
            echo "=== TLS Verification for ${DOMAIN} ==="
          
            # Check TLS version and cipher
            echo "--- TLS Protocol and Cipher ---"
            echo | openssl s_client -connect "${DOMAIN}:443" -servername "${DOMAIN}" 2>/dev/null | \
            grep -E "Protocol|Cipher|Server certificate"
          
            # Verify HSTS header
            echo ""
            echo "--- HSTS Header ---"
            curl -sI "https://${DOMAIN}" | grep -i "strict-transport-security" || \
            echo "WARNING: No HSTS header found!"
          
            # Verify HTTP to HTTPS redirect
            echo ""
            echo "--- HTTP Redirect Check ---"
            redirect=$(curl -sI -o /dev/null -w "%{http_code}" "http://${DOMAIN}" 2>/dev/null || echo "000")
            if [ "${redirect}" = "308" ] || [ "${redirect}" = "301" ]; then
            echo "OK: HTTP redirects to HTTPS (${redirect})"
            else
            echo "WARNING: HTTP returned ${redirect} -- expected 308 redirect"
            fi
          
            # --- Issue custom certificate (L3) ---
            # Uncomment for custom certificate management:
            # vercel certs issue "${DOMAIN}"
          
            # --- List existing certificates ---
            echo ""
            echo "=== Certificate Inventory ==="
            vercel certs ls

"8.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-8.01-configure-log-drains-siem.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-8.01-configure-log-drains-siem.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Configure log drain to forward deployment and runtime logs ---
            resource "vercel_log_drain" "security_logging" {
            count = var.log_drain_endpoint != "" ? 1 : 0
          
            name            = "hth-security-log-drain"
            team_id         = var.vercel_team_id
            delivery_format = "json"
            endpoint        = var.log_drain_endpoint
            environments    = var.log_drain_environments
            sources         = var.log_drain_sources
            secret          = var.log_drain_secret != "" ? var.log_drain_secret : null
            }
          
            # --- L2: Separate firewall log drain for WAF activity ---
            resource "vercel_log_drain" "firewall_logging" {
            count = var.profile_level >= 2 && var.log_drain_endpoint != "" ? 1 : 0
          
            name            = "hth-firewall-log-drain"
            team_id         = var.vercel_team_id
            delivery_format = "json"
            endpoint        = var.log_drain_endpoint
            environments    = ["production", "preview"]
            sources         = ["firewall"]
            secret          = var.log_drain_secret != "" ? var.log_drain_secret : null
            }

"8.2":
  api:
    lang: "bash"
    filename: "hth-vercel-8.02-audit-logging-siem-streaming.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/api/hth-vercel-8.02-audit-logging-siem-streaming.sh"
    excerpts:
      api:
        content: |
          
            # --- Retrieve recent audit log events (Enterprise) ---
            echo "=== Recent Audit Log Events ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v1/events?teamId=${VERCEL_TEAM_ID}&limit=20&types=team.member.role.updated,project.env_variable.created,saml.updated" | \
            jq '.events[]? | {
              id,
              type,
              createdAt,
              actor: .actor.slug,
              entityId: .entityId
            }'
          
            # --- List security-critical event types to monitor ---
            echo ""
            echo "=== Critical Events for SIEM Alerting ==="
            echo "Configure SIEM detection rules for these event types:"
            echo "  - team.member.role.updated     (privilege escalation)"
            echo "  - team.member.invited          (new access grants)"
            echo "  - team.member.removed          (access revocation)"
            echo "  - project.env_variable.created (secret addition)"
            echo "  - project.env_variable.updated (secret modification)"
            echo "  - deployment-protection.updated (protection changes)"
            echo "  - password_protection.disabled  (protection removal)"
            echo "  - saml.updated                  (SSO config changes)"
            echo "  - integration.installed         (new integrations)"
            echo "  - domain.added                  (domain changes)"
          
            # --- Export audit log CSV (for compliance reporting) ---
            echo ""
            echo "=== Export Audit Log (last 30 days) ==="
            # Navigate to Team Settings > Security > Audit Log > Export CSV
            echo "Manual export available at: https://vercel.com/team/${VERCEL_TEAM_ID}/settings/security"
          
            # --- Verify log drain is receiving audit events ---
            echo ""
            echo "=== Log Drain Status ==="
            curl -s -H "Authorization: Bearer ${VERCEL_TOKEN}" \
            "https://api.vercel.com/v1/log-drains?teamId=${VERCEL_TEAM_ID}" | \
            jq '.[] | {id, name, url: .endpoint, status, sources, environments}'

"8.3":
  cli:
    lang: "bash"
    filename: "hth-vercel-8.03-cron-job-security.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/cli/hth-vercel-8.03-cron-job-security.sh"
    excerpts:
      cli:
        content: |
          
            # --- Generate a strong CRON_SECRET ---
            echo "=== Generate CRON_SECRET ==="
            CRON_SECRET=$(openssl rand -hex 32)
            echo "Generated CRON_SECRET: ${CRON_SECRET}"
          
            # --- Set CRON_SECRET as production environment variable ---
            echo ""
            echo "=== Setting CRON_SECRET Environment Variable ==="
            vercel env add CRON_SECRET production <<< "${CRON_SECRET}"
          
            # --- Verify cron endpoint rejects unauthenticated requests ---
            echo ""
            echo "=== Testing Cron Endpoint Security ==="
            DOMAIN="${1:-}"
            CRON_PATH="${2:-/api/cron}"
          
            if [ -n "${DOMAIN}" ]; then
            # Test without auth (should return 401)
            echo "Testing without auth header..."
            http_code=$(curl -s -o /dev/null -w "%{http_code}" \
              "https://${DOMAIN}${CRON_PATH}" 2>/dev/null || echo "000")
            if [ "${http_code}" = "401" ]; then
              echo "  OK: Returns 401 without auth"
            else
              echo "  WARNING: Returns ${http_code} -- expected 401 for unauthenticated request!"
            fi
          
            # Test with correct auth (should return 200)
            echo "Testing with bearer token..."
            http_code=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "Authorization: Bearer ${CRON_SECRET}" \
              "https://${DOMAIN}${CRON_PATH}" 2>/dev/null || echo "000")
            echo "  Auth response: HTTP ${http_code}"
            else
            echo "Usage: $0 <your-domain.com> [/api/cron-path]"
            fi

