# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-18T04:08:21Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-1.01-enforce-sso-with-mfa.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-1.01-enforce-sso-with-mfa.tf"
    excerpts:
      terraform:
        content: |
            resource "vercel_team_config" "saml_enforcement" {
            id = var.vercel_team_id
          
            saml = {
              enforced = var.saml_enforced
            }
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-1.02-team-access-controls.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-1.02-team-access-controls.tf"
    excerpts:
      terraform:
        content: |
            resource "vercel_team_member" "members" {
            for_each = var.team_members
          
            team_id = var.vercel_team_id
            email   = each.value.email
            role    = each.value.role
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-2.01-secure-deployments.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-2.01-secure-deployments.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Production branch protection and deployment settings ---
            resource "vercel_project" "hardened" {
            name = data.vercel_project.current.name
          
            git_repository = var.git_repository != "" ? {
              type              = var.git_provider
              repo              = var.git_repository
              production_branch = var.production_branch
            } : null
          
            # Require team member approval for production deployments
            git_fork_protection = var.git_fork_protection_enabled
          
            # Disable preview deployments for tighter control (L2+)
            preview_deployments_disabled = var.profile_level >= 2
          
            # Enable skew protection to prevent version mismatches
            skew_protection = var.profile_level >= 2 ? "12 hours" : null
          
            # Prioritise production builds over preview builds
            prioritise_production_builds = true
          
            # Git provider security options
            git_provider_options = {
              # Only deploy commits from verified sources
              create_deployments = var.profile_level >= 2 ? "only-production" : "enabled"
            }
          
            # Vercel Authentication on preview deployments (L1)
            vercel_authentication = {
              deployment_type = "all_deployments"
            }
            }
          
            # --- L2: Password-protect preview deployments ---
            resource "vercel_project" "preview_password_protection" {
            count = var.profile_level >= 2 && var.preview_password != "" ? 1 : 0
          
            name = data.vercel_project.current.name
          
            password_protection = {
              deployment_type = "preview"
              password        = var.preview_password
            }
            }
          
            # --- Data source to read current project configuration ---
            data "vercel_project" "current" {
            name    = null
            id      = var.project_id
            team_id = var.vercel_team_id
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-2.02-git-integration-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-2.02-git-integration-security.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Git fork protection prevents unauthorized fork deployments ---
            # Note: git_fork_protection is configured in hth-vercel-2.01-secure-deployments.tf
            # as part of the vercel_project resource.
          
            # --- L2: Require verified (signed) commits for deployments ---
            resource "vercel_project" "verified_commits" {
            count = var.profile_level >= 2 && var.require_verified_commits ? 1 : 0
          
            name = data.vercel_project.current.name
          
            git_provider_options = {
              require_verified_commits = true
            }
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-3.01-environment-variables.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-3.01-environment-variables.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Configure environment variables with sensitivity flags ---
            resource "vercel_project_environment_variable" "secrets" {
            for_each = var.environment_variables
          
            project_id = var.project_id
            team_id    = var.vercel_team_id
            key        = each.key
            value      = each.value.value
            target     = each.value.target
            sensitive  = each.value.sensitive
            }
          
            # --- L2: Enforce sensitive environment variable policy at team level ---
            resource "vercel_team_config" "sensitive_env_policy" {
            count = var.profile_level >= 2 ? 1 : 0
          
            id = var.vercel_team_id
          
            sensitive_environment_variable_policy = "on"
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-3.02-access-token-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-3.02-access-token-security.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L2: IP allowlisting restricts API access to trusted networks ---
            resource "vercel_project" "trusted_ips" {
            count = var.profile_level >= 2 && length(var.trusted_ip_addresses) > 0 ? 1 : 0
          
            name = data.vercel_project.current.name
          
            trusted_ips = {
              addresses       = var.trusted_ip_addresses
              deployment_type = "all_deployments"
              protection_mode = "trusted_ip_required"
            }
            }
          
            # --- L3: Automation bypass protection ---
            resource "vercel_project" "automation_bypass" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = data.vercel_project.current.name
          
            # Disable automation bypass to prevent secret-based authentication circumvention
            protection_bypass_for_automation = false
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-vercel-4.01-audit-log-and-monitoring.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/vercel/terraform/hth-vercel-4.01-audit-log-and-monitoring.tf"
    excerpts:
      terraform:
        content: |
          
            # --- L1: Configure log drain to forward deployment and runtime logs ---
            resource "vercel_log_drain" "security_logging" {
            count = var.log_drain_endpoint != "" ? 1 : 0
          
            name             = "hth-security-log-drain"
            team_id          = var.vercel_team_id
            delivery_format  = "json"
            endpoint         = var.log_drain_endpoint
            environments     = var.log_drain_environments
            sources          = var.log_drain_sources
            secret           = var.log_drain_secret != "" ? var.log_drain_secret : null
            }
          
            # --- L2: Add firewall logs to log drain sources ---
            resource "vercel_log_drain" "firewall_logging" {
            count = var.profile_level >= 2 && var.log_drain_endpoint != "" ? 1 : 0
          
            name             = "hth-firewall-log-drain"
            team_id          = var.vercel_team_id
            delivery_format  = "json"
            endpoint         = var.log_drain_endpoint
            environments     = ["production", "preview"]
            sources          = ["firewall"]
            secret           = var.log_drain_secret != "" ? var.log_drain_secret : null
            }
          
            # --- L2: Enable Web Application Firewall ---
            resource "vercel_firewall_config" "waf" {
            count = var.profile_level >= 2 && var.firewall_enabled ? 1 : 0
          
            project_id = var.project_id
            team_id    = var.vercel_team_id
            enabled    = true
          
            managed_rulesets = {
              owasp = {
                active = true
                action = "deny"
              }
            }
            }
          
            # --- L2: Hide IP addresses in observability (privacy hardening) ---
            resource "vercel_team_config" "hide_ips" {
            count = var.profile_level >= 2 ? 1 : 0
          
            id = var.vercel_team_id
          
            hide_ip_addresses              = true
            hide_ip_addresses_in_log_drains = true
            }

