# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
        content: |
# Generated: 2026-02-18T20:47:40Z
            # Configure comprehensive logging, alerting, and SIEM integration.
            # All profile levels require alert configuration; SIEM integration
            # is recommended for L2+ environments.
          
            # Configure alert policies for security events
            resource "null_resource" "alert_policies" {
            triggers = {
              dlp_alerts         = var.alert_on_dlp_violations
              malware_alerts     = var.alert_on_malware
              policy_alerts      = var.alert_on_policy_violations
              admin_change_alerts = var.alert_on_admin_changes
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/settings/alerts" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "alerts": [
                      {
                        "name": "HTH - DLP Violations",
                        "event_type": "dlp_violation",
                        "enabled": ${var.alert_on_dlp_violations}
                      },
                      {
                        "name": "HTH - Malware Detection",
                        "event_type": "malware_detected",
                        "enabled": ${var.alert_on_malware}
                      },
                      {
                        "name": "HTH - Policy Violations",
                        "event_type": "policy_violation",
                        "enabled": ${var.alert_on_policy_violations}
                      },
                      {
                        "name": "HTH - Admin Changes",
                        "event_type": "admin_audit",
                        "enabled": ${var.alert_on_admin_changes}
                      }
                    ]
                  }'
              EOT
            }
            }
          
            # Configure SIEM integration via Cloud Log Shipper
            resource "null_resource" "siem_integration" {
            count = var.siem_type != "none" ? 1 : 0
          
            triggers = {
              siem_type     = var.siem_type
              siem_endpoint = var.siem_endpoint
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/settings/cloud-log-shipper" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "enabled": true,
                    "type": "${var.siem_type}",
                    "endpoint": "${var.siem_endpoint}",
                    "token": "${var.siem_token}",
                    "log_types": [
                      "application_events",
                      "page_events",
                      "alert_events",
                      "audit_events",
                      "infrastructure_events"
                    ]
                  }'
              EOT
            }
            }


"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-1.01-secure-admin-console-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-1.01-secure-admin-console-access.tf"
    excerpts:
      terraform:
        content: |
            # Configure SSO for admin console access via the Netskope REST API.
            # The Terraform provider does not expose SSO/MFA configuration natively,
            # so we use null_resource with local-exec to call the REST API.
          
            resource "null_resource" "admin_sso_configuration" {
            count = var.admin_sso_idp_entity_id != "" ? 1 : 0
          
            triggers = {
              idp_entity_id = var.admin_sso_idp_entity_id
              idp_sso_url   = var.admin_sso_idp_sso_url
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/tenant/sso" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "sso_enabled": true,
                    "idp_entity_id": "${var.admin_sso_idp_entity_id}",
                    "idp_sso_url": "${var.admin_sso_idp_sso_url}",
                    "idp_certificate": "${var.admin_sso_idp_certificate}"
                  }'
              EOT
            }
            }
          
            # Configure admin session timeout via REST API
            resource "null_resource" "admin_session_timeout" {
            triggers = {
              timeout = var.session_timeout_minutes
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/tenant/settings" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "session_timeout": ${var.session_timeout_minutes}
                  }'
              EOT
            }
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-1.02-configure-tenant-hardening.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-1.02-configure-tenant-hardening.tf"
    excerpts:
      terraform:
        content: |
            # Enable audit logging and configure tenant security settings.
            # IP allowlisting for admin access is an L2 control.
          
            resource "null_resource" "tenant_hardening" {
            triggers = {
              session_timeout = var.session_timeout_minutes
              profile_level   = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/tenant/settings" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "audit_logging_enabled": true,
                    "session_timeout": ${var.session_timeout_minutes}
                  }'
              EOT
            }
            }
          
            # L2: Configure IP allowlisting for admin console access
            resource "null_resource" "admin_ip_allowlist" {
            count = var.profile_level >= 2 && length(var.admin_ip_allowlist) > 0 ? 1 : 0
          
            triggers = {
              ip_allowlist = join(",", var.admin_ip_allowlist)
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/tenant/settings" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "admin_ip_allowlist_enabled": true,
                    "admin_ip_allowlist": ${jsonencode(var.admin_ip_allowlist)}
                  }'
              EOT
            }
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-2.01-configure-application-visibility.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-2.01-configure-application-visibility.tf"
    excerpts:
      terraform:
        content: |
            # Enable cloud app discovery and configure risk scoring thresholds.
            # Application visibility is foundational to all CASB policies.
          
            resource "null_resource" "app_discovery_settings" {
            triggers = {
              cci_high_risk   = var.cci_high_risk_threshold
              cci_medium_risk = var.cci_medium_risk_threshold
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/policy/app-discovery" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "enabled": true,
                    "risk_thresholds": {
                      "high_risk_below": ${var.cci_high_risk_threshold},
                      "medium_risk_below": ${var.cci_medium_risk_threshold}
                    }
                  }'
              EOT
            }
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-2.02-configure-realtime-protection-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-2.02-configure-realtime-protection-policies.tf"
    excerpts:
      terraform:
        content: |
            # Create real-time protection policies to control cloud application access.
            # These policies enforce inline inspection for all steered traffic.
          
            # Policy: Block high-risk unsanctioned cloud applications (CCI < threshold)
            resource "null_resource" "block_unsanctioned_apps_policy" {
            count = var.block_unsanctioned_apps ? 1 : 0
          
            triggers = {
              cci_threshold = var.cci_high_risk_threshold
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X POST \
                  "${var.netskope_tenant_url}/api/v2/policy/realtime" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "name": "HTH - Block High-Risk Cloud Apps",
                    "description": "Block cloud applications with CCI score below ${var.cci_high_risk_threshold}",
                    "enabled": true,
                    "source": {
                      "users": ["all"]
                    },
                    "destination": {
                      "cci_threshold": ${var.cci_high_risk_threshold},
                      "cci_operator": "lt"
                    },
                    "activity": ["all"],
                    "action": "block",
                    "user_notification": "This application has been blocked by your organization security policy due to high risk score."
                  }'
              EOT
            }
            }
          
            # Policy: Block uploads/shares to personal instances of cloud apps
            resource "null_resource" "block_personal_instances_policy" {
            count = var.block_personal_instances ? 1 : 0
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X POST \
                  "${var.netskope_tenant_url}/api/v2/policy/realtime" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "name": "HTH - Block Upload to Personal Cloud",
                    "description": "Prevent data upload and sharing to personal instances of cloud apps",
                    "enabled": true,
                    "source": {
                      "users": ["all"]
                    },
                    "destination": {
                      "instance_type": "personal"
                    },
                    "activity": ["upload", "share"],
                    "action": "block",
                    "user_notification": "Uploading or sharing to personal cloud instances is not permitted by organization policy."
                  }'
              EOT
            }
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-2.03-configure-api-protection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-2.03-configure-api-protection.tf"
    excerpts:
      terraform:
        content: |
            # Configure API-enabled protection to scan data at rest in sanctioned SaaS apps.
            # This is an L2 control requiring SSE Professional or Enterprise license.
          
            resource "null_resource" "api_protection_config" {
            count = var.profile_level >= 2 && length(var.api_protection_apps) > 0 ? 1 : 0
          
            triggers = {
              apps           = join(",", var.api_protection_apps)
              scan_frequency = var.api_scan_frequency
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/policy/api-protection" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "enabled": true,
                    "scan_frequency": "${var.api_scan_frequency}",
                    "malware_scan_enabled": true,
                    "dlp_scan_enabled": true,
                    "remediation": {
                      "quarantine_sensitive_files": true,
                      "revoke_external_sharing": true,
                      "notify_owner": true
                    }
                  }'
              EOT
            }
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-3.01-configure-dlp-profiles.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-3.01-configure-dlp-profiles.tf"
    excerpts:
      terraform:
        content: |
            # Create DLP profiles for detecting sensitive data across cloud applications.
            # Netskope DLP profiles are configured via REST API since the Terraform
            # provider focuses on NPA/ZTNA resources.
          
            locals {
            dlp_detection_rules = concat(
              var.dlp_credit_card_enabled ? ["credit_card"] : [],
              var.dlp_ssn_enabled ? ["ssn"] : [],
              var.dlp_api_keys_enabled ? ["api_keys_credentials"] : [],
            )
            }
          
            # Create a corporate DLP profile with selected detection rules
            resource "null_resource" "dlp_profile_corporate" {
            triggers = {
              rules           = join(",", local.dlp_detection_rules)
              custom_patterns = join(",", var.dlp_custom_patterns)
              profile_level   = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X POST \
                  "${var.netskope_tenant_url}/api/v2/policy/dlp/profiles" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "name": "HTH - Corporate Sensitive Data",
                    "description": "Detects credit cards, SSNs, API keys, and custom patterns per HTH hardening guide",
                    "enabled": true,
                    "detection_rules": ${jsonencode(local.dlp_detection_rules)},
                    "custom_patterns": ${jsonencode(var.dlp_custom_patterns)},
                    "severity": "high"
                  }'
              EOT
            }
            }
          
            # L2+: Enable advanced DLP detection technologies
            resource "null_resource" "dlp_advanced_detection" {
            count = var.profile_level >= 2 ? 1 : 0
          
            triggers = {
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/policy/dlp/settings" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "exact_data_match_enabled": true,
                    "file_fingerprinting_enabled": true,
                    "ocr_enabled": true,
                    "ml_classification_enabled": true
                  }'
              EOT
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-3.02-apply-dlp-to-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-3.02-apply-dlp-to-policies.tf"
    excerpts:
      terraform:
        content: |
            # Apply DLP profiles to real-time protection and API protection policies.
            # DLP enforcement actions escalate with profile level:
            #   L1: Alert on violations (log but allow)
            #   L2: Coach users (warn and require justification)
            #   L3: Block sensitive data transfers
          
            locals {
            dlp_action = (
              var.profile_level >= 3 ? "block" :
              var.profile_level >= 2 ? "coach" :
              "alert"
            )
            }
          
            # Apply DLP profile to real-time inline policy
            resource "null_resource" "dlp_realtime_policy" {
            triggers = {
              action        = local.dlp_action
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X POST \
                  "${var.netskope_tenant_url}/api/v2/policy/realtime" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "name": "HTH - DLP Real-Time Enforcement",
                    "description": "Enforce DLP profile on all inline cloud traffic (action: ${local.dlp_action})",
                    "enabled": true,
                    "source": {
                      "users": ["all"]
                    },
                    "destination": {
                      "apps": ["all_cloud_apps"]
                    },
                    "activity": ["upload", "download", "share"],
                    "dlp_profile": "HTH - Corporate Sensitive Data",
                    "action": "${local.dlp_action}",
                    "user_notification": "Sensitive data detected. This activity has been ${local.dlp_action == "block" ? "blocked" : "logged"} per organization policy."
                  }'
              EOT
            }
          
            depends_on = [null_resource.dlp_profile_corporate]
            }
          
            # L2+: Apply DLP profile to API data protection scanning
            resource "null_resource" "dlp_api_protection_policy" {
            count = var.profile_level >= 2 ? 1 : 0
          
            triggers = {
              profile_level = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/policy/api-protection/dlp" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "dlp_profile": "HTH - Corporate Sensitive Data",
                    "enabled": true,
                    "remediation": {
                      "quarantine": true,
                      "revoke_sharing": true,
                      "notify_owner": true
                    }
                  }'
              EOT
            }
          
            depends_on = [
              null_resource.dlp_profile_corporate,
              null_resource.api_protection_config,
            ]
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-4.01-configure-malware-protection.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-4.01-configure-malware-protection.tf"
    excerpts:
      terraform:
        content: |
            # Configure threat protection to detect and prevent malware in cloud traffic.
            # Sandboxing requires SSE Professional or Enterprise license.
          
            resource "null_resource" "malware_protection" {
            triggers = {
              sandbox_enabled = var.sandbox_enabled
              profile_level   = var.profile_level
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/policy/threat-protection/settings" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "malware_scan_upload": true,
                    "malware_scan_download": true,
                    "malware_scan_web": true,
                    "known_malware_action": "block",
                    "suspicious_files_action": "sandbox",
                    "phishing_url_action": "block"
                  }'
              EOT
            }
            }
          
            # Configure cloud sandbox for unknown file analysis
            resource "null_resource" "cloud_sandbox" {
            count = var.sandbox_enabled ? 1 : 0
          
            triggers = {
              file_types = join(",", var.sandbox_file_types)
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/policy/threat-protection/sandbox" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "enabled": true,
                    "file_types": ${jsonencode(var.sandbox_file_types)},
                    "pending_action": "quarantine",
                    "timeout_action": "block"
                  }'
              EOT
            }
            }

"4.2":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-4.02-configure-threat-protection-policies.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-4.02-configure-threat-protection-policies.tf"
    excerpts:
      terraform:
        content: |
            # Create comprehensive threat protection policies following Netskope best
            # practices. These L2 controls add behavioral analytics and suspicious
            # category blocking beyond the L1 malware baseline.
          
            # Block newly registered domains (common phishing/malware vector)
            resource "null_resource" "block_newly_registered_domains" {
            count = var.profile_level >= 2 && var.block_newly_registered_domains ? 1 : 0
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X POST \
                  "${var.netskope_tenant_url}/api/v2/policy/realtime" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "name": "HTH - Block Newly Registered Domains",
                    "description": "Block access to domains registered within the last 30 days",
                    "enabled": true,
                    "source": {
                      "users": ["all"]
                    },
                    "destination": {
                      "url_category": ["newly_registered_domains"]
                    },
                    "action": "block",
                    "user_notification": "Access blocked: This domain was recently registered and may pose a security risk."
                  }'
              EOT
            }
            }
          
            # Block uncategorized websites
            resource "null_resource" "block_uncategorized_sites" {
            count = var.profile_level >= 2 && var.block_uncategorized_sites ? 1 : 0
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X POST \
                  "${var.netskope_tenant_url}/api/v2/policy/realtime" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "name": "HTH - Block Uncategorized Sites",
                    "description": "Block access to uncategorized and parked domains",
                    "enabled": true,
                    "source": {
                      "users": ["all"]
                    },
                    "destination": {
                      "url_category": ["uncategorized", "parked_domains"]
                    },
                    "action": "block",
                    "user_notification": "Access blocked: This website has not been categorized and may pose a security risk."
                  }'
              EOT
            }
            }
          
            # Enable cloud behavior analytics for anomaly detection
            resource "null_resource" "behavior_analytics" {
            count = var.profile_level >= 2 && var.enable_behavior_analytics ? 1 : 0
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/settings/security/behavior-analytics" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "enabled": true,
                    "anomaly_detection": {
                      "data_exfiltration": true,
                      "compromised_account": true,
                      "insider_threat": true
                    }
                  }'
              EOT
            }
            }

"5.1":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-5.01-configure-client-steering.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-5.01-configure-client-steering.tf"
    excerpts:
      terraform:
        content: |
            # Configure traffic steering to ensure proper routing through the Netskope
            # cloud for inline inspection. Certificate-pinned apps must be excluded.
            #
            # IMPORTANT: Do NOT set custom app domains to "*" for certificate-pinned apps,
            # as this will bypass all inspection.
          
            resource "null_resource" "steering_configuration" {
            triggers = {
              steering_mode      = var.steering_mode
              cert_pinned_domains = join(",", var.cert_pinned_domains)
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/steering/settings" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "steering_mode": "${var.steering_mode}",
                    "steer_all_cloud_apps": true
                  }'
              EOT
            }
            }
          
            # Configure certificate-pinned app exceptions (Do Not Steer list)
            resource "null_resource" "cert_pinned_exceptions" {
            count = length(var.cert_pinned_domains) > 0 ? 1 : 0
          
            triggers = {
              domains = join(",", var.cert_pinned_domains)
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/steering/exceptions" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "do_not_steer": ${jsonencode(var.cert_pinned_domains)},
                    "reason": "Certificate-pinned applications that cannot be inspected via SSL interception"
                  }'
              EOT
            }
            }

"5.2":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-5.02-deploy-netskope-client.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-5.02-deploy-netskope-client.tf"
    excerpts:
      terraform:
        content: |
            # Configure Netskope Client settings for endpoint deployment.
            # Fail-close mode provides maximum security but may impact availability.
            # L3 environments should enable fail-close; L1/L2 may prefer fail-open.
          
            locals {
            # L3 forces fail-close for maximum security regardless of variable setting
            effective_fail_close = var.profile_level >= 3 ? true : var.fail_close
            }
          
            resource "null_resource" "client_configuration" {
            triggers = {
              fail_close  = local.effective_fail_close
              auto_update = var.client_auto_update
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/steering/client-config" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "fail_close": ${local.effective_fail_close},
                    "auto_update": ${var.client_auto_update},
                    "ssl_inspection": true
                  }'
              EOT
            }
            }

"6.1":
  terraform:
    lang: "hcl"
    filename: "hth-netskope-6.01-configure-logging-and-alerts.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/netskope/terraform/hth-netskope-6.01-configure-logging-and-alerts.tf"
    excerpts:
      terraform:
        content: |
            # Configure comprehensive logging, alerting, and SIEM integration.
            # All profile levels require alert configuration; SIEM integration
            # is recommended for L2+ environments.
          
            # Configure alert policies for security events
            resource "null_resource" "alert_policies" {
            triggers = {
              dlp_alerts         = var.alert_on_dlp_violations
              malware_alerts     = var.alert_on_malware
              policy_alerts      = var.alert_on_policy_violations
              admin_change_alerts = var.alert_on_admin_changes
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/settings/alerts" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "alerts": [
                      {
                        "name": "HTH - DLP Violations",
                        "event_type": "dlp_violation",
                        "enabled": ${var.alert_on_dlp_violations}
                      },
                      {
                        "name": "HTH - Malware Detection",
                        "event_type": "malware_detected",
                        "enabled": ${var.alert_on_malware}
                      },
                      {
                        "name": "HTH - Policy Violations",
                        "event_type": "policy_violation",
                        "enabled": ${var.alert_on_policy_violations}
                      },
                      {
                        "name": "HTH - Admin Changes",
                        "event_type": "admin_audit",
                        "enabled": ${var.alert_on_admin_changes}
                      }
                    ]
                  }'
              EOT
            }
            }
          
            # Configure SIEM integration via Cloud Log Shipper
            resource "null_resource" "siem_integration" {
            count = var.siem_type != "none" ? 1 : 0
          
            triggers = {
              siem_type     = var.siem_type
              siem_endpoint = var.siem_endpoint
            }
          
            provisioner "local-exec" {
              command = <<-EOT
                curl -s -X PUT \
                  "${var.netskope_tenant_url}/api/v2/settings/cloud-log-shipper" \
                  -H "Netskope-Api-Token: ${var.netskope_api_key}" \
                  -H "Content-Type: application/json" \
                  -d '{
                    "enabled": true,
                    "type": "${var.siem_type}",
                    "endpoint": "${var.siem_endpoint}",
                    "token": "${var.siem_token}",
                    "log_types": [
                      "application_events",
                      "page_events",
                      "alert_events",
                      "audit_events",
                      "infrastructure_events"
                    ]
                  }'
              EOT
            }
            }

