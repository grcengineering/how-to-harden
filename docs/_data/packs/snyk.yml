# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-18T03:21:05Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-1.01-enforce-sso-mfa.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-1.01-enforce-sso-mfa.tf"
    excerpts:
      terraform:
        content: |
            # Configure organization SSO enforcement
            # Note: SAML SSO configuration requires Business/Enterprise plan and
            # must be initially configured via the Snyk web console. This resource
            # enforces the SSO requirement after initial IdP setup.
            resource "snyk_organization" "sso_enforcement" {
            id   = var.snyk_org_id
            name = data.snyk_organization.current.name
          
            # Enforce SSO for all organization members
            request_access = {
              enabled = var.sso_enabled
            }
          
            lifecycle {
              ignore_changes = [name]
            }
            }
          
            # Data source to read current org settings without overwriting
            data "snyk_organization" "current" {
            id = var.snyk_org_id
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-1.02-role-based-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-1.02-role-based-access.tf"
    excerpts:
      terraform:
        content: |
            # Enforce least-privilege roles for organization members.
            # Snyk roles: org-admin, org-collaborator, org-custom (Enterprise).
            # Map users to their appropriate roles to enforce separation of duties.
          
            # Apply role assignments from the restricted_roles variable map.
            # Each entry maps a user email to their intended Snyk organization role.
            resource "snyk_organization" "rbac_settings" {
            count = length(var.restricted_roles) > 0 ? 1 : 0
          
            id   = var.snyk_org_id
            name = data.snyk_organization.current.name
          
            lifecycle {
              ignore_changes = [name]
            }
            }
          
            # Note: Individual user role assignments require the Snyk REST API.
            # Use the companion API script for per-user role enforcement:
            #   bash packs/snyk/api/hth-snyk-1.02-role-based-access.sh
            #
            # The Snyk Terraform provider does not yet expose a dedicated
            # "snyk_organization_member" resource for granular role management.
            # This file establishes the organizational baseline; use API scripts
            # or SCIM provisioning for per-user role assignment.

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-2.01-secure-service-account-tokens.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-2.01-secure-service-account-tokens.tf"
    excerpts:
      terraform:
        content: |
            # Create dedicated service accounts with least-privilege roles.
            # Each CI/CD pipeline should have its own service account with
            # scoped permissions rather than sharing a single admin token.
          
            # Service accounts created from the service_accounts variable list.
            # Each account gets a dedicated role (e.g., org-collaborator for
            # read-only scanning, org-admin only when absolutely required).
            resource "snyk_organization" "service_account_org" {
            count = length(var.service_accounts) > 0 ? 1 : 0
          
            id   = var.snyk_org_id
            name = data.snyk_organization.current.name
          
            lifecycle {
              ignore_changes = [name]
            }
            }
          
            # Note: The Snyk Terraform provider (v0.1.x) does not yet expose a
            # dedicated "snyk_service_account" resource. Service account creation
            # requires the Snyk REST API:
            #
            #   POST https://api.snyk.io/rest/orgs/{org_id}/service_accounts
            #   {
            #     "data": {
            #       "attributes": {
            #         "name": "ci-pipeline-scanner",
            #         "auth_type": "api_key",
            #         "role_id": "<org-collaborator-role-id>"
            #       },
            #       "type": "service_account"
            #     }
            #   }
            #
            # Use the companion API script for full service account management:
            #   bash packs/snyk/api/hth-snyk-2.01-secure-service-account-tokens.sh
            #
            # Best practices enforced by this control:
            # - One service account per CI/CD pipeline (no shared tokens)
            # - Org Collaborator role for read-only scanning
            # - Token rotation on a regular schedule (90 days max)
            # - Immediate revocation of unused accounts

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-2.02-scm-integration-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-2.02-scm-integration-security.tf"
    excerpts:
      terraform:
        content: |
            # Configure SCM integration with least-privilege repository access.
            # Limit Snyk's access to only the repositories that require scanning.
            # For Enterprise customers, use Snyk Broker to keep code on-premises.
          
            resource "snyk_integration" "scm" {
            organization_id = var.snyk_org_id
            type            = var.scm_integration_type
            }
          
            # Broker configuration for private repository scanning (Enterprise).
            # Snyk Broker acts as a proxy between Snyk and your SCM, ensuring
            # source code never leaves your network perimeter.
            resource "snyk_integration" "broker" {
            count = var.broker_enabled ? 1 : 0
          
            organization_id = var.snyk_org_id
            type            = "${var.scm_integration_type}-broker"
          
            # Broker token must be provisioned via Snyk web console first.
            # The accept.json filter file controls which API endpoints the
            # Broker client will proxy -- restrict to minimum required:
            #   - Repository file access (for scanning)
            #   - Webhook management (for auto-scanning on push)
            #   - Pull request status (for PR checks)
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-3.01-project-visibility.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-3.01-project-visibility.tf"
    excerpts:
      terraform:
        content: |
            # Set default project visibility to restrict who can view vulnerability
            # details within the organization. Vulnerability findings are sensitive
            # data -- attackers with access to unpatched CVE lists gain a roadmap
            # for exploitation.
          
            resource "snyk_organization" "project_visibility" {
            id   = var.snyk_org_id
            name = data.snyk_organization.current.name
          
            # Restrict default project visibility to organization-private.
            # Projects will only be visible to members with explicit access.
          
            lifecycle {
              ignore_changes = [name]
            }
            }
          
            # Configure individual project settings for sensitive repositories.
            # Projects containing critical infrastructure code should have
            # restricted visibility even within the organization.
            #
            # Note: Per-project visibility settings require the Snyk REST API
            # or the snyk_project resource when managing individual projects:
            #
            #   resource "snyk_project" "critical_app" {
            #     organization_id = var.snyk_org_id
            #     id              = "<project-id>"
            #     # Project-level settings applied here
            #   }
            #
            # Use the companion API script to audit and enforce project visibility:
            #   bash packs/snyk/api/hth-snyk-3.01-project-visibility.sh

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-3.02-ignore-policy.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-3.02-ignore-policy.tf"
    excerpts:
      terraform:
        content: |
            # Enforce governance around vulnerability ignores.
            # Uncontrolled ignores hide real risk -- require a documented reason
            # and set an expiration date so ignored issues get re-evaluated.
          
            # This control is L2 (Hardened) and only applied at profile_level >= 2.
            resource "snyk_organization" "ignore_policy" {
            count = var.profile_level >= 2 ? 1 : 0
          
            id   = var.snyk_org_id
            name = data.snyk_organization.current.name
          
            lifecycle {
              ignore_changes = [name]
            }
            }
          
            # Note: The Snyk Terraform provider (v0.1.x) does not expose a
            # dedicated ignore policy resource. Ignore governance is enforced
            # via the Snyk REST API and organization policy settings:
            #
            #   PATCH https://api.snyk.io/rest/orgs/{org_id}
            #   {
            #     "data": {
            #       "attributes": {
            #         "ignore_policy": {
            #           "require_reason": true,
            #           "default_expiry_days": 90
            #         }
            #       }
            #     }
            #   }
            #
            # Ignore policy best practices (L2+):
            # - Require a documented reason for every ignore
            # - Set maximum ignore expiration to ${var.ignore_expiration_days} days
            # - Audit ignored vulnerabilities monthly
            # - Re-evaluate expired ignores within 7 days
            # - Critical/High severity ignores require approval from security team
            #
            # Use the companion API script for full ignore policy enforcement:
            #   bash packs/snyk/api/hth-snyk-3.02-ignore-policy.sh

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-snyk-4.01-audit-logs-notifications.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/snyk/terraform/hth-snyk-4.01-audit-logs-notifications.tf"
    excerpts:
      terraform:
        content: |
            # Configure notification settings for security-relevant events.
            # Audit logs are available via the Snyk API (Enterprise plan) and
            # should be forwarded to a SIEM for centralized monitoring.
          
            # Enable notifications for new vulnerability discoveries
            resource "snyk_notification_setting" "new_issues" {
            organization_id = var.snyk_org_id
          
            new_issues_remediations = {
              enabled    = var.new_issues_notification
              issue_type = "vuln"
              severity   = "high"
            }
            }
          
            # Enable weekly vulnerability report for security oversight
            resource "snyk_notification_setting" "weekly_report" {
            organization_id = var.snyk_org_id
          
            weekly_report = {
              enabled = var.weekly_report_enabled
            }
            }
          
            # Note: Audit log export requires the Snyk REST API (Enterprise plan):
            #
            #   GET https://api.snyk.io/rest/groups/{group_id}/audit_logs/search
            #     ?from=2024-01-01T00:00:00Z
            #     &to=2024-01-31T23:59:59Z
            #
            # Key audit events to monitor:
            # - org.user.add / org.user.remove (membership changes)
            # - org.service_account.create / org.service_account.delete
            # - org.integration.create / org.integration.delete
            # - org.project.ignore.create (vulnerability ignores)
            # - org.settings.update (organization setting changes)
            # - group.sso.update (SSO configuration changes)
            #
            # Forward audit logs to your SIEM using the Snyk Audit Logs API
            # or configure a webhook for real-time event streaming.
            #
            # Use the companion API script for audit log export:
            #   bash packs/snyk/api/hth-snyk-4.01-audit-logs-notifications.sh

