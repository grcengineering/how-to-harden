# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-18T04:07:55Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-1.01-configure-saml-sso.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-1.01-configure-saml-sso.tf"
    excerpts:
      terraform:
        content: |
            # Reference the Sentry organization for SSO audit verification
            data "sentry_organization" "main" {
            slug = var.sentry_organization
            }
          
            # ---------------------------------------------------------------------------
            # SAML SSO must be configured via Sentry UI or API:
            #
            #   1. Navigate to Settings > Auth > Configure SAML2
            #   2. Provide IdP Entity ID, SSO URL, and X.509 certificate
            #   3. Configure attribute mapping (email, firstName, lastName)
            #   4. Download Sentry SP metadata for your IdP
            #   5. Test authentication, then enable SSO enforcement
            #
            # API alternative (requires owner-level auth token):
            #   PUT /api/0/organizations/{org_slug}/
            #     { "require_sso": true }
            #
            # Verify SSO status:
            #   GET /api/0/organizations/{org_slug}/
            #     -> check "require2FA" and SSO provider fields
            # ---------------------------------------------------------------------------

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-1.02-enforce-two-factor-authentication.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-1.02-enforce-two-factor-authentication.tf"
    excerpts:
      terraform:
        content: |
            # ---------------------------------------------------------------------------
            # Two-factor authentication enforcement must be configured via Sentry UI
            # or the Sentry API:
            #
            #   UI: Settings > Security > Require two-factor authentication
            #
            #   API (requires owner-level auth token):
            #     PUT /api/0/organizations/{org_slug}/
            #       { "require2FA": true }
            #
            # When SSO is configured (Control 1.1), enforce MFA at the IdP level
            # using phishing-resistant methods (FIDO2/WebAuthn) for admin accounts.
            #
            # Verify 2FA enforcement:
            #   GET /api/0/organizations/{org_slug}/
            #     -> check "require2FA": true
            # ---------------------------------------------------------------------------

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-2.01-configure-team-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-2.01-configure-team-access.tf"
    excerpts:
      terraform:
        content: |
            # Create teams for least-privilege access segmentation
            resource "sentry_team" "teams" {
            for_each = var.teams
          
            organization = var.sentry_organization
            name         = each.value
            slug         = each.key
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-2.02-configure-project-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-2.02-configure-project-access.tf"
    excerpts:
      terraform:
        content: |
            # Create projects with team-scoped access (L2+ only)
            # Each project is assigned to specific teams, enforcing least-privilege
            # access boundaries between functional groups.
            resource "sentry_project" "projects" {
            for_each = var.profile_level >= 2 ? var.projects : {}
          
            organization = var.sentry_organization
            teams        = each.value.teams
            name         = each.value.name
            slug         = each.key
            platform     = each.value.platform
          
            # Disable default alert rules -- security alerts are managed separately
            default_rules = false
          
            # Auto-resolve stale issues after 72 hours to reduce noise
            resolve_age = 72
          
            depends_on = [sentry_team.teams]
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-2.03-limit-admin-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-2.03-limit-admin-access.tf"
    excerpts:
      terraform:
        content: |
            # Manage admin/owner members explicitly via Terraform to enforce
            # least-privilege and ensure only approved accounts hold elevated roles.
            # Limit owners to 2-3 accounts maximum.
            resource "sentry_organization_member" "admins" {
            for_each = var.admin_members
          
            organization = var.sentry_organization
            email        = each.key
            role         = each.value
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-3.01-configure-data-scrubbing.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-3.01-configure-data-scrubbing.tf"
    excerpts:
      terraform:
        content: |
            # ---------------------------------------------------------------------------
            # Data scrubbing is applied at two levels:
            #
            # 1. Server-side (Sentry platform):
            #    Configured via project settings. When projects are managed by
            #    Control 2.2 (sentry_project.projects), scrubbing is enabled by
            #    default on the Sentry platform. Custom sensitive fields are
            #    configured via the Sentry API:
            #
            #    PUT /api/0/projects/{org_slug}/{project_slug}/
            #      {
            #        "dataScrubber": true,
            #        "dataScrubberDefaults": true,
            #        "sensitiveFields": ["password", "secret", "api_key", "token",
            #                            "authorization", "credit_card", "ssn"],
            #        "safeFields": [],
            #        "scrubIPAddresses": true,
            #        "scrapeJavaScript": false
            #      }
            #
            # 2. Client-side (SDK beforeSend hooks):
            #    Filter PII before transmission to Sentry. This must be implemented
            #    in application code using the SDK's beforeSend callback.
            #
            # For L3 (Maximum Security), additionally disable JavaScript scraping
            # and enable IP address scrubbing on all projects.
            # ---------------------------------------------------------------------------

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-3.02-configure-dsn-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-3.02-configure-dsn-security.tf"
    excerpts:
      terraform:
        content: |
            # Create rate-limited client keys (DSNs) for each managed project.
            # Rate limiting prevents DSN abuse and controls event volume.
            resource "sentry_key" "rate_limited" {
            for_each = var.profile_level >= 2 ? var.projects : {}
          
            organization = var.sentry_organization
            project      = each.key
            name         = "${each.value.name} - Rate Limited Key"
          
            rate_limit_window = var.dsn_rate_limit_window
            rate_limit_count  = var.dsn_rate_limit_count
          
            depends_on = [sentry_project.projects]
            }

"3.3":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-3.03-configure-ip-filtering.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-3.03-configure-ip-filtering.tf"
    excerpts:
      terraform:
        content: |
            # Enable inbound data filters on managed projects (L2+ only).
            # These filters reduce noise and block events from known non-production
            # sources such as browser extensions, localhost, and web crawlers.
            resource "sentry_project_inbound_data_filter" "filters" {
            for_each = var.profile_level >= 2 ? toset([
              for pair in setproduct(keys(var.projects), var.inbound_data_filters) :
              "${pair[0]}:${pair[1]}"
            ]) : toset([])
          
            organization = var.sentry_organization
            project      = split(":", each.value)[0]
            filter_id    = split(":", each.value)[1]
            active       = true
          
            depends_on = [sentry_project.projects]
            }
          
            # Filter legacy browser events to reduce noise from unsupported clients (L2+)
            resource "sentry_project_inbound_data_filter" "legacy_browsers" {
            for_each = var.profile_level >= 2 ? toset(keys(var.projects)) : toset([])
          
            organization = var.sentry_organization
            project      = each.value
            filter_id    = "legacy-browsers"
            subfilters   = var.legacy_browser_subfilters
          
            depends_on = [sentry_project.projects]
            }

"4.1":
  terraform:
    lang: "hcl"
    filename: "hth-sentry-4.01-configure-audit-logs.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/sentry/terraform/hth-sentry-4.01-configure-audit-logs.tf"
    excerpts:
      terraform:
        content: |
            # Create a security monitoring alert for error volume spikes.
            # High-frequency errors can indicate application attacks, credential
            # stuffing, or integration abuse.
            resource "sentry_issue_alert" "security_monitoring" {
            count = var.security_alert_project != "" ? 1 : 0
          
            organization = var.sentry_organization
            project      = var.security_alert_project
            name         = "HTH: Security Event Monitoring"
          
            action_match = "any"
            filter_match = "any"
            frequency    = 30
          
            conditions = jsonencode([
              {
                id       = "sentry.rules.conditions.first_seen_event.FirstSeenEventCondition"
                name     = "A new issue is created"
              },
              {
                id       = "sentry.rules.conditions.event_frequency.EventFrequencyCondition"
                name     = "The issue is seen more than 100 times in 1 hour"
                value    = 100
                interval = "1h"
              }
            ])
          
            filters = jsonencode([
              {
                id    = "sentry.rules.filters.level.LevelFilter"
                match = "gte"
                level = "error"
                name  = "The event's level is equal to or greater than error"
              }
            ])
          
            actions = jsonencode([
              {
                id               = "sentry.mail.actions.NotifyEmailAction"
                name             = "Send a notification to the security team"
                targetType       = "IssueOwners"
                targetIdentifier = ""
              }
            ])
          
            depends_on = [sentry_project.projects]
            }
          
            # ---------------------------------------------------------------------------
            # Audit log review must be performed via Sentry UI or API:
            #
            #   UI: Settings > Audit Log
            #
            #   API: GET /api/0/organizations/{org_slug}/audit-logs/
            #
            # Key events to monitor:
            #   - org.edit (organization settings changes)
            #   - member.join / member.leave (membership changes)
            #   - member.role-change (privilege escalation)
            #   - project.create / project.remove (project lifecycle)
            #   - sso.enable / sso.disable (SSO changes)
            #   - api-key.create / api-key.remove (key management)
            #
            # For L3, integrate audit logs with a SIEM via the Sentry API
            # or webhook integrations.
            # ---------------------------------------------------------------------------

