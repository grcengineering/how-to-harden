# AUTO-GENERATED by scripts/sync-packs-to-data.sh — do not edit manually
# Generated: 2026-02-19T16:51:07Z

"1.1":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-1.01-configure-saml-mfa.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-1.01-configure-saml-mfa.sh"
    excerpts:
      api-configure-saml-mfa:
        content: |
            # BeyondTrust API - Configure SAML provider
            curl -X POST "https://${BEYONDTRUST_HOST}/api/config/security-provider" \
            -H "Authorization: Bearer ${API_TOKEN}" \
            -H "Content-Type: application/json" \
            -d '{
              "type": "saml",
              "name": "Corporate SSO",
              "idpEntityId": "https://idp.company.com",
              "ssoUrl": "https://idp.company.com/saml/sso",
              "certificate": "-----BEGIN CERTIFICATE-----...",
              "signatureAlgorithm": "RSA-SHA256",
              "requireMfa": true
            }'

"1.3":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-1.03-restrict-api-ip.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-1.03-restrict-api-ip.sh"
    excerpts:
      api-restrict-api-ip:
        content: |
            # API configuration - Restrict API key to specific IPs
            curl -X PUT "https://${BEYONDTRUST_HOST}/api/config/api-keys/${KEY_ID}" \
            -H "Authorization: Bearer ${ADMIN_TOKEN}" \
            -H "Content-Type: application/json" \
            -d '{
              "name": "Integration-ServiceNow",
              "allowedIps": [
                "10.0.1.0/24",
                "203.0.113.50/32"
              ],
              "enabled": true
            }'

"2.1":
  sdk:
    lang: "python"
    filename: "hth-beyondtrust-2.01-api-key-rotation.py"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/sdk/hth-beyondtrust-2.01-api-key-rotation.py"
    excerpts:
      sdk-api-key-rotation:
        content: |
            import requests
            import json
            from datetime import datetime, timedelta
          
            BEYONDTRUST_HOST = "https://beyondtrust.company.com"
          
            def rotate_api_key(admin_token, key_id, key_name, allowed_ips):
              """Rotate an API key and return new credentials"""
          
              # Create new key
              response = requests.post(
                  f"{BEYONDTRUST_HOST}/api/config/api-keys",
                  headers={"Authorization": f"Bearer {admin_token}"},
                  json={
                      "name": f"{key_name}-{datetime.now().strftime('%Y%m%d')}",
                      "allowedIps": allowed_ips,
                      "expiresAt": (datetime.now() + timedelta(days=90)).isoformat()
                  }
              )
              new_key = response.json()
          
              # Store new key securely (e.g., Vault)
              store_in_vault(key_name, new_key['apiKey'])
          
              # Revoke old key
              requests.delete(
                  f"{BEYONDTRUST_HOST}/api/config/api-keys/{key_id}",
                  headers={"Authorization": f"Bearer {admin_token}"}
              )
          
              return new_key
          
            def audit_api_keys(admin_token):
              """Audit all API keys for compliance"""
              response = requests.get(
                  f"{BEYONDTRUST_HOST}/api/config/api-keys",
                  headers={"Authorization": f"Bearer {admin_token}"}
              )
          
              keys = response.json()
              issues = []
          
              for key in keys:
                  # Check age
                  created = datetime.fromisoformat(key['createdAt'])
                  age_days = (datetime.now() - created).days
                  if age_days > 90:
                      issues.append(f"Key '{key['name']}' is {age_days} days old (max 90)")
          
                  # Check IP restrictions
                  if not key.get('allowedIps'):
                      issues.append(f"Key '{key['name']}' has no IP restrictions")
          
                  # Check last usage
                  if not key.get('lastUsed'):
                      issues.append(f"Key '{key['name']}' has never been used - consider removal")
          
              return issues

"2.3":
  db:
    lang: "sql"
    filename: "hth-beyondtrust-2.03-detect-api-anomalies.sql"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/db/hth-beyondtrust-2.03-detect-api-anomalies.sql"
    excerpts:
      db-detect-api-new-ips:
        content: |
            -- Detect API access from new IPs
            SELECT api_key_name, source_ip, COUNT(*) as requests
            FROM api_access_log
            WHERE source_ip NOT IN (
              SELECT DISTINCT source_ip
              FROM api_access_log
              WHERE timestamp < DATE_SUB(NOW(), INTERVAL 7 DAY)
            )
            AND timestamp > DATE_SUB(NOW(), INTERVAL 1 DAY)
            GROUP BY api_key_name, source_ip;
      db-detect-afterhours-api:
        content: |
            -- Detect after-hours API usage
            SELECT api_key_name, timestamp, endpoint, source_ip
            FROM api_access_log
            WHERE HOUR(timestamp) NOT BETWEEN 6 AND 20
              OR DAYOFWEEK(timestamp) IN (1, 7)
            ORDER BY timestamp DESC
            LIMIT 100;
      db-detect-bulk-access:
        content: |
            -- Detect bulk data access patterns
            SELECT api_key_name, endpoint, COUNT(*) as request_count
            FROM api_access_log
            WHERE timestamp > DATE_SUB(NOW(), INTERVAL 1 HOUR)
              AND endpoint LIKE '/api/sessions%'
            GROUP BY api_key_name, endpoint
            HAVING COUNT(*) > 50;

"3.1":
  cli:
    lang: "text"
    filename: "hth-beyondtrust-3.01-network-architecture.txt"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/cli/hth-beyondtrust-3.01-network-architecture.txt"
    excerpts:
      cli-network-architecture:
        content: |
            Internet
              │
              ▼
            ┌─────────────────┐
            │   WAF / CDN     │
            └────────┬────────┘
                   │ HTTPS only
                   ▼
            ┌─────────────────┐
            │   DMZ Zone      │
            │  ┌───────────┐  │
            │  │ BT Proxy  │  │
            │  └─────┬─────┘  │
            └────────┼────────┘
                   │ Internal only
                   ▼
            ┌─────────────────┐
            │  Internal Zone  │
            │  ┌───────────┐  │
            │  │ BT Server │  │
            │  └───────────┘  │
            └─────────────────┘

"5.2":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-5.02-configure-syslog.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-5.02-configure-syslog.sh"
    excerpts:
      api-configure-syslog:
        content: |
            # Configure syslog forwarding
            # In BeyondTrust configuration:
            # Management > System > Logging > Syslog
          
            # Syslog configuration
            Protocol: TLS
            Server: siem.company.com
            Port: 6514
            Format: CEF (Common Event Format)
            Events: All security events

"6.2":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-6.02-check-version.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-6.02-check-version.sh"
    excerpts:
      api-check-version:
        content: |
            # Check current version
            curl -s "https://${BEYONDTRUST_HOST}/api/system/version" \
            -H "Authorization: Bearer ${API_TOKEN}"
          
            # Verify patches applied
            # Compare version against BeyondTrust security advisories

