# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-24T15:24:55Z

"1.1":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-1.01-configure-saml-mfa.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-1.01-configure-saml-mfa.sh"
    excerpts:
      api-configure-saml-mfa:
        content: |
            # BeyondTrust API - Configure SAML provider
            curl -X POST "https://${BEYONDTRUST_HOST}/api/config/security-provider" \
            -H "Authorization: Bearer ${API_TOKEN}" \
            -H "Content-Type: application/json" \
            -d '{
              "type": "saml",
              "name": "Corporate SSO",
              "idpEntityId": "https://idp.company.com",
              "ssoUrl": "https://idp.company.com/saml/sso",
              "certificate": "-----BEGIN CERTIFICATE-----...",
              "signatureAlgorithm": "RSA-SHA256",
              "requireMfa": true
            }'

"1.3":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-1.03-restrict-api-ip.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-1.03-restrict-api-ip.sh"
    excerpts:
      api-restrict-api-ip:
        content: |
            # API configuration - Restrict API key to specific IPs
            curl -X PUT "https://${BEYONDTRUST_HOST}/api/config/api-keys/${KEY_ID}" \
            -H "Authorization: Bearer ${ADMIN_TOKEN}" \
            -H "Content-Type: application/json" \
            -d '{
              "name": "Integration-ServiceNow",
              "allowedIps": [
                "10.0.1.0/24",
                "203.0.113.50/32"
              ],
              "enabled": true
            }'

"2.1":
  sdk:
    lang: "python"
    filename: "hth-beyondtrust-2.01-api-key-rotation.py"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/sdk/hth-beyondtrust-2.01-api-key-rotation.py"
    excerpts:
      sdk-api-key-rotation:
        content: |
            import requests
            import json
            from datetime import datetime, timedelta
          
            BEYONDTRUST_HOST = "https://beyondtrust.company.com"
          
            def rotate_api_key(admin_token, key_id, key_name, allowed_ips):
              """Rotate an API key and return new credentials"""
          
              # Create new key
              response = requests.post(
                  f"{BEYONDTRUST_HOST}/api/config/api-keys",
                  headers={"Authorization": f"Bearer {admin_token}"},
                  json={
                      "name": f"{key_name}-{datetime.now().strftime('%Y%m%d')}",
                      "allowedIps": allowed_ips,
                      "expiresAt": (datetime.now() + timedelta(days=90)).isoformat()
                  }
              )
              new_key = response.json()
          
              # Store new key securely (e.g., Vault)
              store_in_vault(key_name, new_key['apiKey'])
          
              # Revoke old key
              requests.delete(
                  f"{BEYONDTRUST_HOST}/api/config/api-keys/{key_id}",
                  headers={"Authorization": f"Bearer {admin_token}"}
              )
          
              return new_key
          
            def audit_api_keys(admin_token):
              """Audit all API keys for compliance"""
              response = requests.get(
                  f"{BEYONDTRUST_HOST}/api/config/api-keys",
                  headers={"Authorization": f"Bearer {admin_token}"}
              )
          
              keys = response.json()
              issues = []
          
              for key in keys:
                  # Check age
                  created = datetime.fromisoformat(key['createdAt'])
                  age_days = (datetime.now() - created).days
                  if age_days > 90:
                      issues.append(f"Key '{key['name']}' is {age_days} days old (max 90)")
          
                  # Check IP restrictions
                  if not key.get('allowedIps'):
                      issues.append(f"Key '{key['name']}' has no IP restrictions")
          
                  # Check last usage
                  if not key.get('lastUsed'):
                      issues.append(f"Key '{key['name']}' has never been used - consider removal")
          
              return issues

"6.2":
  api:
    lang: "bash"
    filename: "hth-beyondtrust-6.02-check-version.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/beyondtrust/api/hth-beyondtrust-6.02-check-version.sh"
    excerpts:
      api-check-version:
        content: |
            # Check current version
            curl -s "https://${BEYONDTRUST_HOST}/api/system/version" \
            -H "Authorization: Bearer ${API_TOKEN}"
          
            # Verify patches applied
            # Compare version against BeyondTrust security advisories

