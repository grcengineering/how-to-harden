# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-21T17:31:57Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-1.01-enforce-sso-with-mfa.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-1.01-enforce-sso-with-mfa.tf"
    excerpts:
      terraform:
        content: |
          
            # Configure SAML SSO for centralized authentication with MFA enforcement
            resource "artifactory_saml_settings" "sso" {
            enable                       = true
            login_url                    = var.saml_idp_url
            certificate                  = var.saml_idp_certificate
            service_provider_name        = var.saml_service_provider_id
            allow_user_to_access_profile = false
            auto_redirect                = true
            no_auto_user_creation        = false
            use_encrypted_assertion      = true
            }
          
            # Disable anonymous access to force authenticated sessions
            resource "artifactory_general_security" "disable_anonymous" {
            enable_anonymous_access = false
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-1.02-implement-permission-targets.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-1.02-implement-permission-targets.tf"
    excerpts:
      terraform:
        content: |
          
            # Production-Read: Read-only access for developers to release repositories
            resource "artifactory_permission_target" "production_read" {
            name = "hth-production-read"
          
            repo {
              repositories = [var.release_repo_key]
              actions {
                groups {
                  name        = var.release_readers_group
                  permissions = ["read", "annotate"]
                }
              }
            }
            }
          
            # Production-Write: Deploy access restricted to release managers
            resource "artifactory_permission_target" "production_write" {
            name = "hth-production-write"
          
            repo {
              repositories = [var.release_repo_key]
              actions {
                groups {
                  name        = var.release_writers_group
                  permissions = ["read", "annotate", "deploy", "delete"]
                }
              }
            }
            }
          
            # Build-Upload: CI/CD service accounts can deploy to snapshot repos only
            resource "artifactory_permission_target" "build_upload" {
            name = "hth-build-upload"
          
            repo {
              repositories = [var.snapshot_repo_key]
              actions {
                groups {
                  name        = var.ci_cd_group
                  permissions = ["read", "deploy"]
                }
              }
            }
            }
          
            # L3: Strict read-only for all non-admin users on release repos
            resource "artifactory_permission_target" "strict_readonly" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "hth-strict-readonly"
          
            repo {
              repositories = [var.release_repo_key]
              actions {
                groups {
                  name        = var.release_readers_group
                  permissions = ["read"]
                }
              }
            }
            }

"1.3":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-1.03-secure-api-keys-and-tokens.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-1.03-secure-api-keys-and-tokens.tf"
    excerpts:
      terraform:
        content: |
          
            # Create a scoped access token for CI/CD pipelines with limited expiry
            resource "artifactory_scoped_token" "ci_cd_token" {
            scopes      = ["applied-permissions/groups:${var.ci_cd_group}"]
            expires_in  = var.token_expiry_seconds
            description = "HTH: Scoped CI/CD token with ${var.token_expiry_seconds / 86400}-day expiry"
            }
          
            # L2: Create a shorter-lived admin token with tighter rotation
            resource "artifactory_scoped_token" "admin_token" {
            count = var.profile_level >= 2 ? 1 : 0
          
            scopes      = ["applied-permissions/admin"]
            expires_in  = 2592000 # 30 days
            description = "HTH: Short-lived admin token (30-day expiry, L2+)"
            }
  cli:
    lang: "bash"
    filename: "hth-jfrog-1.03-secure-api-keys-and-tokens.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/cli/hth-jfrog-1.03-secure-api-keys-and-tokens.sh"
    excerpts:
      create-scoped-token:
        content: |
            # Create scoped token via CLI
            jf rt access-token-create \
            --groups readers \
            --scope applied-permissions/groups:readers \
            --expiry 7776000  # 90 days

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-2.01-configure-repository-layout-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-2.01-configure-repository-layout-security.tf"
    excerpts:
      terraform:
        content: |
          
            # Harden local Maven release repository with restricted settings
            resource "artifactory_local_maven_repository" "release" {
            key                   = var.release_repo_key
            description           = "HTH: Hardened release repository - handles releases only"
            handle_releases       = true
            handle_snapshots      = false
            suppress_pom_consistency_checks = false
            xray_index            = true
            property_sets         = ["artifactory"]
            }
          
            # Harden local Maven snapshot repository
            resource "artifactory_local_maven_repository" "snapshot" {
            key                   = var.snapshot_repo_key
            description           = "HTH: Hardened snapshot repository - handles snapshots only"
            handle_releases       = false
            handle_snapshots      = true
            suppress_pom_consistency_checks = false
            xray_index            = true
            max_unique_snapshots  = 5
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-2.02-remote-repository-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-2.02-remote-repository-security.tf"
    excerpts:
      terraform:
        content: |
          
            # Harden remote Maven repository proxy with security controls
            resource "artifactory_remote_maven_repository" "secure_remote" {
            key                            = var.remote_repo_key
            url                            = var.remote_repo_url
            description                    = "HTH: Hardened remote repository proxy"
            store_artifacts_locally        = true
            hard_fail                      = true
            block_mismatching_mime_types   = true
            excludes_pattern               = var.blocked_remote_extensions
            xray_index                     = true
            content_synchronisation {
              enabled = false
            }
            }
          
            # L2: Enforce strict checksum validation on remote repositories
            resource "artifactory_remote_maven_repository" "strict_checksum_remote" {
            count = var.profile_level >= 2 ? 1 : 0
          
            key                            = "${var.remote_repo_key}-strict"
            url                            = var.remote_repo_url
            description                    = "HTH: Strict checksum remote repository (L2+)"
            store_artifacts_locally        = true
            hard_fail                      = true
            block_mismatching_mime_types   = true
            excludes_pattern               = var.blocked_remote_extensions
            xray_index                     = true
            remote_repo_checksum_policy_type = "fail"
            content_synchronisation {
              enabled = false
            }
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-2.03-prevent-dependency-confusion.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-2.03-prevent-dependency-confusion.tf"
    excerpts:
      terraform:
        content: |
          
            # Virtual repository with internal repos resolved first to prevent
            # dependency confusion attacks. Internal repositories take priority
            # over external/remote repositories in the resolution order.
            resource "artifactory_virtual_maven_repository" "secure_virtual" {
            key                                        = var.virtual_repo_key
            description                                = "HTH: Virtual repo with priority resolution to prevent dependency confusion"
            repositories                               = concat(var.internal_repo_keys, var.external_repo_keys)
            default_deployment_repo                    = var.internal_repo_keys[0]
            artifactory_requests_can_retrieve_remote_artifacts = true
            force_maven_authentication                 = true
            }
          
            # L2: Disable remote artifact retrieval through virtual repos
            # to further isolate internal from external dependencies
            resource "artifactory_virtual_maven_repository" "isolated_virtual" {
            count = var.profile_level >= 2 ? 1 : 0
          
            key                                        = "${var.virtual_repo_key}-isolated"
            description                                = "HTH: Isolated virtual repo - no remote retrieval (L2+)"
            repositories                               = var.internal_repo_keys
            default_deployment_repo                    = var.internal_repo_keys[0]
            artifactory_requests_can_retrieve_remote_artifacts = false
            force_maven_authentication                 = true
            }
  cli:
    lang: "yaml"
    filename: "hth-jfrog-2.03-prevent-dependency-confusion.yml"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/cli/hth-jfrog-2.03-prevent-dependency-confusion.yml"
    excerpts:
      virtual-repo-config:
        content: |
            # Virtual repository configuration
            virtual_repository:
            repositories:
              - internal-libs     # First priority (internal)
              - remote-maven     # Second priority (external)
            default_deployment_repo: internal-libs

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-3.01-enable-artifact-signing.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-3.01-enable-artifact-signing.tf"
    excerpts:
      terraform:
        content: |
          
            # Configure GPG signing key for artifact verification (L2+)
            resource "artifactory_keypair" "gpg_signing" {
            count = var.profile_level >= 2 ? 1 : 0
          
            pair_name   = "hth-artifact-signing"
            pair_type   = "GPG"
            alias       = "hth-gpg"
            public_key  = var.gpg_public_key
            passphrase  = ""
            }
          
            # Associate signing key with release repository for signature enforcement
            resource "artifactory_local_maven_repository" "signed_release" {
            count = var.profile_level >= 2 ? 1 : 0
          
            key                   = "${var.release_repo_key}-signed"
            description           = "HTH: Signed release repository with GPG verification (L2+)"
            handle_releases       = true
            handle_snapshots      = false
            xray_index            = true
            primary_keypair_ref   = artifactory_keypair.gpg_signing[0].pair_name
            }
  cli:
    lang: "bash"
    filename: "hth-jfrog-3.01-enable-artifact-signing.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/cli/hth-jfrog-3.01-enable-artifact-signing.sh"
    excerpts:
      sign-and-verify:
        content: |
            # Sign artifact during deployment
            jf rt upload --gpg-key=/path/to/key.asc artifact.jar libs-release-local/
          
            # Verify artifact signature
            jf rt download libs-release-local/artifact.jar --gpg-key=/path/to/public.asc

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-3.02-immutable-artifacts.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-3.02-immutable-artifacts.tf"
    excerpts:
      terraform:
        content: |
          
            # Immutable release repository: block re-deployment of existing versions (L2+)
            # Once an artifact version is published, it cannot be overwritten.
            resource "artifactory_local_maven_repository" "immutable_release" {
            count = var.profile_level >= 2 ? 1 : 0
          
            key                             = "${var.release_repo_key}-immutable"
            description                     = "HTH: Immutable release repository - no redeployment (L2+)"
            handle_releases                 = true
            handle_snapshots                = false
            suppress_pom_consistency_checks = false
            xray_index                      = true
          
            # Block re-deployment to enforce immutability
            # Users cannot overwrite existing artifact versions
            }
          
            # L3: Restrict delete permissions to prevent artifact removal
            resource "artifactory_permission_target" "immutable_no_delete" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name = "hth-immutable-no-delete"
          
            repo {
              repositories = ["${var.release_repo_key}-immutable"]
              actions {
                groups {
                  name        = var.release_readers_group
                  permissions = ["read"]
                }
                groups {
                  name        = var.release_writers_group
                  permissions = ["read", "annotate", "deploy"]
                }
              }
            }
            }

"4.2":
  cli:
    lang: "yaml"
    filename: "hth-jfrog-4.02-cve-remediation-workflow.yml"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/cli/hth-jfrog-4.02-cve-remediation-workflow.yml"
    excerpts:
      xray-block-critical-policy:
        content: |
            # Xray policy - Block critical vulnerabilities
            policy:
            name: block-critical-cves
            type: security
            rules:
              - name: critical-cve-block
                criteria:
                  min_severity: critical
                actions:
                  block_download:
                    active: true
                  fail_build: true

"5.1":
  terraform:
    lang: "hcl"
    filename: "hth-jfrog-5.01-audit-logging.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/jfrog/terraform/hth-jfrog-5.01-audit-logging.tf"
    excerpts:
      terraform:
        content: |
          
            # Webhook for forwarding deployment events to SIEM
            resource "artifactory_webhook" "deploy_events" {
            count = var.audit_webhook_url != "" ? 1 : 0
          
            key         = "hth-deploy-audit"
            description = "HTH: Forward artifact deploy events to SIEM"
            event_types = ["deployed", "deleted", "moved", "copied"]
            url         = var.audit_webhook_url
            enabled     = true
          
            criteria {
              any_local  = true
              any_remote = false
            }
            }
          
            # L2: Webhook for permission and access control change events
            resource "artifactory_webhook" "access_events" {
            count = var.profile_level >= 2 && var.audit_webhook_url != "" ? 1 : 0
          
            key         = "hth-access-audit"
            description = "HTH: Forward access control events to SIEM (L2+)"
            event_types = ["deployed", "deleted", "moved", "copied", "downloaded"]
            url         = var.audit_webhook_url
            enabled     = true
          
            criteria {
              any_local  = true
              any_remote = true
            }
            }
          
            # L3: Comprehensive download audit for all repository access
            resource "artifactory_webhook" "download_audit" {
            count = var.profile_level >= 3 && var.audit_webhook_url != "" ? 1 : 0
          
            key         = "hth-download-audit"
            description = "HTH: Audit all artifact downloads (L3)"
            event_types = ["downloaded"]
            url         = var.audit_webhook_url
            enabled     = true
          
            criteria {
              any_local  = true
              any_remote = true
            }
            }

