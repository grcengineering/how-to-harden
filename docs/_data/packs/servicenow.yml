# AUTO-GENERATED by scripts/sync-packs-to-data.sh — do not edit manually
# Generated: 2026-02-17T04:21:56Z

"1.1":
  api:
    lang: "bash"
    filename: "hth-servicenow-1.01-configure-saml-sso.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/api/hth-servicenow-1.01-configure-saml-sso.sh"
    excerpts:
      api-check-sso-plugin:
        content: |
          info "1.1 Checking Multi-Provider SSO plugin status..."
          SSO_PLUGIN=$(sn_table_get "sys_plugins" \
            "sysparm_query=id=com.snc.integration.sso.multi&sysparm_fields=id,active" \
            | jq -r '.result[0].active // empty' 2>/dev/null || true)
          
          if [ "${SSO_PLUGIN}" = "active" ]; then
            pass "1.1 Multi-Provider SSO plugin is active"
          else
            fail "1.1 Multi-Provider SSO plugin is NOT active — enable via Plugins"
            increment_failed
          fi
      api-check-sso-properties:
        content: |
          info "1.1 Checking SSO properties..."
          SSO_ENABLED=$(sn_table_get "sys_properties" \
            "sysparm_query=name=glide.authenticate.sso.redirect.url&sysparm_fields=name,value" \
            | jq -r '.result[0].value // empty' 2>/dev/null || true)
          
          if [ -n "${SSO_ENABLED}" ]; then
            pass "1.1 SAML SSO redirect URL is configured: ${SSO_ENABLED}"
          else
            warn "1.1 SAML SSO redirect URL not found — SSO may not be configured"
          fi
          
          # Verify SAML 2.0 IdP records exist
          IDP_COUNT=$(sn_table_get "sso_properties" \
            "sysparm_query=protocol=saml2&sysparm_fields=name,protocol,is_default" \
            | jq -r '.result | length' 2>/dev/null || echo "0")
          
          if [ "${IDP_COUNT}" -gt 0 ]; then
            pass "1.1 Found ${IDP_COUNT} SAML 2.0 Identity Provider configuration(s)"
            increment_applied
          else
            fail "1.1 No SAML 2.0 IdP configurations found — configure SSO in Multi-Provider SSO"
            increment_failed
          fi

"2.2":
  api:
    lang: "bash"
    filename: "hth-servicenow-2.02-enable-high-security-plugins.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/api/hth-servicenow-2.02-enable-high-security-plugins.sh"
    excerpts:
      api-check-high-security-plugin:
        content: |
          info "2.2 Checking High Security Settings plugin..."
          HS_PLUGIN=$(sn_table_get "sys_plugins" \
            "sysparm_query=id=com.glide.security.high&sysparm_fields=id,active" \
            | jq -r '.result[0].active // empty' 2>/dev/null || true)
          
          if [ "${HS_PLUGIN}" = "active" ]; then
            pass "2.2 High Security Settings plugin is active"
            increment_applied
          else
            fail "2.2 High Security Settings plugin is NOT active"
            fail "2.2 Navigate to System Definition > Plugins and activate 'High Security Settings'"
            increment_failed
          fi
      api-check-security-properties:
        content: |
          info "2.2 Checking security system properties..."
          
          check_property() {
            local prop_name="$1"
            local expected="$2"
            local description="$3"
          
            local value
            value=$(sn_property "${prop_name}")
          
            if [ "${value}" = "${expected}" ]; then
              pass "2.2 ${description}: ${prop_name}=${value}"
            elif [ -z "${value}" ]; then
              warn "2.2 ${description}: ${prop_name} not set (expected: ${expected})"
            else
              fail "2.2 ${description}: ${prop_name}=${value} (expected: ${expected})"
            fi
          }
          
          check_property "glide.security.default.deny" "true" \
            "Default deny ACLs"
          check_property "glide.security.use_secure_cookies" "true" \
            "Secure cookies"
          check_property "glide.security.strict.xframe" "true" \
            "X-Frame-Options strict mode"
          check_property "glide.basicauth.required.user_password" "true" \
            "Require password for basic auth"
          check_property "glide.security.csrf_previous.enabled" "true" \
            "CSRF protection"
  sigma:
    - lang: "yaml"
      filename: "hth-servicenow-2.02-security-property-changed.yml"
      source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/siem/sigma/hth-servicenow-2.02-security-property-changed.yml"
      excerpts:
        detection:
          content: |
            detection:
                selection:
                    tablename: 'sys_properties'
                    fieldname: 'value'
                filter_security_properties:
                    documentkey|contains:
                        - 'glide.security.default.deny'
                        - 'glide.security.use_secure_cookies'
                        - 'glide.security.strict.xframe'
                        - 'glide.basicauth.required.user_password'
                        - 'glide.security.csrf_previous.enabled'
                        - 'glide.authenticate.multifactor'
                condition: selection and filter_security_properties
            fields:
                - sys_created_on
                - user
                - tablename
                - fieldname
                - oldvalue
                - newvalue
                - documentkey

"3.2":
  api:
    lang: "bash"
    filename: "hth-servicenow-3.02-limit-admin-access.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/api/hth-servicenow-3.02-limit-admin-access.sh"
    excerpts:
      api-audit-admin-roles:
        content: |
          info "3.2 Querying admin role assignments..."
          ADMIN_ROLES=$(sn_table_get "sys_user_has_role" \
            "sysparm_query=role.name=admin^state=active&sysparm_fields=user.user_name,user.name,user.active,user.last_login_time" \
            2>/dev/null || true)
          
          ADMIN_COUNT=$(echo "${ADMIN_ROLES}" | jq -r '.result | length' 2>/dev/null || echo "0")
          
          info "3.2 Found ${ADMIN_COUNT} active admin role assignment(s)"
          
          # List each admin
          if [ "${ADMIN_COUNT}" -gt 0 ]; then
            echo "${ADMIN_ROLES}" | jq -r '.result[] | "  - \(.["user.user_name"] // "unknown") (\(.["user.name"] // "N/A")) — last login: \(.["user.last_login_time"] // "never")"' 2>/dev/null || true
          fi
      api-flag-excessive-admins:
        content: |
          MAX_ADMINS=5
          if [ "${ADMIN_COUNT}" -le "${MAX_ADMINS}" ]; then
            pass "3.2 Admin count (${ADMIN_COUNT}) is within threshold (<= ${MAX_ADMINS})"
            increment_applied
          else
            fail "3.2 Excessive admin count: ${ADMIN_COUNT} (threshold: ${MAX_ADMINS})"
            fail "3.2 Review admin assignments and remove unnecessary privileges"
            increment_failed
          fi
  sigma:
    - lang: "yaml"
      filename: "hth-servicenow-3.02-admin-role-granted.yml"
      source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/siem/sigma/hth-servicenow-3.02-admin-role-granted.yml"
      excerpts:
        detection:
          content: |
            detection:
                selection:
                    tablename: 'sys_user_has_role'
                    fieldname: 'role'
                    newvalue|contains: 'admin'
                condition: selection
            fields:
                - sys_created_on
                - user
                - tablename
                - fieldname
                - newvalue
                - documentkey

"4.1":
  api:
    lang: "bash"
    filename: "hth-servicenow-4.01-configure-audit-logging.sh"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/api/hth-servicenow-4.01-configure-audit-logging.sh"
    excerpts:
      api-check-audit-properties:
        content: |
          info "4.1 Checking audit-related system properties..."
          
          AUDIT_ACTIVE=$(sn_property "glide.sys.audit.active")
          if [ "${AUDIT_ACTIVE}" = "true" ]; then
            pass "4.1 System audit is active (glide.sys.audit.active=true)"
            increment_applied
          else
            fail "4.1 System audit is NOT active — set glide.sys.audit.active=true"
            increment_failed
          fi
          
          AUDIT_DELETE=$(sn_property "glide.sys.audit.delete")
          if [ "${AUDIT_DELETE}" = "true" ]; then
            pass "4.1 Delete auditing is enabled (glide.sys.audit.delete=true)"
          else
            warn "4.1 Delete auditing is not enabled — set glide.sys.audit.delete=true"
          fi
          
          LOGIN_TRACKING=$(sn_property "glide.ui.login_tracking")
          if [ "${LOGIN_TRACKING}" = "true" ]; then
            pass "4.1 Login tracking is enabled (glide.ui.login_tracking=true)"
          else
            warn "4.1 Login tracking is not enabled — set glide.ui.login_tracking=true"
          fi
      api-query-recent-audits:
        content: |
          info "4.1 Querying recent audit log entries..."
          RECENT_AUDITS=$(sn_table_get "sys_audit" \
            "sysparm_query=ORDERBYDESCsys_created_on&sysparm_limit=10&sysparm_fields=sys_created_on,user,tablename,fieldname,newvalue,oldvalue" \
            2>/dev/null || true)
          
          AUDIT_COUNT=$(echo "${RECENT_AUDITS}" | jq -r '.result | length' 2>/dev/null || echo "0")
          
          if [ "${AUDIT_COUNT}" -gt 0 ]; then
            pass "4.1 Audit log is operational — found ${AUDIT_COUNT} recent entries"
            info "4.1 Latest audit entries:"
            echo "${RECENT_AUDITS}" | jq -r '.result[:5][] | "  - \(.sys_created_on) | \(.user) | \(.tablename).\(.fieldname) | \(.oldvalue // "-") -> \(.newvalue // "-")"' 2>/dev/null || true
          else
            fail "4.1 No recent audit entries found — verify audit configuration"
            increment_failed
          fi
  sigma:
    - lang: "yaml"
      filename: "hth-servicenow-4.01-audit-log-export.yml"
      source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/servicenow/siem/sigma/hth-servicenow-4.01-audit-log-export.yml"
      excerpts:
        detection:
          content: |
            detection:
                selection_audit_access:
                    tablename: 'sys_audit'
                selection_deletion:
                    tablename: 'sys_audit_delete'
                selection_export:
                    tablename|contains: 'sys_audit'
                    fieldname: 'export'
                condition: selection_audit_access or selection_deletion or selection_export
            fields:
                - sys_created_on
                - user
                - tablename
                - fieldname
                - newvalue
                - oldvalue

