# AUTO-GENERATED by scripts/sync-packs-to-data.sh â€” do not edit manually
# Generated: 2026-02-20T08:35:12Z

"1.1":
  terraform:
    lang: "hcl"
    filename: "hth-orca-1.01-configure-saml-sso.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-1.01-configure-saml-sso.tf"
    excerpts:
      terraform:
        content: |
            # SSO user group -- assign SSO-authenticated users here for group-based policies
            resource "orcasecurity_group" "sso_users" {
            name        = var.sso_group_name
            description = "Group for SSO-authenticated users. Assign this group in SAML IdP attribute mappings to enforce group-based access control."
            sso_group   = true
            users       = var.sso_user_ids
            }

"1.2":
  terraform:
    lang: "hcl"
    filename: "hth-orca-1.02-enforce-mfa.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-1.02-enforce-mfa.tf"
    excerpts:
      terraform:
        content: |
            # Alert for IAM misconfigurations related to authentication weaknesses
            resource "orcasecurity_custom_sonar_alert" "mfa_not_enforced" {
            name          = "Orca Users Without SSO/MFA Coverage"
            description   = "Detects scenarios where cloud identities connected to Orca may not have MFA enforced, indicating a gap in authentication hardening."
            rule          = "User with MFAEnabled = false"
            orca_score    = 8.0
            category      = "Authentication"
            context_score = true
          
            remediation_text = {
              enable = true
              text   = "Ensure all users authenticate through the configured SAML SSO provider with MFA enforced. Remove local accounts that bypass SSO. See HTH Orca Guide section 1.2."
            }
          
            compliance_frameworks = [
              { name = "HTH Orca Hardening", section = "1.2 Enforce MFA", priority = "high" }
            ]
            }

"2.1":
  terraform:
    lang: "hcl"
    filename: "hth-orca-2.01-configure-rbac.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-2.01-configure-rbac.tf"
    excerpts:
      terraform:
        content: |
            # Read-only Security Analyst role -- least privilege for daily operations
            resource "orcasecurity_custom_role" "security_analyst" {
            name        = var.readonly_role_name
            description = "Read-only role for security analysts. Permits viewing assets, alerts, dashboards, and compliance reports without modification rights. Per HTH Orca Guide 2.1."
          
            permission_groups = var.readonly_permissions
            }
          
            # Minimal Viewer role -- dashboard and asset visibility only
            resource "orcasecurity_custom_role" "viewer" {
            name        = var.viewer_role_name
            description = "Minimal viewer role for stakeholders who need visibility into cloud security posture without operational access. Per HTH Orca Guide 2.1."
          
            permission_groups = var.viewer_permissions
            }
          
            # Alert when users have overly broad permissions
            resource "orcasecurity_custom_sonar_alert" "excessive_permissions" {
            name          = "Cloud Identity with Excessive Permissions"
            description   = "Detects cloud identities with overly broad permissions that violate least privilege principles."
            rule          = "User with Permission = '*' or Permission = 'Admin'"
            orca_score    = 7.5
            category      = "IAM misconfigurations"
            context_score = true
          
            remediation_text = {
              enable = true
              text   = "Review and reduce permissions to the minimum required for the user's role. Use the Security Analyst or Viewer custom roles instead of Admin. See HTH Orca Guide section 2.1."
            }
          
            compliance_frameworks = [
              { name = "HTH Orca Hardening", section = "2.1 Configure RBAC", priority = "high" }
            ]
            }

"2.2":
  terraform:
    lang: "hcl"
    filename: "hth-orca-2.02-configure-account-scope.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-2.02-configure-account-scope.tf"
    excerpts:
      terraform:
        content: |
            # Business unit for scoped access -- limits visibility to specific cloud accounts
            resource "orcasecurity_business_unit" "scoped_environment" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name          = var.business_unit_name
            global_filter = false
          
            filter_data = {
              cloud_providers = var.business_unit_cloud_providers
              cloud_tags      = length(var.business_unit_cloud_tags) > 0 ? var.business_unit_cloud_tags : null
            }
            }
          
            # Restricted production business unit (L3) -- strictest scoping for regulated environments
            resource "orcasecurity_business_unit" "restricted_production" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name          = var.restricted_business_unit_name
            global_filter = false
          
            filter_data = {
              cloud_tags = var.restricted_cloud_tags
            }
            }

"2.3":
  terraform:
    lang: "hcl"
    filename: "hth-orca-2.03-limit-admin-access.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-2.03-limit-admin-access.tf"
    excerpts:
      terraform:
        content: |
            # Dedicated admin group -- limit membership to 2-3 trusted users
            resource "orcasecurity_group" "platform_admins" {
            name        = var.admin_group_name
            description = "Restricted admin group. Membership should be limited to 2-3 users maximum. All members require MFA via SSO. Per HTH Orca Guide 2.3."
            sso_group   = true
            users       = var.admin_user_ids
            }
          
            # Alert when admin count exceeds recommended limit
            resource "orcasecurity_custom_sonar_alert" "excessive_admins" {
            name          = "Excessive Admin Accounts Detected"
            description   = "Monitors for an excessive number of admin-level accounts in the Orca platform, which increases attack surface."
            rule          = "User with Role = 'Admin'"
            orca_score    = 7.0
            category      = "Access control"
            context_score = false
          
            remediation_text = {
              enable = true
              text   = "Reduce admin accounts to 2-3 users maximum. Assign the Security Analyst or Viewer custom role to users who do not require admin privileges. See HTH Orca Guide section 2.3."
            }
          
            compliance_frameworks = [
              { name = "HTH Orca Hardening", section = "2.3 Limit Admin Access", priority = "high" }
            ]
            }

"3.1":
  terraform:
    lang: "hcl"
    filename: "hth-orca-3.01-configure-cloud-account-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-3.01-configure-cloud-account-security.tf"
    excerpts:
      terraform:
        content: |
            # Register trusted cloud accounts used by Orca integrations
            resource "orcasecurity_trusted_cloud_account" "trusted" {
            for_each = { for idx, acct in var.trusted_cloud_accounts : acct.cloud_provider_id => acct }
          
            account_name      = each.value.account_name
            description       = each.value.description
            cloud_provider    = each.value.cloud_provider
            cloud_provider_id = each.value.cloud_provider_id
            }
          
            # Alert for cloud accounts with overly permissive IAM roles
            resource "orcasecurity_custom_sonar_alert" "overprivileged_integration" {
            name          = "Cloud Integration with Excessive Permissions"
            description   = "Detects cloud accounts connected to Orca with permissions exceeding read-only access, violating least privilege for security tooling."
            rule          = "CloudAccount with PermissionLevel != 'ReadOnly'"
            orca_score    = 8.0
            category      = "IAM misconfigurations"
            context_score = true
          
            remediation_text = {
              enable = true
              text   = "Review cloud account IAM roles and reduce to read-only where possible. Follow Orca's recommended IAM policies for each cloud provider. See HTH Orca Guide section 3.1."
            }
          
            compliance_frameworks = [
              { name = "HTH Orca Hardening", section = "3.1 Cloud Account Security", priority = "high" }
            ]
            }
          
            # Discovery view to inventory all connected cloud accounts
            resource "orcasecurity_discovery_view" "cloud_accounts_inventory" {
            name               = "HTH - Connected Cloud Accounts Inventory"
            organization_level = true
            view_type          = "discovery"
            extra_params       = {}
          
            filter_data = {
              query = jsonencode({
                "models" : ["CloudAccount"],
                "type" : "object_set"
              })
            }
            }

"3.2":
  terraform:
    lang: "hcl"
    filename: "hth-orca-3.02-configure-api-security.tf"
    source_url: "https://github.com/grcengineering/how-to-harden/blob/main/packs/orca/terraform/hth-orca-3.02-configure-api-security.tf"
    excerpts:
      terraform:
        content: |
            # Custom alert to detect stale or unused API keys in connected cloud accounts
            resource "orcasecurity_custom_sonar_alert" "stale_api_keys" {
            count = var.profile_level >= 2 ? 1 : 0
          
            name          = var.api_alert_name
            description   = "Detects API keys that have not been rotated or used recently, indicating stale credentials that should be revoked."
            rule          = "AccessKey with LastUsedDate before_days 90"
            orca_score    = var.api_alert_score
            category      = "IAM misconfigurations"
            context_score = true
          
            remediation_text = {
              enable = true
              text   = "Rotate or revoke API keys that have not been used in 90+ days. Store active keys in a secrets manager. Document the purpose of each key. See HTH Orca Guide section 3.2."
            }
          
            compliance_frameworks = [
              { name = "HTH Orca Hardening", section = "3.2 API Security", priority = "medium" }
            ]
            }
          
            # Automation to email security team when stale API keys are found (L2+)
            resource "orcasecurity_automation" "api_key_alert" {
            count = var.profile_level >= 2 && var.enable_api_automation && length(var.api_alert_emails) > 0 ? 1 : 0
          
            name        = "HTH - API Key Security Notifications"
            description = "Sends email notifications when stale or unused API keys are detected. Per HTH Orca Guide section 3.2."
            enabled     = true
          
            query = {
              filter = [
                { field = "state.status", includes = ["open"] },
                { field = "state.risk_level", includes = ["high", "critical"] },
                { field = "category", includes = ["IAM misconfigurations"] }
              ]
            }
          
            email_template = {
              email        = var.api_alert_emails
              multi_alerts = true
            }
            }
          
            # Discovery view for API key inventory (L3) -- strict tracking of all API credentials
            resource "orcasecurity_discovery_view" "api_key_inventory" {
            count = var.profile_level >= 3 ? 1 : 0
          
            name               = "HTH - API Key Inventory (All Cloud Accounts)"
            organization_level = true
            view_type          = "discovery"
            extra_params       = {}
          
            filter_data = {
              query = jsonencode({
                "models" : ["AccessKey"],
                "type" : "object_set"
              })
            }
            }

