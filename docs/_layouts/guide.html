---
layout: default
---
{% assign maturity = page.maturity | default: "draft" %}
{% assign version = page.version | default: "0.1.0" %}

{% if maturity == "verified" %}
<div class="status-banner verified-banner">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
  <span>v{{ version }}-verified</span>
  <span class="status-label">Human Verified</span>
</div>
{% elsif maturity == "reviewed" %}
<div class="status-banner reviewed-banner">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
    <circle cx="12" cy="12" r="3"></circle>
  </svg>
  <span>v{{ version }}-reviewed</span>
  <span class="status-label">Human Reviewed</span>
</div>
{% else %}
<div class="status-banner draft-banner">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
    <line x1="12" y1="9" x2="12" y2="14"></line>
    <circle cx="12" cy="17" r="0.6" fill="currentColor"></circle>
  </svg>
  <span>v{{ version }}-draft</span>
  <span class="status-label">AI Drafted</span>
</div>
{% endif %}

<article class="guide">
  <div class="guide-header">
    <div class="breadcrumb">
      <a href="{{ '/' | relative_url }}">Home</a>
      <span class="separator">/</span>
      <a href="{{ '/#guides' | relative_url }}">Guides</a>
      <span class="separator">/</span>
      <span class="current">{{ page.vendor }}</span>
    </div>
    <h1>{{ page.title }}</h1>
    <div class="guide-meta">
      <span class="category category-tag category-{{ page.category | downcase }}">{{ page.category }}</span>
      <span class="updated">Last updated: {{ page.last_updated }}</span>
    </div>
    {% if page.description %}
    <p class="guide-description">{{ page.description }}</p>
    {% endif %}
    {% assign links = site.data.doc_links[page.slug] %}
    {% if links %}
    <div class="guide-doc-links">
      {% if links.product_docs and links.product_docs != "" %}
      <a href="{{ links.product_docs }}" target="_blank" rel="noopener noreferrer" class="doc-link-btn doc-link-product">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
        Product Docs
      </a>
      {% endif %}
      {% if links.api_docs and links.api_docs != "" %}
      <a href="{{ links.api_docs }}" target="_blank" rel="noopener noreferrer" class="doc-link-btn doc-link-api">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
        API Docs
      </a>
      {% endif %}
      {% if links.hardening_docs and links.hardening_docs != "" %}
      <a href="{{ links.hardening_docs }}" target="_blank" rel="noopener noreferrer" class="doc-link-btn doc-link-hardening">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
        Hardening Guide
      </a>
      {% endif %}
      {% if links.code_pack and links.code_pack != "" %}
      <a href="{{ links.code_pack }}" target="_blank" rel="noopener noreferrer" class="doc-link-btn doc-link-code-pack">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
        Code Pack
      </a>
      {% endif %}
    </div>
    {% if links.code_pack and links.code_pack != "" %}
    <div class="guide-code-pack">
      <span class="code-pack-label">Code Packs:</span>
      <a href="{{ links.code_pack }}/terraform" target="_blank" rel="noopener noreferrer" class="code-pack-btn code-pack-terraform">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="8" height="8" rx="1"></rect><rect x="14" y="2" width="8" height="8" rx="1"></rect><rect x="8" y="14" width="8" height="8" rx="1"></rect></svg>
        Terraform
      </a>
      <a href="{{ links.code_pack }}/api" target="_blank" rel="noopener noreferrer" class="code-pack-btn code-pack-api">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"></rect><line x1="9" y1="9" x2="15" y2="9"></line><line x1="9" y1="13" x2="13" y2="13"></line></svg>
        API Scripts
      </a>
      <a href="{{ links.code_pack }}/siem" target="_blank" rel="noopener noreferrer" class="code-pack-btn code-pack-siem">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
        SIEM Queries
      </a>
    </div>
    {% endif %}
    {% endif %}
  </div>

  <div class="guide-content">
    <aside class="guide-sidebar">
      <nav class="toc">
        <h3>On this page</h3>
        <ul id="toc-list"></ul>
      </nav>
    </aside>

    <div class="guide-body">
      {{ content }}
    </div>
  </div>
</article>

<script>
// Generate table of contents
document.addEventListener('DOMContentLoaded', function() {
  var headings = document.querySelectorAll('.guide-body h2, .guide-body h3');
  var tocList = document.getElementById('toc-list');

  headings.forEach(function(heading) {
    if (!heading.id) {
      heading.id = heading.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-');
    }
    var li = document.createElement('li');
    li.className = heading.tagName.toLowerCase();
    var a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;
    li.appendChild(a);
    tocList.appendChild(li);
  });
});
</script>

<script>
// Code block enhancement — two-tier progressive approach
// Tier 1: Instant styled wrappers with language label + copy button
// Tier 2: Monaco Editor upgrade from self-hosted files
(function() {
  'use strict';

  var MONACO_BASE = '{{ "/assets/monaco/vs" | relative_url }}';
  var MONACO_TIMEOUT = 10000; // 10s timeout for loading

  // Language mapping: kramdown class → Monaco language ID
  var LANG_MAP = {
    bash: 'shell', sh: 'shell', shell: 'shell', zsh: 'shell',
    json: 'json',
    yaml: 'yaml', yml: 'yaml',
    hcl: 'hcl', terraform: 'hcl', tf: 'hcl',
    python: 'python', py: 'python',
    powershell: 'powershell', ps1: 'powershell',
    sql: 'sql',
    xml: 'xml', html: 'html',
    javascript: 'javascript', js: 'javascript',
    typescript: 'typescript', ts: 'typescript',
    ini: 'ini', conf: 'ini',
    groovy: 'groovy',
    dockerfile: 'dockerfile',
    ruby: 'ruby', rb: 'ruby',
    go: 'go',
    java: 'java',
    csharp: 'csharp', cs: 'csharp',
    css: 'css',
    markdown: 'markdown', md: 'markdown',
    plaintext: 'plaintext', text: 'plaintext'
  };

  // Display names for language labels
  var LANG_LABELS = {
    shell: 'bash', json: 'json', yaml: 'yaml', hcl: 'hcl',
    python: 'python', powershell: 'powershell', sql: 'sql',
    xml: 'xml', html: 'html', javascript: 'js', typescript: 'ts',
    ini: 'ini', groovy: 'groovy', dockerfile: 'dockerfile',
    ruby: 'ruby', go: 'go', java: 'java', csharp: 'c#',
    css: 'css', markdown: 'markdown', plaintext: 'text'
  };

  // SVG icons
  var COPY_ICON = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
  var CHECK_ICON = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';

  var monacoPromise = null;
  var editors = [];

  // Detect the language from a code block's class hierarchy
  // Rouge outputs: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  // kramdown outputs: <pre><code class="language-bash">
  function detectLanguage(preEl) {
    var codeEl = preEl.querySelector('code');
    if (codeEl) {
      var match = (codeEl.className || '').match(/language-(\S+)/);
      if (match) return LANG_MAP[match[1].toLowerCase()] || 'plaintext';
    }
    var preMatch = (preEl.className || '').match(/language-(\S+)/);
    if (preMatch) return LANG_MAP[preMatch[1].toLowerCase()] || 'plaintext';
    var parent = preEl.parentElement;
    while (parent && parent !== document.body) {
      var parentMatch = (parent.className || '').match(/language-(\S+)/);
      if (parentMatch) return LANG_MAP[parentMatch[1].toLowerCase()] || 'plaintext';
      parent = parent.parentElement;
    }
    return 'plaintext';
  }

  function getCurrentTheme() {
    return document.documentElement.getAttribute('data-theme') === 'light' ? 'grc-light' : 'grc-dark';
  }

  // Find the outermost wrapper to replace (handles Rouge div wrapping)
  function findReplaceTarget(preEl) {
    var highlightDiv = preEl.parentElement;
    if (highlightDiv && highlightDiv.classList.contains('highlight')) {
      var rougeDiv = highlightDiv.parentElement;
      if (rougeDiv && rougeDiv.classList.contains('highlighter-rouge')) {
        return rougeDiv;
      }
      return highlightDiv;
    }
    return preEl;
  }

  // ─── TIER 1: Instant styled wrappers (no CDN needed) ───────────────
  // Wraps every code block in a styled container with language label + copy button.
  // The original <pre> (with Rouge syntax highlighting) is preserved inside.
  function wrapCodeBlock(preEl) {
    var codeEl = preEl.querySelector('code');
    if (!codeEl) return null;

    var language = detectLanguage(preEl);
    var codeText = codeEl.textContent.replace(/^\n+|\n+$/g, '');
    var displayLabel = LANG_LABELS[language] || language;

    // Build wrapper
    var wrapper = document.createElement('div');
    wrapper.className = 'monaco-code-wrapper';

    // Header with language label and copy button
    var header = document.createElement('div');
    header.className = 'monaco-code-header';

    var langLabel = document.createElement('span');
    langLabel.className = 'monaco-code-lang';
    langLabel.textContent = displayLabel;

    var copyBtn = document.createElement('button');
    copyBtn.className = 'monaco-copy-btn';
    copyBtn.innerHTML = COPY_ICON + ' Copy';
    copyBtn.setAttribute('aria-label', 'Copy code to clipboard');
    copyBtn.addEventListener('click', function() {
      navigator.clipboard.writeText(codeText).then(function() {
        copyBtn.innerHTML = CHECK_ICON + ' Copied';
        copyBtn.classList.add('copied');
        setTimeout(function() {
          copyBtn.innerHTML = COPY_ICON + ' Copy';
          copyBtn.classList.remove('copied');
        }, 2000);
      });
    });

    header.appendChild(langLabel);
    header.appendChild(copyBtn);
    wrapper.appendChild(header);

    // Move the original <pre> block (or Rouge wrapper) inside
    var replaceTarget = findReplaceTarget(preEl);
    replaceTarget.parentNode.insertBefore(wrapper, replaceTarget);
    wrapper.appendChild(replaceTarget);

    // Style the embedded pre to fit inside the wrapper
    preEl.style.margin = '0';
    preEl.style.borderRadius = '0 0 8px 8px';
    preEl.style.border = 'none';

    return { wrapper: wrapper, preEl: preEl, codeEl: codeEl, language: language, codeText: codeText };
  }

  // ─── TIER 2: Monaco Editor upgrade (self-hosted) ────────────────────
  function loadMonaco() {
    if (monacoPromise) return monacoPromise;

    monacoPromise = new Promise(function(resolve, reject) {
      // Timeout guard — reject if loading takes too long
      var timer = setTimeout(function() {
        monacoPromise = null;
        reject(new Error('Monaco load timed out'));
      }, MONACO_TIMEOUT);

      var script = document.createElement('script');
      script.src = MONACO_BASE + '/loader.js';
      script.onerror = function() {
        clearTimeout(timer);
        monacoPromise = null;
        reject(new Error('Monaco failed to load'));
      };
      script.onload = function() {
        require.config({ paths: { vs: MONACO_BASE } });

        window.MonacoEnvironment = {
          getWorker: function() { return undefined; }
        };

        // AMD require with error callback
        require(['vs/editor/editor.main'], function() {
          clearTimeout(timer);
          var m = window.monaco;

          // Define GRC Engineering dark theme
          m.editor.defineTheme('grc-dark', {
            base: 'vs-dark',
            inherit: true,
            rules: [
              { token: '',                foreground: 'e0e0e0' },
              { token: 'comment',         foreground: '6a737d', fontStyle: 'italic' },
              { token: 'keyword',         foreground: '60a5fa' },
              { token: 'keyword.flow',    foreground: '60a5fa' },
              { token: 'string',          foreground: '34d399' },
              { token: 'string.key.json', foreground: '93c5fd' },
              { token: 'number',          foreground: 'fbbf24' },
              { token: 'type',            foreground: 'c084fc' },
              { token: 'type.identifier', foreground: 'c084fc' },
              { token: 'function',        foreground: 'f472b6' },
              { token: 'variable',        foreground: '22d3ee' },
              { token: 'variable.predefined', foreground: '22d3ee' },
              { token: 'operator',        foreground: 'e0e0e0' },
              { token: 'delimiter',       foreground: '9ca3af' },
              { token: 'delimiter.bracket', foreground: '9ca3af' },
              { token: 'tag',             foreground: 'f87171' },
              { token: 'attribute.name',  foreground: '60a5fa' },
              { token: 'attribute.value', foreground: '34d399' },
              { token: 'metatag',         foreground: '6a737d' },
              { token: 'annotation',      foreground: 'fbbf24' },
              { token: 'constant',        foreground: 'fbbf24' }
            ],
            colors: {
              'editor.background':            '#0d1117',
              'editor.foreground':            '#e0e0e0',
              'editor.lineHighlightBackground': '#0d1117',
              'editorLineNumber.foreground':  '#4a5568',
              'editorLineNumber.activeForeground': '#718096',
              'editor.selectionBackground':   '#264f78',
              'editorGutter.background':      '#0d1117'
            }
          });

          // Define GRC Engineering light theme
          m.editor.defineTheme('grc-light', {
            base: 'vs',
            inherit: true,
            rules: [
              { token: '',                foreground: '1a1a1a' },
              { token: 'comment',         foreground: '6b7280', fontStyle: 'italic' },
              { token: 'keyword',         foreground: '1e40af' },
              { token: 'keyword.flow',    foreground: '1e40af' },
              { token: 'string',          foreground: '059669' },
              { token: 'string.key.json', foreground: '1e40af' },
              { token: 'number',          foreground: 'd97706' },
              { token: 'type',            foreground: '7c3aed' },
              { token: 'type.identifier', foreground: '7c3aed' },
              { token: 'function',        foreground: 'be185d' },
              { token: 'variable',        foreground: '0891b2' },
              { token: 'variable.predefined', foreground: '0891b2' },
              { token: 'operator',        foreground: '374151' },
              { token: 'delimiter',       foreground: '6b7280' },
              { token: 'delimiter.bracket', foreground: '6b7280' },
              { token: 'tag',             foreground: 'dc2626' },
              { token: 'attribute.name',  foreground: '1e40af' },
              { token: 'attribute.value', foreground: '059669' },
              { token: 'metatag',         foreground: '6b7280' },
              { token: 'annotation',      foreground: 'd97706' },
              { token: 'constant',        foreground: 'd97706' }
            ],
            colors: {
              'editor.background':            '#f6f8fa',
              'editor.foreground':            '#1a1a1a',
              'editor.lineHighlightBackground': '#f6f8fa',
              'editorLineNumber.foreground':  '#9ca3af',
              'editorLineNumber.activeForeground': '#6b7280',
              'editor.selectionBackground':   '#b4d5fe',
              'editorGutter.background':      '#f6f8fa'
            }
          });

          m.editor.setTheme(getCurrentTheme());
          resolve(m);
        }, function(err) {
          // AMD require error callback — handles submodule load failures
          clearTimeout(timer);
          monacoPromise = null;
          reject(err || new Error('Monaco modules failed to load'));
        });
      };
      document.head.appendChild(script);
    });

    return monacoPromise;
  }

  // Upgrade a wrapped code block to a full Monaco editor
  function upgradeToMonaco(blockInfo) {
    var wrapper = blockInfo.wrapper;
    var preEl = blockInfo.preEl;
    var codeText = blockInfo.codeText;
    var language = blockInfo.language;

    var lineCount = codeText.split('\n').length;

    // Create Monaco container
    var container = document.createElement('div');
    container.className = 'monaco-code-container';
    var height = Math.max(lineCount * 19 + 16, 40);
    container.style.height = height + 'px';

    loadMonaco().then(function(monaco) {
      // Hide the original pre, insert Monaco container
      var replaceTarget = findReplaceTarget(preEl);
      replaceTarget.style.display = 'none';
      wrapper.appendChild(container);

      var editor = monaco.editor.create(container, {
        value: codeText,
        language: language,
        theme: getCurrentTheme(),
        readOnly: true,
        minimap: { enabled: false },
        fontSize: 13,
        fontFamily: "'JetBrains Mono', 'Fira Code', 'Cascadia Code', Consolas, monospace",
        lineNumbers: 'on',
        lineNumbersMinChars: 3,
        folding: false,
        wordWrap: 'on',
        automaticLayout: true,
        scrollBeyondLastLine: false,
        renderLineHighlight: 'none',
        padding: { top: 8, bottom: 8 },
        domReadOnly: true,
        cursorStyle: 'line',
        contextmenu: false,
        hideCursorInOverviewRuler: true,
        overviewRulerLanes: 0,
        scrollbar: {
          vertical: 'hidden',
          horizontal: 'auto',
          useShadows: false
        },
        guides: {
          indentation: false,
          bracketPairs: false
        },
        renderWhitespace: 'none',
        matchBrackets: 'never'
      });

      editors.push(editor);

      // Auto-size height after content is laid out
      requestAnimationFrame(function() {
        var contentHeight = editor.getContentHeight();
        container.style.height = contentHeight + 'px';
        editor.layout();
      });
    }).catch(function() {
      // Monaco failed — remove container, original pre stays visible inside wrapper
      container.remove();
      var replaceTarget = findReplaceTarget(preEl);
      replaceTarget.style.display = '';
    });
  }

  // Watch for theme changes and update all Monaco editors
  var themeObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'data-theme' && window.monaco) {
        window.monaco.editor.setTheme(getCurrentTheme());
      }
    });
  });
  themeObserver.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

  // ─── Initialize ────────────────────────────────────────────────────
  document.addEventListener('DOMContentLoaded', function() {
    var preBlocks = document.querySelectorAll('.guide-body pre');
    if (preBlocks.length === 0) return;

    // TIER 1: Immediately wrap all code blocks with styled containers
    var wrappedBlocks = [];
    preBlocks.forEach(function(pre) {
      var info = wrapCodeBlock(pre);
      if (info) wrappedBlocks.push(info);
    });

    // TIER 2: Progressively upgrade to Monaco via IntersectionObserver
    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          observer.unobserve(entry.target);
          // Find the block info for this wrapper
          var info = wrappedBlocks.find(function(b) { return b.wrapper === entry.target; });
          if (info) {
            if (window.requestIdleCallback) {
              requestIdleCallback(function() { upgradeToMonaco(info); });
            } else {
              setTimeout(function() { upgradeToMonaco(info); }, 16);
            }
          }
        }
      });
    }, {
      rootMargin: '300px 0px'
    });

    wrappedBlocks.forEach(function(info) {
      observer.observe(info.wrapper);
    });

    // Re-observe code blocks inside pack <details> when expanded
    document.querySelectorAll('.pack-details').forEach(function(details) {
      details.addEventListener('toggle', function() {
        if (details.open) {
          details.querySelectorAll('.monaco-code-wrapper').forEach(function(wrapper) {
            observer.observe(wrapper);
          });
        }
      });
    });
  });
})();
</script>
