# HTH GitHub Control 5.05 Extension: Deployment with Environment Secrets
# Profile: L2 | NIST: SC-12, SC-28
# https://howtoharden.com/guides/github/#51-use-github-actions-secrets-with-environment-protection
#
# Deploy: Copy to .github/workflows/deploy.yml

# HTH Guide Excerpt: begin cli-deployment-secrets-workflow
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production  # Requires approval to run
    steps:
      - uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744
      - name: Deploy
        env:
          API_KEY: ${{ secrets.PROD_API_KEY }}
        run: |
          # Secret is available in $API_KEY env var
          # NOT visible in logs
          deploy.sh
# HTH Guide Excerpt: end cli-deployment-secrets-workflow
