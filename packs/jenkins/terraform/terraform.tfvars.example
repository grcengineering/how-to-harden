# =============================================================================
# Jenkins Hardening Code Pack - Example Variable Values
# How to Harden (howtoharden.com)
#
# Copy this file to terraform.tfvars and fill in your values.
# NEVER commit terraform.tfvars to version control -- it contains secrets.
#
# Usage:
#   cp terraform.tfvars.example terraform.tfvars
#   # Edit terraform.tfvars with your values
#   terraform plan
#   terraform apply
# =============================================================================


# -----------------------------------------------------------------------------
# Profile Level
# 1 = Baseline (L1) -- essential controls for all organizations
# 2 = Hardened (L2) -- adds SSO, RBAC, ephemeral agents, secure templates
# 3 = Maximum Security (L3) -- strictest controls for regulated industries
# -----------------------------------------------------------------------------
profile_level = 1


# -----------------------------------------------------------------------------
# Jenkins Provider Configuration
# -----------------------------------------------------------------------------

# Jenkins server URL (include protocol and port)
jenkins_server_url = "https://jenkins.example.com"

# Admin username for Terraform API access
jenkins_username = "admin"

# Admin password or API token
# WARNING: This is a sensitive value. Use environment variables in production:
#   export TF_VAR_jenkins_password="your-api-token"
jenkins_password = ""

# Path to CA certificate for self-signed Jenkins (leave empty for trusted CA)
jenkins_ca_cert = ""


# -----------------------------------------------------------------------------
# Section 1.2: SSO Configuration (L2+ only)
# Set sso_type to "saml" or "ldap" to generate JCasC SSO configuration.
# Only applied when profile_level >= 2.
# -----------------------------------------------------------------------------

sso_type = "none"

# SAML settings (when sso_type = "saml")
# saml_idp_metadata_url   = "https://idp.example.com/metadata"
# saml_username_attribute  = "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"
# saml_email_attribute     = "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"
# saml_group_attribute     = "http://schemas.xmlsoap.org/claims/Group"

# LDAP settings (when sso_type = "ldap")
# ldap_server_url          = "ldaps://ldap.example.com:636"
# ldap_root_dn             = "dc=example,dc=com"
# ldap_user_search_base    = "ou=users"
# ldap_user_search_filter  = "uid={0}"
# ldap_group_search_base   = "ou=groups"
# ldap_manager_dn          = "cn=admin,dc=example,dc=com"
# ldap_manager_password    = ""


# -----------------------------------------------------------------------------
# Section 2.1: Matrix-Based Security
# Team folders with project-based matrix authorization permissions.
# Format: "hudson.model.Item.Build:username" for Jenkins permission strings.
# -----------------------------------------------------------------------------

admin_users = [
  # "admin",
  # "security-admin",
]

team_folders = {
  # "team-alpha" = {
  #   description = "Team Alpha CI/CD pipelines"
  #   permissions = [
  #     "hudson.model.Item.Build:alice",
  #     "hudson.model.Item.Read:alice",
  #     "hudson.model.Item.Build:bob",
  #     "hudson.model.Item.Read:bob",
  #   ]
  # }
  # "team-bravo" = {
  #   description = "Team Bravo CI/CD pipelines"
  #   permissions = [
  #     "hudson.model.Item.Build:charlie",
  #     "hudson.model.Item.Read:charlie",
  #   ]
  # }
}


# -----------------------------------------------------------------------------
# Section 2.2: Project-Based Matrix Authorization (L2+ only)
# Per-project folders with non-inheriting permissions.
# Only applied when profile_level >= 2.
# -----------------------------------------------------------------------------

project_folders = {
  # "payment-service" = {
  #   description   = "Payment service pipeline (restricted access)"
  #   parent_folder = "team-alpha"
  #   permissions   = [
  #     "hudson.model.Item.Build:alice",
  #     "hudson.model.Item.Read:alice",
  #     "hudson.model.Item.Configure:alice",
  #   ]
  # }
}


# -----------------------------------------------------------------------------
# Section 2.3: Role-Based Access Control (L2+ only)
# Set enable_rbac = true to use Role Strategy Plugin instead of Matrix.
# Only applied when profile_level >= 2.
# -----------------------------------------------------------------------------

enable_rbac = false

developer_users = [
  # "alice",
  # "bob",
]

viewer_users = [
  # "auditor",
  # "manager",
]

rbac_item_roles = [
  # {
  #   name        = "team-a-dev"
  #   description = "Team A developer access"
  #   pattern     = "team-a-.*"
  #   permissions = ["Job/Build", "Job/Read", "Job/Workspace"]
  #   users       = ["alice", "bob"]
  # },
]


# -----------------------------------------------------------------------------
# Section 3.2: Disable Builds on Controller
# Set executors to 0 and apply a restrictive label to prevent builds
# from running on the controller node.
# -----------------------------------------------------------------------------

controller_executors = 0
controller_label     = "do-not-use"


# -----------------------------------------------------------------------------
# Section 3.3: Ephemeral Agents (L2+ only)
# Set cloud_agent_type to "kubernetes" or "docker" to configure ephemeral agents.
# Only applied when profile_level >= 2.
# -----------------------------------------------------------------------------

cloud_agent_type = "none"

# Kubernetes settings (when cloud_agent_type = "kubernetes")
# k8s_server_url     = "https://kubernetes.default"
# k8s_namespace      = "jenkins"
# k8s_max_containers = "10"

# Docker settings (when cloud_agent_type = "docker")
# docker_host_uri      = "unix:///var/run/docker.sock"
# docker_max_instances = "5"

# Agent container image
agent_image        = "jenkins/inbound-agent:latest"
agent_cpu_limit    = "500m"
agent_memory_limit = "512Mi"


# -----------------------------------------------------------------------------
# Section 3.4: Secure Agent Communication
# Fixed TCP port for inbound JNLP agent connections.
# Use a fixed port so firewall rules can be precisely configured.
# -----------------------------------------------------------------------------

agent_inbound_port = 50000


# -----------------------------------------------------------------------------
# Section 4.1: CSRF Protection
# Enable proxy compatibility if Jenkins is behind a reverse proxy (nginx, HAProxy).
# -----------------------------------------------------------------------------

csrf_proxy_compatibility = true


# -----------------------------------------------------------------------------
# Section 4.2: Credential Scoping
# Folder-based credential domains for scoped secret management.
# Default domains: production-deployments, testing-resources, third-party-integrations.
# -----------------------------------------------------------------------------

# credential_domains = {
#   "production-deployments" = {
#     description = "Credentials scoped to production deployment jobs only"
#   }
#   "testing-resources" = {
#     description = "Credentials scoped to testing and QA jobs"
#   }
#   "third-party-integrations" = {
#     description = "Credentials for third-party service integrations"
#   }
# }


# -----------------------------------------------------------------------------
# Section 4.4: Secure Pipeline Template (L2+ only)
# Creates a disabled template job demonstrating hardened Jenkinsfile practices.
# Only applied when profile_level >= 2.
# -----------------------------------------------------------------------------

create_secure_pipeline_template = true
secure_pipeline_agent_label     = "secure-agent"
build_timeout_hours             = 1
builds_to_keep                  = 10


# -----------------------------------------------------------------------------
# Section 5.1: Audit Logging
# Configure audit trail plugin and security monitoring view.
# -----------------------------------------------------------------------------

create_security_views = true

monitored_projects = [
  # "production-deployments",
  # "team-alpha",
]

audit_log_path         = "/var/log/jenkins/audit.log"
audit_log_size_mb      = 100
audit_log_rotate_count = 5

# Syslog SIEM integration (leave syslog_server empty to disable)
syslog_server = ""
syslog_port   = 514
