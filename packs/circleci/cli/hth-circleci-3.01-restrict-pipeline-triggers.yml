# HTH CircleCI Control 3.01: Restrict Pipeline Triggers
# Profile: L1 | NIST: CM-7
# https://howtoharden.com/guides/circleci/#31-restrict-pipeline-triggers
#
# Deploy: Add to .circleci/config.yml

# HTH Guide Excerpt: begin cli-restrict-pipeline-triggers
# .circleci/config.yml
workflows:
  build_and_test:
    jobs:
      - build
      - test:
          requires:
            - build

  deploy:
    jobs:
      - deploy_staging:
          filters:
            branches:
              only: develop
      - approve_production:
          type: approval
          requires:
            - deploy_staging
          filters:
            branches:
              only: main
      - deploy_production:
          requires:
            - approve_production
          filters:
            branches:
              only: main
# HTH Guide Excerpt: end cli-restrict-pipeline-triggers
